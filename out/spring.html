<!DOCTYPE html>
<html>
<head>
<title>Spring</title>
<!-- 2017-02-21 周二 14:16 -->
<meta  charset="utf-8">
<meta  name="generator" content="Org-mode">
<meta  name="author" content="imfine">
<link rel="stylesheet" href="nnn.css">
<meta name="viewport" content="width=device-width,initial-scale=1">
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="index.html"> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content">
<h1 class="title">Spring</h1>
<nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Spring</a>
<ul>
<li><a href="#sec-1-1">1.1. IOC</a></li>
<li><a href="#sec-1-2">1.2. Proxy</a></li>
<li><a href="#sec-1-3">1.3. AOP</a></li>
<li><a href="#sec-1-4">1.4. 声明式事务</a></li>
</ul>
</li>
<li><a href="#sec-2">2. Spring MVC</a>
<ul>
<li><a href="#sec-2-1">2.1. 创建 MVC 项目基本步骤</a></li>
<li><a href="#sec-2-2">2.2. Parameters</a></li>
<li><a href="#sec-2-3">2.3. 请求流程</a></li>
<li><a href="#sec-2-4">2.4. Validation(表单验证)</a></li>
<li><a href="#sec-2-5">2.5. PropertyEditor/Convertor/Formater(日期转换为例)</a></li>
<li><a href="#sec-2-6">2.6. Exception(异常处理)</a></li>
<li><a href="#sec-2-7">2.7. Interceptor(拦截器)</a></li>
<li><a href="#sec-2-8">2.8. MessageSource(国际化，资源文件)</a></li>
</ul>
</li>
<li><a href="#sec-3">3. RESTful Style</a></li>
</ul>
</div>
</nav>

<section id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Spring</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> IOC</h3>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Proxy</h3>
<div class="outline-text-3" id="text-1-2">
<p>
[例] 一个女孩要表白
</p>

<p>
先定义这个女孩的接口跟类
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#25509;&#21475;&#65292;&#21253;&#21547;&#19968;&#20010;&#34920;&#30333;(sayLove)&#30340;&#26041;&#27861;</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">interface</span> <span style="color: #228b22;">Person</span> <span style="color: #707183;">{</span>
    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">sayLove</span><span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>


<span style="color: #b22222;">// </span><span style="color: #b22222;">&#20855;&#20307;&#31867;&#65292;&#19968;&#20010;&#35201;&#21435;&#34920;&#30333;&#30340;&#22899;&#23401;&#20799;</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Girl</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">Person</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">sayLove</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#25105;&#29233;&#20320;."</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
如果不通过代理的方式，那么表白的代码如下：
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #0000ff;">main</span> <span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
    <span style="color: #228b22;">Girl</span> <span style="color: #a0522d;">z</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Girl</span><span style="color: #7388d6;">()</span>;
    z.sayLove<span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
但是在某些情况下，直接表白是不合适的，所以需要有人出面玉成此事。
这个时候，需要代理。代理出面，代替女孩儿求爱。
</p>


<p>
分为静态代理和动态代理。
</p>
</div>

<div id="outline-container-sec-1-2-1" class="outline-4">
<h4 id="sec-1-2-1"><span class="section-number-4">1.2.1</span> 静态代理</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
实现方式有两种：继承、聚合
</p>

<p>
首先，继承的方式：
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#36825;&#23601;&#26159;&#35201;&#24110;&#24537;&#20986;&#38754;&#30340;&#20195;&#29702;&#65292;&#23427;&#38656;&#35201;&#26377; sayLove() &#26041;&#27861;</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">LoveProxy</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">Girl</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">sayLove</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">super</span>.sayLove<span style="color: #909183;">()</span>;
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#31069;&#20320;&#20204;&#33021;&#30333;&#22836;&#20565;&#32769;."</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>


<span style="color: #b22222;">// </span><span style="color: #b22222;">&#25191;&#34892;</span>
<span style="color: #0000ff;">main</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
    <span style="color: #228b22;">LoveProxy</span> <span style="color: #a0522d;">m</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">LoveProxy</span><span style="color: #7388d6;">()</span>;
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#35753;&#20195;&#29702;&#24110;&#21161;&#34920;&#30333;</span>
    m.sayLove<span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>
</pre>
</div>


<p>
其次，聚合的方式。很重要的方式。这种方式必须要有接口。
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#38656;&#35201;&#23454;&#29616; Girl &#30456;&#21516;&#30340;&#25509;&#21475;&#65292;&#25105;&#20204;&#30340;&#20195;&#29702;&#24517;&#39035;&#35201;&#26377; sayLove() &#26041;&#27861;</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">LoveProxy</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">Person</span> <span style="color: #707183;">{</span>
    <span style="color: #228b22;">Girl</span> <span style="color: #a0522d;">z</span> = <span style="color: #008b8b;">null</span>;
    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">LoveProxy</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">Girl</span> <span style="color: #a0522d;">g</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">this</span>.z = g;
    <span style="color: #7388d6;">}</span>

    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">sayLove</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
        z.sayLove<span style="color: #909183;">()</span>;
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#25105;&#20204;&#22312;&#19968;&#36215;&#21543;&#12290;"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>


<span style="color: #0000ff;">main</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>
    <span style="color: #228b22;">LoveProxy</span> <span style="color: #a0522d;">m</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">LoveProxy</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">Girl</span><span style="color: #909183;">()</span><span style="color: #7388d6;">)</span>;
    m.sayLove<span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-2" class="outline-4">
<h4 id="sec-1-2-2"><span class="section-number-4">1.2.2</span> JDK 动态代理</h4>
<div class="outline-text-4" id="text-1-2-2">
<p>
JDK 的动态代理，必须依赖接口实现
</p>

<p>
首先，要创建一个代理的 <b>生成器</b> ，用来为某个类生成代理。
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">JDKLoveProxyGenerator</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">InvocationHandler</span> <span style="color: #707183;">{</span>

    <span style="color: #228b22;">Object</span> <span style="color: #a0522d;">z</span> = <span style="color: #008b8b;">null</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">JDKLoveProxyGenerator</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">Object</span> <span style="color: #a0522d;">g</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">this</span>.z = g;
    <span style="color: #7388d6;">}</span>

    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Object</span> <span style="color: #0000ff;">invoke</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">Object</span> <span style="color: #a0522d;">proxy</span>, <span style="color: #228b22;">Method</span> <span style="color: #a0522d;">method</span>, <span style="color: #228b22;">Object</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Throwable</span> <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#29992;&#21453;&#23556;&#30340;&#26041;&#24335;&#65292;&#35843;&#29992; z &#37324;&#30340;&#21407;&#26041;&#27861;</span>
        <span style="color: #228b22;">Object</span> <span style="color: #a0522d;">result</span> = method.invoke<span style="color: #909183;">(</span>z, args<span style="color: #909183;">)</span>;
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#20320;&#20204;&#30495;&#30340;&#33021;&#22815;&#22312;&#19968;&#36215;&#12290;"</span><span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">return</span> result;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>


<p>
利用上边的代理生成器，生成一个帮助我们做事的代理。
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #0000ff;">main</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36890;&#36807;&#20195;&#29702;&#29983;&#25104;&#22120;&#65292;&#20026; Girl &#21019;&#24314;&#19968;&#20010;&#20195;&#29702;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#27880;&#24847;&#65292;&#29983;&#25104;&#30340;&#20195;&#29702;&#31867;&#26159; Person &#25509;&#21475;&#30340;&#19968;&#20010;&#23454;&#29616;</span>
    <span style="color: #228b22;">Person</span> <span style="color: #a0522d;">loveProxy</span> = <span style="color: #7388d6;">(</span><span style="color: #228b22;">Person</span><span style="color: #7388d6;">)</span> Proxy
        .newProxyInstance<span style="color: #7388d6;">(</span>Girl.<span style="color: #a020f0;">class</span>.getClassLoader<span style="color: #909183;">()</span>,
                          Girl.<span style="color: #a020f0;">class</span>.getInterfaces<span style="color: #909183;">()</span>,
                          <span style="color: #a020f0;">new</span> <span style="color: #228b22;">JDKLoveProxyGenerator</span><span style="color: #909183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">Girl</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>;
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#35753;&#20195;&#29702;&#24110;&#21161;&#20570;&#26576;&#20123;&#20107;</span>
    loveProxy.sayLove<span style="color: #7388d6;">()</span>;


    System.out.println<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"--------------------"</span><span style="color: #7388d6;">)</span>;


    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#19968;&#20010;&#21160;&#24577;&#20195;&#29702;&#29983;&#25104;&#22120;&#65292;&#21487;&#20197;&#20026;&#22810;&#20010;&#19981;&#21516;&#30340;&#25509;&#21475;&#29983;&#25104;&#20195;&#29702;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#19979;&#38754;&#20026; Dog &#29983;&#25104;&#19968;&#20010;&#20195;&#29702;</span>
    <span style="color: #228b22;">Animal</span> <span style="color: #a0522d;">animalLoveProxy</span> = <span style="color: #7388d6;">(</span><span style="color: #228b22;">Animal</span><span style="color: #7388d6;">)</span> Proxy
        .newProxyInstance<span style="color: #7388d6;">(</span>Dog.<span style="color: #a020f0;">class</span>.getClassLoader<span style="color: #909183;">()</span>,
                          Dog.<span style="color: #a020f0;">class</span>.getInterfaces<span style="color: #909183;">()</span>,
                          <span style="color: #a020f0;">new</span> <span style="color: #228b22;">JDKLoveProxy</span><span style="color: #909183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">Dog</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>;
    animalLoveProxy.sayLove<span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-1-2-3" class="outline-4">
<h4 id="sec-1-2-3"><span class="section-number-4">1.2.3</span> CGLib 动态代理</h4>
<div class="outline-text-4" id="text-1-2-3">
<p>
CGLib 动态代理使用的是直接修改 Class 字节码的方式实现，它并不需要接口。
</p>

<p>
如果使用 CGLib 的动态代理，首先，要在工程中加入 cglib 的 jar 包支持：
</p>
<pre class="example">
compile "cglib:cglib:3.2.4"
</pre>

<p>
其次，使用 CGLib 实现我们的 <b>代理生成器</b> ，只要实现 MethodInterceptor 接口即可：
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">CGLibLoveProxyGenerator</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">MethodInterceptor</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Object</span> <span style="color: #0000ff;">intercept</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">Object</span> <span style="color: #a0522d;">obj</span>, <span style="color: #228b22;">Method</span> <span style="color: #a0522d;">method</span>, <span style="color: #228b22;">Object</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span>, <span style="color: #228b22;">MethodProxy</span> <span style="color: #a0522d;">proxy</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Throwable</span> <span style="color: #7388d6;">{</span>

        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#20320;&#22909;&#21834;&#65292;&#25105;&#26159;&#19968;&#20010;&#20195;&#29702;&#65292;&#24110;&#20320;&#20256;&#20010;&#23567;&#22993;&#23064;&#30340;&#32440;&#26465;&#65306;"</span><span style="color: #909183;">)</span>;
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#35843;&#29992;&#21407;&#26041;&#27861;</span>
        <span style="color: #228b22;">Object</span> <span style="color: #a0522d;">result</span> = proxy.invokeSuper<span style="color: #909183;">(</span>obj, args<span style="color: #909183;">)</span>;

        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#20320;&#20204;&#20854;&#23454;&#25402;&#36866;&#21512;&#30340;&#12290;&#22312;&#19968;&#36215;&#23601;&#21152;&#27833;&#21734;."</span><span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">return</span> result;

    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
然后，就可以用上面的 CGLibLoveProxyGenerator 为某个类生成代理了：
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #0000ff;">main</span><span style="color: #707183;">()</span> <span style="color: #707183;">{</span>

    <span style="color: #8b2252;">/**</span>
<span style="color: #8b2252;">     * &#36825;&#26159;&#19968;&#20010;&#20351;&#29992; JDK &#21160;&#24577;&#20195;&#29702;&#30340;&#20363;&#23376;&#12290;</span>
<span style="color: #8b2252;">     */</span>
    <span style="color: #228b22;">Person</span> <span style="color: #a0522d;">loveProxy</span> = <span style="color: #7388d6;">(</span><span style="color: #228b22;">Person</span><span style="color: #7388d6;">)</span> Proxy
        .newProxyInstance<span style="color: #7388d6;">(</span>Girl.<span style="color: #a020f0;">class</span>.getClassLoader<span style="color: #909183;">()</span>,             <span style="color: #b22222;">// </span><span style="color: #b22222;">classLoader</span>
                          Girl.<span style="color: #a020f0;">class</span>.getInterfaces<span style="color: #909183;">()</span>,              <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25509;&#21475;</span>
                          <span style="color: #a020f0;">new</span> <span style="color: #228b22;">JDKLoveProxyGenerator</span><span style="color: #909183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">Girl</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20195;&#29702;&#29983;&#25104;&#22120;</span>
                          <span style="color: #7388d6;">)</span>;                    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#27880;&#24847;&#65292;&#29983;&#25104;&#30340;&#20195;&#29702;&#30340;&#31867;&#22411;&#26159; Person</span>

    loveProxy.sayLove<span style="color: #7388d6;">()</span>;



    <span style="color: #8b2252;">/**</span>
<span style="color: #8b2252;">     * &#36825;&#26159;&#19968;&#20010;&#20351;&#29992; CGLib &#21160;&#24577;&#20195;&#29702;&#30340;&#20363;&#23376;&#12290;</span>
<span style="color: #8b2252;">     * &#36319;&#19978;&#38754;&#29992; JDK &#20195;&#29702;&#26041;&#24335;&#27604;&#36739;&#65292;&#21457;&#29616;&#23427;&#20204;&#20854;&#23454;&#26159;&#19968;&#33268;&#30340;&#12290;</span>
<span style="color: #8b2252;">     */</span>
    <span style="color: #228b22;">Enhancer</span> <span style="color: #a0522d;">enhancer</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Enhancer</span><span style="color: #7388d6;">()</span>;
    enhancer.setClassLoader<span style="color: #7388d6;">(</span>Dog.<span style="color: #a020f0;">class</span>.getClassLoader<span style="color: #909183;">()</span><span style="color: #7388d6;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">classLoader</span>
    enhancer.setSuperclass<span style="color: #7388d6;">(</span>Dog.<span style="color: #a020f0;">class</span><span style="color: #7388d6;">)</span>;                   <span style="color: #b22222;">// </span><span style="color: #b22222;">&#29238;&#31867;</span>
    enhancer.setCallback<span style="color: #7388d6;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">CGLibLoveProxyGenerator</span><span style="color: #909183;">()</span><span style="color: #7388d6;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20195;&#29702;&#29983;&#25104;&#22120;</span>

    <span style="color: #228b22;">Dog</span> <span style="color: #a0522d;">dogProxy</span> = <span style="color: #7388d6;">(</span><span style="color: #228b22;">Dog</span><span style="color: #7388d6;">)</span> enhancer.create<span style="color: #7388d6;">()</span>;    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#27880;&#24847;&#65292;&#29983;&#25104;&#30340;&#20195;&#29702;&#30340;&#31867;&#22411;&#26159; Dog</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20854;&#23454;&#65292;&#19978;&#38754;&#21019;&#24314; dogProxy &#30340;&#20195;&#30721;&#21487;&#20197;&#31616;&#20889;&#20026;:</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">Dog dogProxy = (Dog) Enhancer.create(Dog.class, null, new CGLibLoveProxyGenerator());</span>

    dogProxy.sayLove<span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> AOP</h3>
<div class="outline-text-3" id="text-1-3">
<p>
第一步，加入jar包：
</p>
<pre class="example">
compile "org.aspectj:aspectjweaver:1.8.9
</pre>

<p>
第二步，在 spring.xml 中，增加 aspectj 的支持。
</p>
<pre class="example">
&lt;aop:aspectj-autoproxy proxy-target-class="true" /&gt;
</pre>

<p>
第三步，创建切面，放入容器。
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#20808;&#23450;&#20041;&#19968;&#20010;&#26085;&#24535;&#30456;&#20851;&#30340;&#20999;&#38754;</span>
<span style="color: #008b8b;">@Component</span>
<span style="color: #008b8b;">@Aspect</span>
<span style="color: #008b8b;">@Order</span><span style="color: #707183;">(</span>2<span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">LogAspect</span> <span style="color: #707183;">{</span>

    <span style="color: #008b8b;">@Before</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"execution(* edu.nf.emptyproject.service.UserService.*(..))"</span><span style="color: #7388d6;">)</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">sayHello</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#12304;AOP&#12305; hello..."</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #008b8b;">@After</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"execution(* edu.nf.emptyproject.service.UserService.find*(..))"</span><span style="color: #7388d6;">)</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">sayBye</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#12304;AOP&#12305; Goodbye..."</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>


<span style="color: #b22222;">// </span><span style="color: #b22222;">&#23450;&#20041;&#19968;&#20010;&#35745;&#31639;&#36816;&#34892;&#26102;&#38388;&#30340;&#20999;&#38754;</span>
<span style="color: #008b8b;">@Component</span>
<span style="color: #008b8b;">@Aspect</span>
<span style="color: #008b8b;">@Order</span><span style="color: #707183;">(</span>1<span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">BenchmarkAspect</span> <span style="color: #707183;">{</span>

    <span style="color: #008b8b;">@Around</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"execution(* edu.nf.emptyproject.service.UserService.*(..)))"</span><span style="color: #7388d6;">)</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Object</span> <span style="color: #0000ff;">doSomePrivsCheck</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">ProceedingJoinPoint</span> <span style="color: #a0522d;">joinPoint</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Throwable</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">long</span> <span style="color: #a0522d;">start</span> = System.currentTimeMillis<span style="color: #909183;">()</span>;
        <span style="color: #228b22;">Object</span> <span style="color: #a0522d;">ret</span> = joinPoint.proceed<span style="color: #909183;">()</span>;
        System.out.printf<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#12304;AOP&#12305; &#25191;&#34892;&#26041;&#27861; %s &#19968;&#20849;&#29992;&#20102; %d ms\n"</span>, joinPoint.getSignature<span style="color: #709870;">()</span>.getName<span style="color: #709870;">()</span>, System.currentTimeMillis<span style="color: #709870;">()</span> - start<span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">return</span> ret;
    <span style="color: #7388d6;">}</span>

<span style="color: #707183;">}</span>
</pre>
</div>

<p>
上面是用注解的形式实现的切面。当然可以用 xml 的方式同样做到：
</p>
<div class="org-src-container">

<pre class="src src-xml">&lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">logAspect</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">edu.xxx.LogAspect</span><span style="color: #8b2252;">"</span> /&gt;

&lt;<span style="color: #483d8b;">aop</span>:<span style="color: #0000ff;">config</span>&gt;
  &lt;<span style="color: #483d8b;">aop</span>:<span style="color: #0000ff;">aspect</span> <span style="color: #a0522d;">ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">logAspect</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #483d8b;">aop</span>:<span style="color: #0000ff;">pointcut</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">a</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">expression</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">execution(* edu..*.*(..))</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;<span style="color: #483d8b;">aop</span>:<span style="color: #0000ff;">before</span> <span style="color: #a0522d;">method</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">sayHello</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">pointcut-ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">a</span><span style="color: #8b2252;">"</span> /&gt;
  &lt;/<span style="color: #483d8b;">aop</span>:<span style="color: #0000ff;">aspect</span>&gt;
&lt;/<span style="color: #483d8b;">aop</span>:<span style="color: #0000ff;">config</span>&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> 声明式事务</h3>
</div>
</section>

<section id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Spring MVC</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> 创建 MVC 项目基本步骤</h3>
<div class="outline-text-3" id="text-2-1">
<p>
第一步，创建 Gradle 项目，在 build.gradle 增加相关依赖
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #228b22;">apply</span> <span style="color: #a0522d;">plugin</span>: <span style="color: #8b2252;">'java'</span>
apply plugin: <span style="color: #8b2252;">'war'</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#25351;&#23450; Java &#29256;&#26412;</span>
sourceCompatibility = 1.8

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#37197;&#32622;&#19979;&#36733; jar &#21253;&#30340;&#22320;&#22336;</span>
repositories <span style="color: #707183;">{</span>
  mavenCentral<span style="color: #7388d6;">()</span>
  jcenter<span style="color: #7388d6;">()</span>
<span style="color: #707183;">}</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#37197;&#32622;&#38656;&#35201;&#30340; jar &#21253;&#20381;&#36182;</span>
dependencies <span style="color: #707183;">{</span>

  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23450;&#20041;&#20004;&#20010;&#23616;&#37096;&#21464;&#37327;</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36825;&#37324;&#20195;&#34920;&#25105;&#20204;&#38656;&#35201;&#30340; hibernate &#21644; spring &#30340;&#29256;&#26412;</span>
  <span style="color: #228b22;">def</span> <span style="color: #a0522d;">hibernateVersion</span> = <span style="color: #8b2252;">"5.1.0.Final"</span>
  def springVersion = <span style="color: #8b2252;">"4.3.5.RELEASE"</span>

  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22312; test &#20013;&#38656;&#35201;&#29992;&#21040;&#30340; jar &#21253;</span>
  testCompile <span style="color: #7388d6;">(</span>
    <span style="color: #8b2252;">"junit:junit:4.12"</span>
  <span style="color: #7388d6;">)</span>

  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25351;&#26126; Tomcat &#19978;&#24050;&#32463;&#33258;&#24102;&#30340; jar &#21253;&#65292;&#36825;&#26679;&#21457;&#24067;&#30340;&#26102;&#20505;&#25165;&#19981;&#20250;&#37325;&#22797;</span>
  providedCompile <span style="color: #7388d6;">(</span>
    <span style="color: #8b2252;">"javax:javaee-web-api:7.0"</span>,
  <span style="color: #7388d6;">)</span>

  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#37197;&#32622;&#25105;&#20204;&#39033;&#30446;&#38656;&#35201;&#29992;&#21040;&#30340;&#25152;&#26377; jar &#21253;&#65292;&#21363; compile &#29615;&#33410;&#38656;&#35201;&#30340; jar &#21253;</span>
  compile <span style="color: #7388d6;">(</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26412;&#22320;&#30340; OJDBC &#21253;&#21152;&#20837;&#36827;&#26469;&#65292;&#35201;&#25913;&#25104;&#33258;&#24049;&#30340;&#36335;&#24452;</span>
    files<span style="color: #909183;">(</span><span style="color: #8b2252;">"E:/SSH/lib_hibernate/ojdbc7.jar"</span><span style="color: #909183;">)</span>,

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#29992;&#26469;&#31649;&#29702;&#25968;&#25454;&#28304;&#30340;&#30693;&#21517; jar &#21253;</span>
    <span style="color: #8b2252;">"c3p0:c3p0:0.9.1.2"</span>,

    <span style="color: #b22222;">// </span><span style="color: #b22222;">jsp &#20013; jstl &#26631;&#31614;&#30340;&#25903;&#25345; jar &#21253;</span>
    <span style="color: #8b2252;">"javax.servlet:jstl:1.2"</span>,

    <span style="color: #b22222;">// </span><span style="color: #b22222;">log4j &#26085;&#24535;&#25903;&#25345;&#30340; jar &#21253;</span>
    <span style="color: #8b2252;">"log4j:log4j:1.2.17"</span>,

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#37197;&#32622; hibernate</span>
    <span style="color: #8b2252;">"org.hibernate:hibernate-core:$hibernateVersion"</span>,
    <span style="color: #8b2252;">"org.hibernate:hibernate-validator:5.4.0.Final"</span>,

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#37197;&#32622; spring</span>
    <span style="color: #8b2252;">"org.springframework:spring-web:$springVersion"</span>,
    <span style="color: #8b2252;">"org.springframework:spring-orm:$springVersion"</span>,
    <span style="color: #8b2252;">"org.springframework:spring-aop:$springVersion"</span>,
    <span style="color: #8b2252;">"org.springframework:spring-webmvc:$springVersion"</span>,
    <span style="color: #8b2252;">"com.fasterxml.jackson.core:jackson-databind:2.5.1"</span>,
  <span style="color: #7388d6;">)</span>
<span style="color: #707183;">}</span>


<span style="color: #b22222;">// </span><span style="color: #b22222;">&#20026;&#32534;&#35793;&#22120;&#37197;&#32622;&#32534;&#30721;&#65292;&#38450;&#27490;&#26576;&#20123;&#24773;&#20917;&#19979;&#32534;&#35793;&#20986;&#29616;&#20081;&#30721;&#30340;&#24773;&#20917;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#30456;&#24212;&#30340;&#65292;&#25105;&#20204;&#25152;&#26377;&#30340;&#20195;&#30721;&#24212;&#35813;&#20445;&#23384;&#25104; UTF-8 &#26684;&#24335;</span>
tasks.<span style="color: #0000ff;">withType</span><span style="color: #707183;">(</span><span style="color: #228b22;">JavaCompile</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
  options.encoding = <span style="color: #8b2252;">"UTF-8"</span>
<span style="color: #707183;">}</span>


<span style="color: #b22222;">// </span><span style="color: #b22222;">&#33258;&#23450;&#20041;&#20219;&#21153;&#65292;&#23558;&#24037;&#31243;&#25152;&#38656;&#35201;&#30340; jar &#21253;&#25335;&#36125;&#21040;&#39033;&#30446;&#19979;&#30340; lib &#25991;&#20214;&#22841;&#19979;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#38656;&#35201;&#25163;&#21160;&#25191;&#34892;&#36825;&#20010; task &#25165;&#20250;&#26377;&#25928;&#26524;&#12290;&#36825;&#26159;&#20026;&#20102;&#26041;&#20415;&#23548;&#20986; jar &#21253;</span>
<span style="color: #228b22;">task</span> <span style="color: #0000ff;">copyJars</span><span style="color: #707183;">(</span>type: Copy<span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25351;&#26126;&#25105;&#20204;&#23548;&#20986;&#30340;&#26159; compile &#21644; test &#25152;&#20381;&#36182;&#30340; jar &#21253;</span>
  <span style="color: #228b22;">from</span> configurations.<span style="color: #a0522d;">compile</span>, configurations.<span style="color: #228b22;">testCompile</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25351;&#26126;&#23548;&#20986;&#21040; "lib" &#25991;&#20214;&#22841;&#19979;</span>
  <span style="color: #a0522d;">into</span> <span style="color: #8b2252;">"lib"</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
第二步，配置 web.xml，加入 spring 和 mvc 支持
</p>
<div class="org-src-container">

<pre class="src src-xml"><span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#22914;&#26524;&#20351;&#29992; RESTful &#39118;&#26684;&#30340;&#32534;&#31243;&#65292;&#38656;&#35201;&#21152;&#19978;&#36825;&#20010;&#36807;&#28388;&#22120; </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#23427;&#33021;&#20351;&#24471; FORM &#25552;&#20132;&#25903;&#25345; PUT/DELETE &#31561;&#26041;&#27861; </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #0000ff;">filter</span>&gt;
  &lt;<span style="color: #0000ff;">filter-name</span>&gt;forRESTful&lt;/<span style="color: #0000ff;">filter-name</span>&gt;
  &lt;<span style="color: #0000ff;">filter-class</span>&gt;org.springframework.web.filter.HiddenHttpMethodFilter&lt;/<span style="color: #0000ff;">filter-class</span>&gt;
&lt;/<span style="color: #0000ff;">filter</span>&gt;
&lt;<span style="color: #0000ff;">filter-mapping</span>&gt;
  &lt;<span style="color: #0000ff;">filter-name</span>&gt;forRESTful&lt;/<span style="color: #0000ff;">filter-name</span>&gt;
  &lt;<span style="color: #0000ff;">servlet-name</span>&gt;springmvc&lt;/<span style="color: #0000ff;">servlet-name</span>&gt;
&lt;/<span style="color: #0000ff;">filter-mapping</span>&gt;


<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#37197;&#32622; SpringMVC &#30340; DispatcherServlet  context (child) </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#23427;&#20250;&#20026; SpringMVC &#21019;&#24314;&#19968;&#20010;&#29420;&#31435;&#30340;&#23481;&#22120; </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#22914;&#26524;&#20351;&#29992; SpringMVC&#65292;&#36825;&#37324;&#24517;&#39035;&#35201;&#37197;&#32622; </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#23427;&#30340;&#29238;&#23481;&#22120;&#26159;&#19979;&#38754;&#37197;&#32622;&#30340; root Context </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#21487;&#20197;&#22312; init-param &#20013;&#25351;&#23450;&#37197;&#32622;&#25991;&#20214;&#36335;&#24452;&#65292;&#22914;&#26524;&#19981;&#37197;&#32622;&#65292;&#40664;&#35748;&#26159; "WEB-INF/miniblog-servlet.xml" </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #0000ff;">servlet</span>&gt;
  &lt;<span style="color: #0000ff;">servlet-name</span>&gt;springmvc&lt;/<span style="color: #0000ff;">servlet-name</span>&gt;
  &lt;<span style="color: #0000ff;">servlet-class</span>&gt;org.springframework.web.servlet.DispatcherServlet&lt;/<span style="color: #0000ff;">servlet-class</span>&gt;
  &lt;<span style="color: #0000ff;">init-param</span>&gt;
    &lt;<span style="color: #0000ff;">param-name</span>&gt;contextConfigLocation&lt;/<span style="color: #0000ff;">param-name</span>&gt;
    &lt;<span style="color: #0000ff;">param-value</span>&gt;classpath:spring-miniblog.xml&lt;/<span style="color: #0000ff;">param-value</span>&gt;
  &lt;/<span style="color: #0000ff;">init-param</span>&gt;
  &lt;<span style="color: #0000ff;">load-on-start</span>&gt;1&lt;/<span style="color: #0000ff;">load-on-start</span>&gt;
&lt;/<span style="color: #0000ff;">servlet</span>&gt;
&lt;<span style="color: #0000ff;">servlet-mapping</span>&gt;
  &lt;<span style="color: #0000ff;">servlet-name</span>&gt;springmvc&lt;/<span style="color: #0000ff;">servlet-name</span>&gt;
  &lt;<span style="color: #0000ff;">url-pattern</span>&gt;/&lt;/<span style="color: #0000ff;">url-pattern</span>&gt;
&lt;/<span style="color: #0000ff;">servlet-mapping</span>&gt;


<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#37197;&#32622; spring &#30340; root application context (parent) </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#21019;&#24314;&#19968;&#20010;&#26681;&#23481;&#22120; </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#22914;&#26524;&#21482;&#26159;&#20351;&#29992; SpringMVC &#20294;&#19981;&#20351;&#29992; Spring &#20854;&#20182;&#21151;&#33021;&#65292;&#36825;&#37324;&#21487;&#20197;&#19981;&#37197;&#32622; </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#22312;&#36825;&#20010;&#23481;&#22120;&#37324;&#65292;&#37197;&#32622;&#19968;&#20123;&#20840;&#23616;&#30340;&#19996;&#35199; </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#27604;&#22914; dao/service &#30340;&#20381;&#36182;&#65292;&#25968;&#25454;&#28304;&#65292;sessionFactory&#65292;&#22768;&#26126;&#24335;&#20107;&#21153;&#20043;&#31867; </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#21487;&#20197;&#36890;&#36807; context-param &#25351;&#23450;&#37197;&#32622;&#25991;&#20214;&#36335;&#24452;&#65292;&#22914;&#26524;&#19981;&#25351;&#23450;&#65292;&#40664;&#35748;&#26159; "WEB-INF/applicationContext.xml" </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #0000ff;">listener</span>&gt;
  &lt;<span style="color: #0000ff;">listener-class</span>&gt;org.springframework.web.context.ContextLoaderListener&lt;/<span style="color: #0000ff;">listener-class</span>&gt;
&lt;/<span style="color: #0000ff;">listener</span>&gt;
&lt;<span style="color: #0000ff;">context-param</span>&gt;
  &lt;<span style="color: #0000ff;">param-name</span>&gt;contextConfigLocation&lt;/<span style="color: #0000ff;">param-name</span>&gt;
  &lt;<span style="color: #0000ff;">param-value</span>&gt;classpath:spring-root.xml&lt;/<span style="color: #0000ff;">param-value</span>&gt;
&lt;/<span style="color: #0000ff;">context-param</span>&gt;
</pre>
</div>

<p>
第三步，配置 SpringMVC 的 context 文件(spring-miniblog.xml):
</p>
<div class="org-src-container">

<pre class="src src-xml"><span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#27880;&#24847;&#65292;&#35201;&#24341;&#20837;&#27491;&#30830;&#30340;&#21629;&#21517;&#31354;&#38388;&#65281;&#65281;&#65281; </span><span style="color: #b22222;">--&gt;</span>

<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> mvc &#29256;&#26412;&#30340; context:annotation-driven </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#38024;&#23545; mvc &#22686;&#21152;&#20102;&#19968;&#20123;&#20854;&#20182;&#25903;&#25345;&#65292;&#38656;&#35201;&#24320;&#21551; </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">annotation-driven</span> /&gt;

<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#37197;&#32622;&#25195;&#25551;&#21457;&#29616;&#25152;&#26377;&#20855;&#26377; @Controller &#27880;&#35299;&#30340;&#31867;&#65292;&#21152;&#36733;&#21040;&#23481;&#22120; </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#27880;&#24847;&#65292;&#22312; SpringMVC &#30340;&#37197;&#32622;&#25991;&#20214;&#20013;&#65292;&#19981;&#35201;&#25195;&#25551; @Controller &#20043;&#22806;&#30340;&#31867; </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #483d8b;">context</span>:<span style="color: #0000ff;">component-scan</span> <span style="color: #a0522d;">base-package</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">app.controller</span><span style="color: #8b2252;">"</span> /&gt;

<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#37197;&#32622;&#38745;&#24577;&#36164;&#28304;&#30340;&#35775;&#38382;&#26144;&#23556; </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#27604;&#22914;&#35775;&#38382; http://localhost/js/jquery.js&#65292;mvc &#23558;&#20250;&#21435;&#23547;&#25214; /assets/javascript/jquery.js </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">resources</span> <span style="color: #a0522d;">mapping</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">/js/**</span><span style="color: #8b2252;">"</span>  <span style="color: #a0522d;">location</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">/assets/javascript/</span><span style="color: #8b2252;">"</span> /&gt;
&lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">resources</span> <span style="color: #a0522d;">mapping</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">/css/**</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">location</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">/assets/stylesheet/</span><span style="color: #8b2252;">"</span> /&gt;


<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#37197;&#32622;&#35270;&#22270;&#35299;&#26512;&#22120;&#65292;&#23558; Controller &#36820;&#22238;&#30340;&#23383;&#31526;&#20018;&#32452;&#32455;&#25104;&#20840;&#36335;&#24452; </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">viewResolver</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.web.servlet.view.InternalResourceViewResolver</span><span style="color: #8b2252;">"</span>&gt;
  &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">prefix</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">/WEB-INF/view/</span><span style="color: #8b2252;">"</span> /&gt;
  &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">suffix</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">.jsp</span><span style="color: #8b2252;">"</span> /&gt;
&lt;/<span style="color: #0000ff;">bean</span>&gt;

<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#37197;&#32622;&#36164;&#28304;&#25991;&#20214;&#65292;&#22914;&#19979;&#37197;&#32622;&#65292;&#36164;&#28304;&#25991;&#20214;&#21017;&#20026; resource &#25991;&#20214;&#22841;&#19979;&#30340; message*.properties &#25110; message*.xml </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#27880;&#24847;&#65292;&#35201;&#25226;&#36164;&#28304;&#25991;&#20214;&#20445;&#23384;&#25104; UTF-8 &#26684;&#24335;&#65292;&#21542;&#21017;&#65292;&#38656;&#35201;&#22312;&#36825;&#37324;&#36890;&#36807; defaultEncoding &#25351;&#23450;&#32534;&#30721; </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">messageSource</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.context.support.ReloadableResourceBundleMessageSource</span><span style="color: #8b2252;">"</span>&gt;
  &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">basename</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">message</span><span style="color: #8b2252;">"</span> /&gt;
  &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">defaultEncoding</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">GBK</span><span style="color: #8b2252;">"</span> /&gt;
&lt;/<span style="color: #0000ff;">bean</span>&gt;

<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#26681;&#25454;&#38656;&#35201;&#65292;&#36824;&#21487;&#20197;&#22312;&#36825;&#20010;&#37197;&#32622;&#25991;&#20214;&#37324;&#37197;&#32622;&#25318;&#25130;&#22120;&#12289;&#36716;&#25442;&#26381;&#21153;&#31561; </span><span style="color: #b22222;">--&gt;</span>
</pre>
</div>

<p>
第四步，如果需要建立根容器，配置根容器的 context 文件(spring-root.xml):
</p>
<div class="org-src-container">

<pre class="src src-xml"><span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#21551;&#29992;&#27880;&#35299;&#65292;&#35753; spring &#22312;&#21152;&#36733;&#30340;&#26102;&#20505;&#33258;&#21160;&#25195;&#25551;&#25351;&#23450;&#21253; </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#36825;&#26679;&#20250;&#23558;&#21547;&#26377; @Service/@Repository/@Component &#31561;&#27880;&#35299;&#30340;&#31867;&#22312;&#23481;&#22120;&#20013;&#23454;&#20363;&#21270; </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #483d8b;">context</span>:<span style="color: #0000ff;">component-scan</span> <span style="color: #a0522d;">base-package</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">fish.miniblog.service, fish.miniblog.dao</span><span style="color: #8b2252;">"</span> /&gt;


<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#20351;&#29992;&#22806;&#37096;&#30340; properties &#25991;&#20214; </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#25105;&#20204;&#19968;&#33324;&#20250;&#23558;&#32463;&#24120;&#35201;&#25913;&#21160;&#30340;&#19968;&#20123;&#21442;&#25968;&#25552;&#21462;&#20986;&#26469;&#25918;&#21040;&#22806;&#37096; </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #483d8b;">context</span>:<span style="color: #0000ff;">property-placeholder</span> <span style="color: #a0522d;">location</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">classpath:db.properties</span><span style="color: #8b2252;">"</span> /&gt;


<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#37197;&#32622; Hibernate &#30340; Sessionfactory </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">sessionFactory</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.orm.hibernate5.LocalSessionFactoryBean</span><span style="color: #8b2252;">"</span>&gt;
  &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">dataSource</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">com.mchange.v2.c3p0.ComboPooledDataSource</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">destroy-method</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">close</span><span style="color: #8b2252;">"</span>&gt;
      &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">user</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">${user}</span><span style="color: #8b2252;">"</span> /&gt;
      &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">password</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">${password}</span><span style="color: #8b2252;">"</span> /&gt;
      &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">jdbcUrl</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">${url}</span><span style="color: #8b2252;">"</span> /&gt;
      &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">driverClass</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">${driver}</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;/<span style="color: #0000ff;">bean</span>&gt;
  &lt;/<span style="color: #0000ff;">property</span>&gt;
  &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">hibernateProperties</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">props</span>&gt;
      &lt;<span style="color: #0000ff;">prop</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">hibernate.show_sql</span><span style="color: #8b2252;">"</span>&gt;true&lt;/<span style="color: #0000ff;">prop</span>&gt;
      &lt;<span style="color: #0000ff;">prop</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">hibernate.format_sql</span><span style="color: #8b2252;">"</span>&gt;true&lt;/<span style="color: #0000ff;">prop</span>&gt;
      &lt;<span style="color: #0000ff;">prop</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">hibernate.hbm2ddl.auto</span><span style="color: #8b2252;">"</span>&gt;update&lt;/<span style="color: #0000ff;">prop</span>&gt;
      &lt;<span style="color: #0000ff;">prop</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">hibernate.dialect</span><span style="color: #8b2252;">"</span>&gt;${dialect}&lt;/<span style="color: #0000ff;">prop</span>&gt;
    &lt;/<span style="color: #0000ff;">props</span>&gt;
  &lt;/<span style="color: #0000ff;">property</span>&gt;
  &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">packagesToScan</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">fish.miniblog.model</span><span style="color: #8b2252;">"</span> /&gt;
&lt;/<span style="color: #0000ff;">bean</span>&gt;


<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#37197;&#32622;&#20107;&#21153;&#31649;&#29702;&#22120; </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">transactionManager</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.orm.hibernate5.HibernateTransactionManager</span><span style="color: #8b2252;">"</span>&gt;
  &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">sessionFactory</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">ref</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">sessionFactory</span><span style="color: #8b2252;">"</span>/&gt;
&lt;/<span style="color: #0000ff;">bean</span>&gt;


<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#24320;&#21551;&#20107;&#21153;&#30456;&#20851;&#30340;&#27880;&#35299; </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#28982;&#21518;&#65292;&#23601;&#21487;&#20197;&#22312; Service &#30456;&#20851;&#30340;&#31867;&#25110;&#26041;&#27861;&#19978;&#36890;&#36807; @Transactional &#24320;&#21551;&#20107;&#21153;&#25903;&#25345;&#20102; </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #483d8b;">tx</span>:<span style="color: #0000ff;">annotation-driven</span> <span style="color: #a0522d;">proxy-target-class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">true</span><span style="color: #8b2252;">"</span>/&gt;
</pre>
</div>

<p>
第五步，建立 Controller，进行测试
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #008b8b;">@Controller</span>
<span style="color: #008b8b;">@RequestMapping</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/users"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">UserController</span> <span style="color: #707183;">{</span>

    <span style="color: #008b8b;">@RequestMapping</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"/{name}"</span><span style="color: #7388d6;">)</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">show</span><span style="color: #7388d6;">(</span><span style="color: #008b8b;">@PathVariable</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span>, <span style="color: #228b22;">Model</span> <span style="color: #a0522d;">model</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        model.add<span style="color: #909183;">(</span><span style="color: #8b2252;">"name"</span>, name<span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"show"</span>;    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36820;&#22238;&#30340;&#26159; "/WEB-INF/view/show.jsp" &#39029;&#38754;</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Parameters</h3>
<div class="outline-text-3" id="text-2-2">
</div><div id="outline-container-sec-2-2-1" class="outline-4">
<h4 id="sec-2-2-1"><span class="section-number-4">2.2.1</span> 基本类型的自动绑定</h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
会根据 handler 参数列表中的字段名字，自动绑定数据
</p>

<p>
如果参数没有被赋值，默认会尝试将 null 赋予它。所以对于一些 int 之类的类型，会抛出 IllegalStateException 异常。
</p>
</div>
</div>

<div id="outline-container-sec-2-2-2" class="outline-4">
<h4 id="sec-2-2-2"><span class="section-number-4">2.2.2</span> 集合类型的自动绑定</h4>
</div>
<div id="outline-container-sec-2-2-3" class="outline-4">
<h4 id="sec-2-2-3"><span class="section-number-4">2.2.3</span> 对象的自动封装</h4>
<div class="outline-text-4" id="text-2-2-3">
<div class="org-src-container">

<pre class="src src-html"><span style="color: #b22222;">&lt;!-- </span><span style="color: #b22222;">form </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #0000ff;">form</span> <span style="color: #a0522d;">action</span>=<span style="color: #8b2252;">"/greeting"</span>&gt;
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"name"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#35831;&#36755;&#20837;&#21517;&#23383;"</span> /&gt;
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"age"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#35831;&#36755;&#20837;&#24180;&#40836;"</span> /&gt;
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"submit"</span>&gt;
&lt;/<span style="color: #0000ff;">form</span>&gt;
</pre>
</div>

<div class="org-src-container">

<pre class="src src-java"><span style="color: #b22222;">// </span><span style="color: #b22222;">handler</span>
<span style="color: #008b8b;">@RequestMapping</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/greeting"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">greeting</span><span style="color: #707183;">(</span><span style="color: #228b22;">User</span> <span style="color: #a0522d;">user</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"greeting"</span>;
<span style="color: #707183;">}</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">model</span>
<span style="color: #228b22;">Class</span> <span style="color: #a0522d;">User</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">age</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-2-4" class="outline-4">
<h4 id="sec-2-2-4"><span class="section-number-4">2.2.4</span> HttpSession/HttpServletRequest 等的自动绑定</h4>
<div class="outline-text-4" id="text-2-2-4">
<pre class="example">
public String greeting(HttpServletRequest r, HttpSession s)
</pre>
</div>
</div>

<div id="outline-container-sec-2-2-5" class="outline-4">
<h4 id="sec-2-2-5"><span class="section-number-4">2.2.5</span> @RequestParam</h4>
<div class="outline-text-4" id="text-2-2-5">
<p>
定制入参的名字和默认值等
</p>
<pre class="example">
public String greeting(@RequestParam(name = "username", defaultValue = "xyz") String name)
</pre>
</div>
</div>

<div id="outline-container-sec-2-2-6" class="outline-4">
<h4 id="sec-2-2-6"><span class="section-number-4">2.2.6</span> @RequestAttribute</h4>
<div class="outline-text-4" id="text-2-2-6">
<p>
将 request 的某个 Attribute 值，赋予 handler 参数
</p>
<pre class="example">
public String greeting(@RequestAttribute(name = "name") String name)
</pre>
</div>
</div>

<div id="outline-container-sec-2-2-7" class="outline-4">
<h4 id="sec-2-2-7"><span class="section-number-4">2.2.7</span> @CookieValue</h4>
<div class="outline-text-4" id="text-2-2-7">
<p>
用来绑定 cookie 中的值
</p>
</div>
</div>

<div id="outline-container-sec-2-2-8" class="outline-4">
<h4 id="sec-2-2-8"><span class="section-number-4">2.2.8</span> @RequestHeader</h4>
<div class="outline-text-4" id="text-2-2-8">
<p>
绑定 http 请求头部的信息到参数中
</p>
<pre class="example">
public String greeting(@RequestHeader(name = "user-agent") String ua)
</pre>
</div>
</div>

<div id="outline-container-sec-2-2-9" class="outline-4">
<h4 id="sec-2-2-9"><span class="section-number-4">2.2.9</span> @PathVariable</h4>
<div class="outline-text-4" id="text-2-2-9">
<p>
绑定 url 中匹配的串到参数中，用 {} 匹配
</p>
<pre class="example">
@RequestMapping("/greeting/{id}")
public String greeting(@PathVariable int id)
</pre>
</div>
</div>

<div id="outline-container-sec-2-2-10" class="outline-4">
<h4 id="sec-2-2-10"><span class="section-number-4">2.2.10</span> @RequestBody</h4>
<div class="outline-text-4" id="text-2-2-10">
<p>
将 http 请求 body 里的数据自动转换并绑定到参数。
</p>
</div>
</div>

<div id="outline-container-sec-2-2-11" class="outline-4">
<h4 id="sec-2-2-11"><span class="section-number-4">2.2.11</span> @ResponseBody</h4>
<div class="outline-text-4" id="text-2-2-11">
<p>
忽略头部，直接将内容作为响应体返回。
</p>

<p>
示例：
</p>

<div class="org-src-container">

<pre class="src src-js">$<span style="color: #707183;">(</span><span style="color: #8b2252;">"#showmsg"</span><span style="color: #707183;">)</span>.click<span style="color: #707183;">(</span><span style="color: #a020f0;">function</span> <span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
    d = <span style="color: #909183;">{</span><span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"xiaohui"</span>, <span style="color: #8b2252;">"age"</span>: 9<span style="color: #909183;">}</span>;
    $.ajax<span style="color: #909183;">(</span><span style="color: #709870;">{</span>
        method: <span style="color: #8b2252;">'post'</span>,
        url: <span style="color: #8b2252;">'/greeting'</span>,
        data: JSON.stringify<span style="color: #907373;">(</span>d<span style="color: #907373;">)</span>,
        contentType: <span style="color: #8b2252;">'application/json'</span>,
        <span style="color: #0000ff;">success</span>: <span style="color: #a020f0;">function</span> <span style="color: #907373;">(</span><span style="color: #a0522d;">o</span><span style="color: #907373;">)</span> <span style="color: #907373;">{</span>
            console.log<span style="color: #6276ba;">(</span>o<span style="color: #6276ba;">)</span>;  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#24471;&#21040;&#30340;&#26159; json &#23545;&#35937;</span>
            alert<span style="color: #6276ba;">(</span>eee.age<span style="color: #6276ba;">)</span>;
            alert<span style="color: #6276ba;">(</span>eee.name<span style="color: #6276ba;">)</span>;
        <span style="color: #907373;">}</span>
    <span style="color: #709870;">}</span><span style="color: #909183;">)</span>;
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;
</pre>
</div>

<p>
UserController:
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #008b8b;">@RequestMapping</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/greeting"</span><span style="color: #707183;">)</span>
<span style="color: #008b8b;">@ResponseBody</span>
<span style="color: #a020f0;">public</span> <span style="color: #228b22;">User</span> <span style="color: #0000ff;">greeting</span><span style="color: #707183;">(</span><span style="color: #008b8b;">@RequestBody</span> <span style="color: #228b22;">User</span> <span style="color: #a0522d;">user</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
    System.out.println<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#21448;&#36807;&#20102;&#19968;&#20010;&#26032;&#24180;&#65281;"</span><span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">age</span> = user.getAge<span style="color: #7388d6;">()</span>;
    user.setAge<span style="color: #7388d6;">(</span>age + 1<span style="color: #7388d6;">)</span>;
    <span style="color: #a020f0;">return</span> user;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-2-12" class="outline-4">
<h4 id="sec-2-2-12"><span class="section-number-4">2.2.12</span> @SessionAttribute</h4>
</div>
<div id="outline-container-sec-2-2-13" class="outline-4">
<h4 id="sec-2-2-13"><span class="section-number-4">2.2.13</span> @ModelAttribute</h4>
</div>
<div id="outline-container-sec-2-2-14" class="outline-4">
<h4 id="sec-2-2-14"><span class="section-number-4">2.2.14</span> Errors/BindingResult</h4>
<div class="outline-text-4" id="text-2-2-14">
<p>
用来绑定出错的信息
</p>
</div>
</div>

<div id="outline-container-sec-2-2-15" class="outline-4">
<h4 id="sec-2-2-15"><span class="section-number-4">2.2.15</span> Model/View/ModelAndView</h4>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> 请求流程</h3>
<div class="outline-text-3" id="text-2-3">
<p>
当请求被 DispatcherServlet 拦截，会在 doService 里面完成所有的处理逻辑。
</p>

<p>
处理的大致流程是这样的：
</p>
<ol class="org-ol">
<li>预处理
</li>
<li>根据请求的 URL 通过 HandlerMapping 获取匹配的 Controller 和 handler
</li>
<li>创建 ModelAndView 对象，这个对象将会保存所有的模型数据，还会持有页面展现相关的信息
<pre class="example">
ModelAndView mv = null
</pre>
</li>
<li>调用相应的 handler 方法，将结果封装成 ModelAndView 赋值给 mv。
</li>
<li>调用 render 方法，将 Model 里的数据渲染到 View 视图里
</li>
<li>清理工作
</li>
</ol>

<p>
所以我们需要明白，我们的 handler 最终产生的应该是一个保存了数据和视图的 ModelAndView。
即使我们的 handler 返回类型是字符串或其他，到最后还是被封装成了 ModelAndView。
</p>

<p>
而且在封装 ModelAndView 时，会将 handler 参数列表上的数据自动添加到里面。
</p>

<p>
我们可以在 jsp 里，对 ModelAndView 里的所有数据通过 el 表达式或 spring 标签进行获取。
</p>
</div>
</div>

<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> Validation(表单验证)</h3>
<div class="outline-text-3" id="text-2-4">
<p>
三种方法：
</p>
</div>
<div id="outline-container-sec-2-4-1" class="outline-4">
<h4 id="sec-2-4-1"><span class="section-number-4">2.4.1</span> 最基本的校验</h4>
<div class="outline-text-4" id="text-2-4-1">
<p>
几个重要的概念
</p>
<ul class="org-ul">
<li>一个接口 Errors/BindingResult，用来保存绑定错误信息。
</li>
<li>两个方法 errors.reject() / errors.rejectValue()，用来注册全局/字段级别的错误信息
</li>
<li>一个标签 &lt;form:errors path="*" /&gt;
</li>
</ul>

<p>
例子，首先，在页面上：
</p>
<div class="org-src-container">

<pre class="src src-html">&lt;<span style="color: #483d8b;">form</span>:<span style="color: #0000ff;">form</span> <span style="color: #a0522d;">action</span>=<span style="color: #8b2252;">"/users/create"</span> <span style="color: #a0522d;">modelAttribute</span>=<span style="color: #8b2252;">"user"</span>&gt;
  &lt;<span style="color: #0000ff;">ul</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"errorTip"</span>&gt;
    &lt;<span style="color: #483d8b;">form</span>:<span style="color: #0000ff;">errors</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"*"</span> <span style="color: #a0522d;">cssClass</span>=<span style="color: #8b2252;">"error"</span> <span style="color: #a0522d;">element</span>=<span style="color: #8b2252;">"li"</span> /&gt;
  &lt;/<span style="color: #0000ff;">ul</span>&gt;
  &lt;<span style="color: #0000ff;">div</span>&gt;
    &lt;<span style="color: #483d8b;">form</span>:<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"name"</span> /&gt;
    &lt;<span style="color: #483d8b;">form</span>:<span style="color: #0000ff;">errors</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"name"</span> <span style="color: #a0522d;">cssClass</span>=<span style="color: #8b2252;">"error"</span> <span style="color: #a0522d;">element</span>=<span style="color: #8b2252;">"div"</span> /&gt;
  &lt;/<span style="color: #0000ff;">div</span>&gt;
  &lt;<span style="color: #0000ff;">div</span>&gt;
    &lt;<span style="color: #483d8b;">form</span>:<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"number"</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"age"</span> /&gt;
    &lt;<span style="color: #483d8b;">form</span>:<span style="color: #0000ff;">errors</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"age"</span> <span style="color: #a0522d;">cssClass</span>=<span style="color: #8b2252;">"error"</span> <span style="color: #a0522d;">element</span>=<span style="color: #8b2252;">"p"</span> /&gt;
  &lt;/<span style="color: #0000ff;">div</span>&gt;
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"submit"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"&#27880;&#20876;"</span> /&gt;
&lt;/<span style="color: #483d8b;">form</span>:<span style="color: #0000ff;">form</span>&gt;
</pre>
</div>

<p>
然后，可以在 Controller 中的 handler 里进行校验，添加错误信息
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #008b8b;">@Controller</span>
<span style="color: #008b8b;">@RequestMapping</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/users"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">UserController</span> <span style="color: #707183;">{</span>

    <span style="color: #008b8b;">@RequestMapping</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"/create"</span><span style="color: #7388d6;">)</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">create</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">User</span> <span style="color: #a0522d;">user</span>, <span style="color: #228b22;">Errors</span> <span style="color: #a0522d;">errors</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26657;&#39564;&#21517;&#23383;</span>
        <span style="color: #a020f0;">if</span><span style="color: #909183;">(</span>user.getName<span style="color: #709870;">()</span> == <span style="color: #008b8b;">null</span> || empty<span style="color: #709870;">(</span>user.getName<span style="color: #907373;">()</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            errors.rejectValue<span style="color: #709870;">(</span><span style="color: #8b2252;">"name"</span>, <span style="color: #008b8b;">null</span>, <span style="color: #8b2252;">"&#21517;&#23383;&#19981;&#33021;&#20026;&#31354;"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26657;&#39564;&#24180;&#40836;</span>
        <span style="color: #a020f0;">if</span><span style="color: #909183;">(</span>user.getAge<span style="color: #709870;">()</span> &lt; 18<span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            errors.rejectValue<span style="color: #709870;">(</span><span style="color: #8b2252;">"age"</span>, <span style="color: #008b8b;">null</span>, <span style="color: #8b2252;">"&#24180;&#40836;&#22826;&#23567;&#20102;&#65292;18R"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20840;&#23616;&#26816;&#39564;&#30340;&#20363;&#23376;</span>
        <span style="color: #a020f0;">if</span><span style="color: #909183;">(</span>user.getName<span style="color: #709870;">()</span>.equals<span style="color: #709870;">(</span><span style="color: #8b2252;">"admin"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            errors.reject<span style="color: #709870;">(</span><span style="color: #008b8b;">null</span>, <span style="color: #8b2252;">"&#20320;&#26159;&#35841;&#65311;"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>


        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524;&#26377;&#26657;&#39564;&#38169;&#35823;&#65292;&#36820;&#22238;&#30456;&#24212;&#38169;&#35823;&#39029;&#38754;</span>
        <span style="color: #a020f0;">if</span><span style="color: #909183;">(</span>errors.hasErrors<span style="color: #709870;">()</span><span style="color: #909183;">)</span>
            <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"regist"</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524;&#27809;&#26377;&#38169;&#35823;&#65292;&#36820;&#22238;&#30340;&#39029;&#38754;</span>
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"greeting"</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
这样，就可以了。这种方法是基于 handler 的，优点是定义方便，缺点是不便于复用。
</p>
</div>
</div>

<div id="outline-container-sec-2-4-2" class="outline-4">
<h4 id="sec-2-4-2"><span class="section-number-4">2.4.2</span> 自定义验证器</h4>
<div class="outline-text-4" id="text-2-4-2">
<p>
首先，自定义我们的验证器，只需要实现 Validator 接口即可。
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">UserValidator</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">Validator</span> <span style="color: #707183;">{</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#35201;&#26469;&#26657;&#39564;&#39564;&#35777;&#30340;&#31867;</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">boolean</span> <span style="color: #0000ff;">supports</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">Class</span><span style="color: #909183;">&lt;</span>?<span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">clazz</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> clazz.equals<span style="color: #909183;">(</span>User.<span style="color: #a020f0;">class</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20889;&#25105;&#20204;&#30340;&#26657;&#39564;&#36923;&#36753;&#65292;&#25226;&#30456;&#20851;&#38169;&#35823;&#27880;&#20876;&#21040; errors &#37324;&#38754;</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">validate</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">Object</span> <span style="color: #a0522d;">target</span>, <span style="color: #228b22;">Errors</span> <span style="color: #a0522d;">errors</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">User</span> <span style="color: #a0522d;">user</span> = <span style="color: #909183;">(</span><span style="color: #228b22;">User</span><span style="color: #909183;">)</span> target;
        <span style="color: #a020f0;">if</span><span style="color: #909183;">(</span>user.getName<span style="color: #709870;">()</span> == <span style="color: #008b8b;">null</span> || user.getName<span style="color: #709870;">()</span>.length<span style="color: #709870;">()</span> &lt; 3<span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            errors.rejectValue<span style="color: #709870;">(</span><span style="color: #8b2252;">"name"</span>, <span style="color: #008b8b;">null</span>, <span style="color: #8b2252;">"&#21517;&#23383;&#19981;&#33021;&#20026;&#31354;&#65292;&#32780;&#19988;&#24517;&#39035;&#35201;&#22823;&#20110; 3 &#20301;"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #a020f0;">if</span><span style="color: #909183;">(</span>user.getAge<span style="color: #709870;">()</span> &lt; 18 <span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            errors.rejectValue<span style="color: #709870;">(</span><span style="color: #8b2252;">"age"</span>, <span style="color: #008b8b;">null</span>, <span style="color: #8b2252;">"&#24180;&#40836;&#24517;&#39035;&#35201;&#22823;&#20110; 18 &#23681;&#21734;"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
其次，需要注册我们的验证器。
</p>

<p>
可以注册到当前的 Controller 里面，
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#25918;&#21040; Controller &#37324;&#38754;&#65292;&#36825;&#26679;&#20250;&#22312; handler &#25191;&#34892;&#20043;&#21069;&#34987;&#25191;&#34892;</span>
<span style="color: #008b8b;">@InitBinder</span>
<span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">init</span> <span style="color: #707183;">(</span><span style="color: #228b22;">DataBinder</span> <span style="color: #a0522d;">binder</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
    binder.setValidator<span style="color: #7388d6;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">UserValidator</span><span style="color: #909183;">()</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
也可以在 spring-mvc.xml 配置里注册成全局的验证器。
</p>
<div class="org-src-container">

<pre class="src src-xml">&lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">annotation-driven</span> <span style="color: #a0522d;">validator</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">userValidator</span><span style="color: #8b2252;">"</span> /&gt;
&lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">userValidator</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">fish.miniblog.validator.UserValidator</span><span style="color: #8b2252;">"</span> /&gt;
</pre>
</div>

<p>
最后，就可以在所需要验证的参数前面加上 @Validated 注解，来实现参数的自动校验了。
</p>
</div>
</div>

<div id="outline-container-sec-2-4-3" class="outline-4">
<h4 id="sec-2-4-3"><span class="section-number-4">2.4.3</span> JSR-303 风格校验</h4>
<div class="outline-text-4" id="text-2-4-3">
<p>
JSR-303 是 java 官方推出的一套 Validation 接口。
</p>

<p>
hibernate 给出了一个完整实现。
</p>

<p>
首先，如果想使用 JSR-303 的校验风格，需要引入相应的包：
</p>
<pre class="example">
complie "org.hibernate:hibernate-validator:5.4.0.Final"
</pre>

<p>
其次，添加我们的验证逻辑。需要在我们的 model bean 上添加相关注解：
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">User</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@NotNull</span>
    <span style="color: #008b8b;">@Size</span><span style="color: #7388d6;">(</span>min = 3, max = 10<span style="color: #7388d6;">)</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span>;

    <span style="color: #008b8b;">@Range</span><span style="color: #7388d6;">(</span>min = 10, max = 100<span style="color: #7388d6;">)</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">age</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
再次，要保证在我们的 spring-mvc.xml 中存在:
</p>
<pre class="example">
&lt;mvc:annotation-driven /&gt;
</pre>

<p>
最后，使用，只要在 Controller 的相关字段上添加 @Valid 注解即可。
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">create</span><span style="color: #707183;">(</span><span style="color: #008b8b;">@Valid</span> <span style="color: #228b22;">User</span> <span style="color: #a0522d;">user</span>, <span style="color: #228b22;">Errors</span> <span style="color: #a0522d;">errors</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20854;&#20182;&#30340;&#20351;&#29992;&#36319;&#19978;&#38754;&#26159;&#19968;&#33268;&#30340;.</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5"><span class="section-number-3">2.5</span> PropertyEditor/Convertor/Formater(日期转换为例)</h3>
<div class="outline-text-3" id="text-2-5">
</div><div id="outline-container-sec-2-5-1" class="outline-4">
<h4 id="sec-2-5-1"><span class="section-number-4">2.5.1</span> 第一种方法：利用内置的 CustomDateEditor</h4>
<div class="outline-text-4" id="text-2-5-1">
<p>
首先，在我们的 Controller 的 InitBinder 里面，注册 CustomEditor
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #008b8b;">@InitBinder</span>
<span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">init</span> <span style="color: #707183;">(</span><span style="color: #228b22;">WebDataBinder</span> <span style="color: #a0522d;">binder</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
    <span style="color: #228b22;">CustomDateEditor</span> <span style="color: #a0522d;">dateEditor</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">CustomDateEditor</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">SimpleDateFormat</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"yyyy-MM-dd"</span><span style="color: #909183;">)</span>, <span style="color: #008b8b;">true</span><span style="color: #7388d6;">)</span>;
    binder.registerCustomEditor<span style="color: #7388d6;">(</span>Date.<span style="color: #a020f0;">class</span>, dateEditor<span style="color: #7388d6;">)</span>;                                <span style="color: #88090B;">)</span>;
<span style="color: #88090B;">}</span>
</pre>
</div>

<p>
然后，就可以正常转换了。
</p>
</div>
</div>

<div id="outline-container-sec-2-5-2" class="outline-4">
<h4 id="sec-2-5-2"><span class="section-number-4">2.5.2</span> 第二种方法：实现自定义转换器</h4>
<div class="outline-text-4" id="text-2-5-2">
<p>
spring 3.0 之后，使用 converter
</p>

<div class="org-src-container">

<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyDateConverter</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">Converter</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">String</span>, <span style="color: #228b22;">Date</span><span style="color: #707183;">&gt;</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Date</span> <span style="color: #0000ff;">convert</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span> <span style="color: #a0522d;">datestr</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#33258;&#24049;&#21435;&#23454;&#29616;&#65292;&#23558;&#23383;&#31526;&#20018;&#36716;&#25442;&#20026; Date &#23545;&#35937;&#12290;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#27880;&#24847;&#32771;&#34385;&#24322;&#24120;&#22788;&#29702;&#31561;</span>
        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">null</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
然后需要在配置文件中注册转换器
</p>
<div class="org-src-container">

<pre class="src src-xml"><span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#37197;&#32622;&#25105;&#20204;&#23450;&#20041;&#30340;&#36716;&#25442;&#26381;&#21153; </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">annotation-driven</span> <span style="color: #a0522d;">conversion-service</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">myConversionService</span><span style="color: #8b2252;">"</span> /&gt;

<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#23450;&#20041;&#20840;&#23616;&#30340;&#36716;&#25442;&#26381;&#21153;&#65292;&#21487;&#20197;&#37197;&#32622;&#22810;&#20010;&#36716;&#25442;&#22120; </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#22312;&#36825;&#37324;&#65292;&#21482;&#37197;&#32622;&#20102;&#25105;&#20204;&#33258;&#23450;&#20041;&#30340;&#36716;&#25442;&#22120;&#65292;DateConverter </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">myConversionService</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.context.support.ConversionServiceFactoryBean</span><span style="color: #8b2252;">"</span>&gt;
  &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">converters</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">set</span>&gt;
      &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">fish.miniblog.converter.MyDateConverter</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;/<span style="color: #0000ff;">set</span>&gt;
  &lt;/<span style="color: #0000ff;">property</span>&gt;
&lt;/<span style="color: #0000ff;">bean</span>&gt;
</pre>
</div>

<p>
这样就可以了。所有的 yyyy-MM-yy 之类的字符串就可以正常转换成 Date 对象了。
</p>
</div>
</div>

<div id="outline-container-sec-2-5-3" class="outline-4">
<h4 id="sec-2-5-3"><span class="section-number-4">2.5.3</span> 第三种方法：使用 @DateTimeFormat 注解</h4>
<div class="outline-text-4" id="text-2-5-3">
<p>
在 model 上，增加相应注解：
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">User</span> <span style="color: #707183;">{</span>
  <span style="color: #008b8b;">@DateTimeFormat</span><span style="color: #7388d6;">(</span>pattern = <span style="color: #8b2252;">"yyyy-MM-dd"</span><span style="color: #7388d6;">)</span>
  <span style="color: #a020f0;">private</span> <span style="color: #228b22;">Date</span> <span style="color: #a0522d;">birthday</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
就可以了。
</p>

<p>
另外，如果想让返回的 JSON 对象中能够准确处理时间类型，需要用到 @JsonFormat 注解
</p>
</div>
</div>

<div id="outline-container-sec-2-5-4" class="outline-4">
<h4 id="sec-2-5-4"><span class="section-number-4">2.5.4</span> 日期在页面上的显示</h4>
<div class="outline-text-4" id="text-2-5-4">
<p>
暂缺。
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-6" class="outline-3">
<h3 id="sec-2-6"><span class="section-number-3">2.6</span> Exception(异常处理)</h3>
<div class="outline-text-3" id="text-2-6">
<p>
SpringMVC 中默认的异常处理器是 DefaultHandlerExceptionResolver，
但它只是简单粗暴地将异常栈在页面上进行显示。
在实际项目中这种处理是不合适的。
所以，我们需要自己定制我们自己的异常处理方式。
</p>

<p>
自定义异常，主要有下面两种方法：
</p>
</div>
<div id="outline-container-sec-2-6-1" class="outline-4">
<h4 id="sec-2-6-1"><span class="section-number-4">2.6.1</span> HandlerExceptionResolver</h4>
<div class="outline-text-4" id="text-2-6-1">
<p>
这是 SpringMVC 中所有异常处理器的总接口。
要实现自己的异常处理，就是要继承这个接口，实现自己的处理器：
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyExceptionResolver</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">HandlerExceptionResolver</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">ModelAndView</span> <span style="color: #0000ff;">resolveException</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">request</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">response</span>, <span style="color: #228b22;">Object</span> <span style="color: #a0522d;">handler</span>, <span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">ex</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>

        <span style="color: #228b22;">ModelAndView</span> <span style="color: #a0522d;">mv</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ModelAndView</span><span style="color: #909183;">()</span>;

        <span style="color: #a020f0;">if</span><span style="color: #909183;">(</span>ex <span style="color: #a020f0;">instanceof</span> MyException<span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            mv.addObject<span style="color: #709870;">(</span><span style="color: #8b2252;">"err"</span>, ex<span style="color: #709870;">)</span>;
            mv.setModelName<span style="color: #709870;">(</span><span style="color: #8b2252;">"error"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">else</span> <span style="color: #909183;">{</span>
            <span style="color: #b22222;">// </span><span style="color: #b22222;">... &#20854;&#20182;&#21508;&#31181;&#24773;&#20917;</span>
        <span style="color: #909183;">}</span>

        <span style="color: #a020f0;">return</span> mv;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
然后，在 springmvc.xml 中注册为 bean 即可。
</p>
<div class="org-src-container">

<pre class="src src-xml">&lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">fish.miniblog.MyExceptionResolver</span><span style="color: #8b2252;">"</span> /&gt;
</pre>
</div>


<p>
当然，如果每次异常处理都需要自己定义 ExceptionResovler，很麻烦。
所以，spring 给我们提供了一个简单的默认实现，SimpleMappingExceptionResolver。
如果需要，只需要在 springmvc.xml 中注册即可：
</p>
<div class="org-src-container">

<pre class="src src-xml">&lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.web.servlet.handler.SimpleMappingExceptionResolver</span><span style="color: #8b2252;">"</span>&gt;
  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#22914;&#26524;&#26377;&#24322;&#24120;&#65292;&#26368;&#21518;&#30001; error.jsp &#39029;&#38754;&#26469;&#26174;&#31034;&#38169;&#35823;&#20449;&#24687;  </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">defaultErrorView</span><span style="color: #8b2252;">"</span>   <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">error</span><span style="color: #8b2252;">"</span> /&gt;
  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#22312; error.jsp &#20013;&#65292;&#20351;&#29992; ${err} &#26469;&#33719;&#21462;&#24322;&#24120;&#20449;&#24687; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">exceptionAttribute</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">err</span><span style="color: #8b2252;">"</span> /&gt;

  &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">exceptionMappings</span><span style="color: #8b2252;">"</span>&gt;
    <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#26242;&#32570; </span><span style="color: #b22222;">--&gt;</span>
  &lt;/<span style="color: #0000ff;">property</span>&gt;
&lt;/<span style="color: #0000ff;">bean</span>&gt;
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-2-6-2" class="outline-4">
<h4 id="sec-2-6-2"><span class="section-number-4">2.6.2</span> @ExceptionHandler 注解</h4>
<div class="outline-text-4" id="text-2-6-2">
<p>
可以定义一个类似于普通 handler 的方法，添加 @ExceptionHandler 将其作为一个异常处理方法
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #008b8b;">@Controller</span>
<span style="color: #008b8b;">@ControllerAdvice</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">ExceptionController</span> <span style="color: #707183;">{</span>

    <span style="color: #008b8b;">@ExceptionHandler</span><span style="color: #7388d6;">(</span><span style="color: #909183;">{</span>YourException.<span style="color: #a020f0;">class</span><span style="color: #909183;">}</span><span style="color: #7388d6;">)</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">ModelAndView</span> <span style="color: #0000ff;">hahaha</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">ModelAndView</span> <span style="color: #a0522d;">mv</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ModelAndView</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"error"</span><span style="color: #909183;">)</span>;
        mv.addObject<span style="color: #909183;">(</span><span style="color: #8b2252;">"err"</span>, e<span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">return</span> mv;
    <span style="color: #7388d6;">}</span>

    <span style="color: #008b8b;">@ExceptionHandler</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">hahaha</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">MyException</span> <span style="color: #a0522d;">e</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"index"</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
默认只是 Controller 范围内有效的。
</p>

<p>
Spring 3 之后增加了一个 @ControllerAdvice 注解，作用在控制器上。
它会将其中所有的 @ExceptionHandler、@InitBinder、@ModelAttribute 等全局化。
</p>

<p>
所以，一般情况下，我们可以将所有 @ExceptionHandler 方法统一放置在一个加了 @ControllerAdvice 的控制器里，实现全局异常。
</p>

<p>
就酱紫，没什么好说的。
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-7" class="outline-3">
<h3 id="sec-2-7"><span class="section-number-3">2.7</span> Interceptor(拦截器)</h3>
<div class="outline-text-3" id="text-2-7">
<p>
拦截器主要用来增强 handler 方法
</p>

<p>
拦截器的接口有两个，定义拦截器就是实现他们之一
</p>
<ul class="org-ul">
<li>HandlerInterceptor      参数比较多，能够更全面控制拦截行为
</li>
<li>WebRequestInterceptor   针对 Web 请求精简了参数列表，主要用来控制 request/ModelAndView/Exception
</li>
</ul>

<p>
主要实现以下三个方法:
</p>
<ul class="org-ul">
<li>preHandler()       在执行 Controller 相应 handler 之前要执行
</li>
<li>postHandler()      执行完 handler，进入 render 页面渲染前的阶段执行
</li>
<li>afterCompletion()  所有的东西都做完，退出前执行。主要用来做一些清理工作
</li>
</ul>

<p>
下面是例子:
</p>

<p>
<b>定义</b>
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#23454;&#29616; HandlerInterceptor &#25509;&#21475;&#30340;&#24418;&#24335;</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyInterceptor</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">HandlerInterceptor</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">boolean</span> <span style="color: #0000ff;">preHandle</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">request</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">response</span>, <span style="color: #228b22;">Object</span> <span style="color: #a0522d;">handler</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22312;&#35843;&#29992; handler &#20043;&#21069;&#34987;&#35843;&#29992;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524;&#36820;&#22238; true&#65292;&#32487;&#32493;&#19979;&#38754;&#30340;&#27969;&#31243;&#65292;&#22914;&#26524;&#36820;&#22238; false&#65292;&#30452;&#25509;&#36339;&#36716;&#21040; afterComplete &#20013;&#27490;&#36816;&#34892;&#12290;</span>
        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">true</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">postHandle</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">request</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">response</span>, <span style="color: #228b22;">Object</span> <span style="color: #a0522d;">handler</span>, <span style="color: #228b22;">ModelAndView</span> <span style="color: #a0522d;">modelAndView</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22312;&#35843;&#29992;&#23436; handler &#24471;&#21040;&#23553;&#35013;&#22909;&#30340; ModelAndView &#20043;&#21518;&#65292;&#28210;&#26579;&#39029;&#38754;&#21069;&#34987;&#35843;&#29992;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22312;&#36825;&#37324;&#65292;&#21487;&#20197;&#23545; ModelAndView &#37324;&#30340;&#25968;&#25454;&#20316;&#20986;&#33258;&#24049;&#30340;&#20462;&#25913;&#31561;</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">afterCompletion</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">request</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">response</span>, <span style="color: #228b22;">Object</span> <span style="color: #a0522d;">handler</span>, <span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">ex</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22312;&#26368;&#21518;&#30340;&#28165;&#29702;&#38454;&#27573;&#34987;&#35843;&#29992;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22312;&#36825;&#37324;&#65292;&#36827;&#34892;&#21892;&#21518;&#25805;&#20316;&#12290;</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>


<span style="color: #b22222;">// </span><span style="color: #b22222;">&#23454;&#29616; WebRequestInterceptor &#25509;&#21475;&#30340;&#24418;&#24335;</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">HisInterceptor</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">WebRequestInterceptor</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">preHandle</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">WebRequest</span> <span style="color: #a0522d;">request</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"pre"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">postHandle</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">WebRequest</span> <span style="color: #a0522d;">request</span>, <span style="color: #228b22;">ModelMap</span> <span style="color: #a0522d;">model</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        System.out.println<span style="color: #909183;">(</span>model<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">afterCompletion</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">WebRequest</span> <span style="color: #a0522d;">request</span>, <span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">ex</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        System.out.println<span style="color: #909183;">(</span>ex<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
<b>注册</b>
</p>
<div class="org-src-container">

<pre class="src src-xml">&lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">interceptors</span>&gt;
  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#20840;&#23616;&#25318;&#25130;&#22120; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">fish.miniblog.interceptor.YourInterceptor</span><span style="color: #8b2252;">"</span> /&gt;
  &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">fish.miniblog.interceptor.MyInterceptor</span><span style="color: #8b2252;">"</span> /&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#20316;&#29992;&#20110;&#25351;&#23450;&#26144;&#23556;&#30340;&#25318;&#25130;&#22120; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">interceptor</span>&gt;
    <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#20026;&#25152;&#26377; /users/** &#35831;&#27714;&#37197;&#32622;&#25318;&#25130;&#22120; </span><span style="color: #b22222;">--&gt;</span>
    &lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">mapping</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">/users/**</span><span style="color: #8b2252;">"</span>/&gt;
    &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">fish.miniblog.interceptor.HisInterceptor</span><span style="color: #8b2252;">"</span> /&gt;
  &lt;/<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">interceptor</span>&gt;

&lt;/<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">interceptors</span>&gt;
</pre>
</div>

<p>
然后，就这样了。
</p>
</div>
</div>

<div id="outline-container-sec-2-8" class="outline-3">
<h3 id="sec-2-8"><span class="section-number-3">2.8</span> MessageSource(国际化，资源文件)</h3>
<div class="outline-text-3" id="text-2-8">
<p>
使用资源文件，实现国际化。
</p>

<p>
如果使用资源文件，只需要自定义我们自己的资源文件处理器，即实现 MessageSource 接口。
</p>

<p>
但 spring 提供了一些实现好的处理器，我们只需要注册使用，比如，ReloadableResourceBundleMessageSource：
</p>
<div class="org-src-container">

<pre class="src src-xml">&lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.context.support.ReloadableResourceBundleMessageSource</span><span style="color: #8b2252;">"</span>&gt;
  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#25351;&#23450;&#25105;&#20204;&#30340;&#36164;&#28304;&#25991;&#20214;&#20026;class&#26681;&#30446;&#24405;&#19979;&#30340; message.properties &#25991;&#20214; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">basename</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">message</span><span style="color: #8b2252;">"</span> /&gt;
&lt;/<span style="color: #0000ff;">bean</span>&gt;
</pre>
</div>

<p>
在 message[.zh_CN].properties 里面定义 k/v 形式的信息。
</p>
<pre class="example">
MY_NAME = GODMAN
NAME.ERROR = 名字错误
</pre>

<p>
然后，就可以使用了。比如：
</p>
<pre class="example">
&lt;fmt:message key="MY_NAME" /&gt;
</pre>
<p>
再比如，在 JSR-303 验证里：
</p>
<pre class="example">
@NotNull(message = "NAME.ERROR")
</pre>
<p>
在自定义验证器里:
</p>
<pre class="example">
errors.rejectValue("name", "NAME.ERROR")
</pre>

<p>
就这样。。。简单。
</p>
</div>
</div>
</section>

<section id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> RESTful Style</h2>
<div class="outline-text-2" id="text-3">
<p>
RESTful (Representational State Transfer) 一种 web 架构风格。
</p>

<p>
它将网络上存在的每件东西都抽象成了一种“资源”。
而我们访问网络的过程就是对某种“资源”的访问和控制。
</p>

<p>
比如，网络上某个地方存在一本书，这本书的 URL 资源地址就是：
</p>
<pre class="example">
theremoteserver.com/books/战争与和平
</pre>

<p>
如果我们想对这本书（这个资源）进行处理，可以把这个 URL 和 相关的 http 协议方法（GET/POST/PUT/DELETE）发送给服务器，比如，要删除：
</p>
<pre class="example">
DELETE theremoteserver.com/books/战争与和平
</pre>

<p>
在 HTTP 协议中，定义了很多不同的请求方法，比如我们熟悉的 GET/POST。
除了这两个，还有其他一些，这些请求方法是具备语义的，分别对应数据的 CRUD：
</p>
<ul class="org-ul">
<li>GET    从网络上获取资源，用来显示
</li>
<li>POST   用来在网络上增加一个资源
</li>
<li>PUT    用来更新网络上某个资源的信息
</li>
<li>DELETE 用来发送删除某个资源的指令
</li>
</ul>

<p>
在 RESTful 里，充分利用了这些请求方法，结合资源 URL，完成了对资源的操作处理。
</p>

<p>
<a href="http://stackoverflow.com/questions/671118/what-exactly-is-restful-programming">这篇帖子很有用</a>
</p>
</div>

<div id="outline-container-sec-3-0-1" class="outline-4">
<h4 id="sec-3-0-1"><span class="section-number-4">3.0.1</span> 应用示例</h4>
<div class="outline-text-4" id="text-3-0-1">
<p>
post 代表一条微博，它是存在于网络上的资源。
</p>

<p>
所有微博的 url 为：
</p>
<pre class="example">
localhost/posts
</pre>

<p>
某条微博的 url 为：
</p>
<pre class="example">
localhost/posts/223
</pre>

<p>
按照 RESTful 风格，我们可以将 Mapping 设计为：
</p>
<table>


<colgroup>
<col  class="left">

<col  class="left">

<col  class="left">
</colgroup>
<tbody>
<tr>
<td class="left">功能</td>
<td class="left">URL</td>
<td class="left">请求的方法</td>
</tr>

<tr>
<td class="left">显示所有微博</td>
<td class="left">localhost/posts</td>
<td class="left">GET</td>
</tr>

<tr>
<td class="left">增加一条微博</td>
<td class="left">localhost/posts</td>
<td class="left">POST</td>
</tr>

<tr>
<td class="left">显示某条微博</td>
<td class="left">localhost/posts/11</td>
<td class="left">GET</td>
</tr>

<tr>
<td class="left">更新某条微博</td>
<td class="left">localhost/posts/11</td>
<td class="left">PUT</td>
</tr>

<tr>
<td class="left">删除某条微博</td>
<td class="left">localhost/posts/11</td>
<td class="left">DELETE</td>
</tr>
</tbody>
</table>

<p>
当然，还需要额外两个映射
</p>
<table>


<colgroup>
<col  class="left">

<col  class="left">

<col  class="left">
</colgroup>
<tbody>
<tr>
<td class="left">功能</td>
<td class="left">URL</td>
<td class="left">请求的方法</td>
</tr>

<tr>
<td class="left">跳转到添加微博页面</td>
<td class="left">localhost/posts/edit</td>
<td class="left">GET</td>
</tr>

<tr>
<td class="left">跳转到编辑某条微博页面</td>
<td class="left">localhost/posts/11/edit</td>
<td class="left">POST</td>
</tr>
</tbody>
</table>

<p>
设计完这些后，我们就可以在 SpringMVC 里面，结合 @PathVariable 进行编程了。
</p>

<p>
而这种风格，展现了它的清晰和简单的性质。
</p>
</div>
</div>
</section>
</div>
<div id="postamble" class="status">
<p class="author">Author: imfine</p>
<p class="date">Created: 2017-02-21 周二 14:16</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.1.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation">Go ahead, never stop.</p>
</div>
</body>
</html>
