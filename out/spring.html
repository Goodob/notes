<!DOCTYPE html>
<html>
<head>
<title>Spring</title>
<!-- 2017-02-10 周五 10:11 -->
<meta  charset="utf-8">
<meta  name="generator" content="Org-mode">
<meta  name="author" content="imfine">
<link rel="stylesheet" href="nnn.css">
<meta name="viewport" content="width=device-width,initial-scale=1">
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="index.html"> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content">
<h1 class="title">Spring</h1>
<nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Spring</a></li>
<li><a href="#sec-2">2. Spring MVC</a>
<ul>
<li><a href="#sec-2-1">2.1. 基本步骤</a></li>
<li><a href="#sec-2-2">2.2. Parameters</a></li>
<li><a href="#sec-2-3">2.3. flow</a></li>
<li><a href="#sec-2-4">2.4. Validation(表单验证)</a></li>
<li><a href="#sec-2-5">2.5. 日期转换（PropertyEditor/Convertor/Formater）</a></li>
<li><a href="#sec-2-6">2.6. ExceptionHandler(异常处理)</a></li>
<li><a href="#sec-2-7">2.7. Interceptor(拦截器)</a></li>
<li><a href="#sec-2-8">2.8. RESTful 风格</a></li>
</ul>
</li>
</ul>
</div>
</nav>

<section id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Spring</h2>
</section>

<section id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Spring MVC</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> 基本步骤</h3>
<div class="outline-text-3" id="text-2-1">
<p>
第一步，创建 Gradle 项目，在 build.gradle 增加相关依赖
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #228b22;">apply</span> <span style="color: #a0522d;">plugin</span>: <span style="color: #8b2252;">'java'</span>
apply plugin: <span style="color: #8b2252;">'war'</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#25351;&#23450; Java &#29256;&#26412;</span>
sourceCompatibility = 1.8

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#37197;&#32622;&#19979;&#36733; jar &#21253;&#30340;&#22320;&#22336;</span>
repositories <span style="color: #707183;">{</span>
  jcenter<span style="color: #7388d6;">()</span>
  mavenCentral<span style="color: #7388d6;">()</span>
<span style="color: #707183;">}</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#37197;&#32622;&#38656;&#35201;&#30340; jar &#21253;&#20381;&#36182;</span>
dependencies <span style="color: #707183;">{</span>

  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23450;&#20041;&#20004;&#20010;&#23616;&#37096;&#21464;&#37327;</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36825;&#37324;&#20195;&#34920;&#25105;&#20204;&#38656;&#35201;&#30340; hibernate &#21644; spring &#30340;&#29256;&#26412;</span>
  <span style="color: #228b22;">def</span> <span style="color: #a0522d;">hibernateVersion</span> = <span style="color: #8b2252;">"5.1.0.Final"</span>
  def springVersion = <span style="color: #8b2252;">"4.3.5.RELEASE"</span>

  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22312; test &#20013;&#38656;&#35201;&#29992;&#21040;&#30340; jar &#21253;</span>
  testCompile <span style="color: #7388d6;">(</span>
    <span style="color: #8b2252;">"junit:junit:4.12"</span>
  <span style="color: #7388d6;">)</span>

  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25351;&#26126; Tomcat &#19978;&#24050;&#32463;&#33258;&#24102;&#30340; jar &#21253;&#65292;&#36825;&#26679;&#21457;&#24067;&#30340;&#26102;&#20505;&#25165;&#19981;&#20250;&#37325;&#22797;</span>
  providedCompile <span style="color: #7388d6;">(</span>
    <span style="color: #8b2252;">"javax:javaee-web-api:7.0"</span>,
  <span style="color: #7388d6;">)</span>

  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#37197;&#32622;&#25105;&#20204;&#39033;&#30446;&#38656;&#35201;&#29992;&#21040;&#30340;&#25152;&#26377; jar &#21253;&#65292;&#21363; compile &#29615;&#33410;&#38656;&#35201;&#30340; jar &#21253;</span>
  compile <span style="color: #7388d6;">(</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26412;&#22320;&#30340; OJDBC &#21253;&#21152;&#20837;&#36827;&#26469;&#65292;&#35201;&#25913;&#25104;&#33258;&#24049;&#30340;&#36335;&#24452;</span>
    files<span style="color: #909183;">(</span><span style="color: #8b2252;">"E:/SSH/lib_hibernate/ojdbc7.jar"</span><span style="color: #909183;">)</span>,

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#29992;&#26469;&#31649;&#29702;&#25968;&#25454;&#28304;&#30340;&#30693;&#21517; jar &#21253;</span>
    <span style="color: #8b2252;">"c3p0:c3p0:0.9.1.2"</span>,

    <span style="color: #b22222;">// </span><span style="color: #b22222;">jsp &#20013; jstl &#26631;&#31614;&#30340;&#25903;&#25345; jar &#21253;</span>
    <span style="color: #8b2252;">"javax.servlet:jstl:1.2"</span>,

    <span style="color: #b22222;">// </span><span style="color: #b22222;">log4j &#26085;&#24535;&#25903;&#25345;&#30340; jar &#21253;</span>
    <span style="color: #8b2252;">"log4j:log4j:1.2.17"</span>,

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#37197;&#32622; hibernate</span>
    <span style="color: #8b2252;">"org.hibernate:hibernate-core:$hibernateVersion"</span>,

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#37197;&#32622; spring</span>
    <span style="color: #8b2252;">"org.springframework:spring-web:$springVersion"</span>,
    <span style="color: #8b2252;">"org.springframework:spring-orm:$springVersion"</span>,
    <span style="color: #8b2252;">"org.springframework:spring-webmvc:$springVersion"</span>,
    <span style="color: #8b2252;">"com.fasterxml.jackson.core:jackson-databind:2.5.1"</span>
  <span style="color: #7388d6;">)</span>
<span style="color: #707183;">}</span>


<span style="color: #b22222;">// </span><span style="color: #b22222;">&#20026;&#32534;&#35793;&#22120;&#37197;&#32622;&#32534;&#30721;&#65292;&#38450;&#27490;&#26576;&#20123;&#24773;&#20917;&#19979;&#32534;&#35793;&#20986;&#29616;&#20081;&#30721;&#30340;&#24773;&#20917;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#30456;&#24212;&#30340;&#65292;&#25105;&#20204;&#25152;&#26377;&#30340;&#20195;&#30721;&#24212;&#35813;&#20445;&#23384;&#25104; UTF-8 &#26684;&#24335;</span>
tasks.<span style="color: #0000ff;">withType</span><span style="color: #707183;">(</span><span style="color: #228b22;">JavaCompile</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
  options.encoding = <span style="color: #8b2252;">"UTF-8"</span>
<span style="color: #707183;">}</span>


<span style="color: #b22222;">// </span><span style="color: #b22222;">&#33258;&#23450;&#20041;&#20219;&#21153;&#65292;&#23558;&#24037;&#31243;&#25152;&#38656;&#35201;&#30340; jar &#21253;&#25335;&#36125;&#21040;&#39033;&#30446;&#19979;&#30340; lib &#25991;&#20214;&#22841;&#19979;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#38656;&#35201;&#25163;&#21160;&#25191;&#34892;&#36825;&#20010; task &#25165;&#20250;&#26377;&#25928;&#26524;&#12290;&#36825;&#26159;&#20026;&#20102;&#26041;&#20415;&#23548;&#20986; jar &#21253;</span>
<span style="color: #228b22;">task</span> <span style="color: #0000ff;">copyJars</span><span style="color: #707183;">(</span>type: Copy<span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25351;&#26126;&#25105;&#20204;&#23548;&#20986;&#30340;&#26159; compile &#21644; test &#25152;&#20381;&#36182;&#30340; jar &#21253;</span>
  <span style="color: #228b22;">from</span> configurations.<span style="color: #a0522d;">compile</span>, configurations.<span style="color: #228b22;">testCompile</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25351;&#26126;&#23548;&#20986;&#21040; "lib" &#25991;&#20214;&#22841;&#19979;</span>
  <span style="color: #a0522d;">into</span> <span style="color: #8b2252;">"lib"</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
第二步，配置 web.xml，加入 spring 和 mvc 支持
</p>
<div class="org-src-container">

<pre class="src src-xml"><span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#37197;&#32622; spring &#30340; root application context (parent) </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#22312; spring mvc &#20013;&#65292;&#36825;&#20010;&#37197;&#32622;&#26159;&#21487;&#36873;&#30340; </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#22312;&#36825;&#20010; IOC &#23481;&#22120;&#37324;&#65292;&#20027;&#35201;&#37197;&#32622;&#19968;&#20123;&#20840;&#23616;&#30340;&#19996;&#35199; </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#27604;&#22914; dao/service &#30340;&#20381;&#36182;&#65292;&#22768;&#26126;&#24335;&#20107;&#21153;&#20043;&#31867; </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #0000ff;">listener</span>&gt;
  &lt;<span style="color: #0000ff;">listener-class</span>&gt;org.springframework.web.context.ContextLoaderListener&lt;/<span style="color: #0000ff;">listener-class</span>&gt;
&lt;/<span style="color: #0000ff;">listener</span>&gt;
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#37197;&#32622;&#36335;&#24452;&#65292;&#40664;&#35748;&#26159; "WEB-INF/applicationContext.xml" </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #0000ff;">context-param</span>&gt;
  &lt;<span style="color: #0000ff;">param-name</span>&gt;contextConfigLocation&lt;/<span style="color: #0000ff;">param-name</span>&gt;
  &lt;<span style="color: #0000ff;">param-value</span>&gt;classpath:spring-root.xml&lt;/<span style="color: #0000ff;">param-value</span>&gt;
&lt;/<span style="color: #0000ff;">context-param</span>&gt;


<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#37197;&#32622; SpringMVC &#30340; DispatcherServlet  context (child) </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#36825;&#20010;&#24517;&#39035;&#35201;&#37197;&#32622;&#65292;&#23427;&#30340;&#29238;&#23481;&#22120;&#26159; &#19978;&#38754;&#30340;&#37027;&#20010; </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #0000ff;">servlet</span>&gt;
  &lt;<span style="color: #0000ff;">servlet-name</span>&gt;miniblog&lt;/<span style="color: #0000ff;">servlet-name</span>&gt;
  &lt;<span style="color: #0000ff;">servlet-class</span>&gt;org.springframework.web.servlet.DispatcherServlet&lt;/<span style="color: #0000ff;">servlet-class</span>&gt;
  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#25351;&#23450;&#37197;&#32622;&#25991;&#20214;&#36335;&#24452;&#65292;&#21487;&#36873; </span><span style="color: #b22222;">--&gt;</span>
  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#40664;&#35748;&#25991;&#20214;&#26159; "WEB-INF/miniblog-dispatcher.xml" </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">init-param</span>&gt;
    &lt;<span style="color: #0000ff;">param-name</span>&gt;contextConfigLocation&lt;/<span style="color: #0000ff;">param-name</span>&gt;
    &lt;<span style="color: #0000ff;">param-value</span>&gt;classpath:spring-miniblog.xml&lt;/<span style="color: #0000ff;">param-value</span>&gt;
  &lt;/<span style="color: #0000ff;">init-param</span>&gt;
  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#21487;&#20197;&#25351;&#23450; tomcat &#21551;&#21160;&#30340;&#26102;&#20505;&#65292;&#33258;&#21160;&#21021;&#22987;&#21270; DispatcherServlet </span><span style="color: #b22222;">--&gt;</span>
  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#22914;&#26524;&#27809;&#26377;&#36825;&#20010;&#37197;&#32622;&#65292;&#20250;&#22312;&#31532;&#19968;&#27425;&#35775;&#38382;&#30340;&#26102;&#20505;&#25165;&#20250;&#21435;&#21019;&#24314; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">load-on-start</span>&gt;1&lt;/<span style="color: #0000ff;">load-on-start</span>&gt;
&lt;/<span style="color: #0000ff;">servlet</span>&gt;
&lt;<span style="color: #0000ff;">servlet-mapping</span>&gt;
  &lt;<span style="color: #0000ff;">servlet-name</span>&gt;miniblog&lt;/<span style="color: #0000ff;">servlet-name</span>&gt;
  &lt;<span style="color: #0000ff;">url-pattern</span>&gt;/&lt;/<span style="color: #0000ff;">url-pattern</span>&gt;
&lt;/<span style="color: #0000ff;">servlet-mapping</span>&gt;
</pre>
</div>

<p>
第三步，配置 spring 的 context 文件，如 spring-miniblog.xml
</p>
<div class="org-src-container">

<pre class="src src-xml"><span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#27880;&#24847;&#65292;&#35201;&#24341;&#20837;&#27491;&#30830;&#30340;&#21629;&#21517;&#31354;&#38388;&#65281;&#65281;&#65281; </span><span style="color: #b22222;">--&gt;</span>

<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> mvc &#29256;&#26412;&#30340; context:annotation-driven </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#38024;&#23545; mvc &#22686;&#21152;&#20102;&#19968;&#20123;&#20854;&#20182;&#25903;&#25345;&#65292;&#38656;&#35201;&#24320;&#21551; </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">annotation-driven</span> /&gt;

<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#37197;&#32622;&#25195;&#25551;&#21457;&#29616;&#25152;&#26377;&#20855;&#26377; @Controller &#27880;&#35299;&#30340;&#31867;&#65292;&#21152;&#36733;&#21040;&#23481;&#22120; </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #483d8b;">context</span>:<span style="color: #0000ff;">component-scan</span> <span style="color: #a0522d;">base-package</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">app.controller</span><span style="color: #8b2252;">"</span> /&gt;

<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#37197;&#32622;&#35270;&#22270;&#35299;&#26512;&#22120;&#65292;&#23558; Controller &#36820;&#22238;&#30340;&#23383;&#31526;&#20018;&#32452;&#32455;&#25104;&#20840;&#36335;&#24452; </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">viewResolver</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.web.servlet.view.InternalResourceViewResolver</span><span style="color: #8b2252;">"</span>&gt;
  &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">prefix</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">/WEB-INF/view/</span><span style="color: #8b2252;">"</span> /&gt;
  &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">suffix</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">.jsp</span><span style="color: #8b2252;">"</span> /&gt;
&lt;/<span style="color: #0000ff;">bean</span>&gt;

<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#37197;&#32622;&#38745;&#24577;&#36164;&#28304;&#30340;&#35775;&#38382;&#26144;&#23556; </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#27604;&#22914;&#35775;&#38382; http://localhost/js/jquery.js&#65292;mvc &#23558;&#20250;&#21435;&#23547;&#25214; /assets/javascript/jquery.js </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">resources</span> <span style="color: #a0522d;">mapping</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">/js/**</span><span style="color: #8b2252;">"</span>  <span style="color: #a0522d;">location</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">/assets/javascript/</span><span style="color: #8b2252;">"</span> /&gt;
&lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">resources</span> <span style="color: #a0522d;">mapping</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">/css/**</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">location</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">/assets/stylesheet/</span><span style="color: #8b2252;">"</span> /&gt;
</pre>
</div>

<p>
第四步，建立 Controller，进行测试
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #008b8b;">@Controller</span>
<span style="color: #008b8b;">@RequestMapping</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/users"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">UserController</span> <span style="color: #707183;">{</span>

    <span style="color: #008b8b;">@RequestMapping</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"/{name}"</span><span style="color: #7388d6;">)</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">show</span><span style="color: #7388d6;">(</span><span style="color: #008b8b;">@PathVariable</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span>, <span style="color: #228b22;">Model</span> <span style="color: #a0522d;">model</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        model.add<span style="color: #909183;">(</span><span style="color: #8b2252;">"name"</span>, name<span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"show"</span>;    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36820;&#22238;&#30340;&#26159; "/WEB-INF/view/show.jsp" &#39029;&#38754;</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Parameters</h3>
<div class="outline-text-3" id="text-2-2">
</div><div id="outline-container-sec-2-2-1" class="outline-4">
<h4 id="sec-2-2-1"><span class="section-number-4">2.2.1</span> 基本类型的自动绑定</h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
会根据 handler 参数列表中的字段名字，自动绑定数据
</p>

<p>
如果参数没有被赋值，默认会尝试将 null 赋予它。所以对于一些 int 之类的类型，会抛出 IllegalStateException 异常。
</p>
</div>
</div>

<div id="outline-container-sec-2-2-2" class="outline-4">
<h4 id="sec-2-2-2"><span class="section-number-4">2.2.2</span> 集合类型的自动绑定</h4>
</div>
<div id="outline-container-sec-2-2-3" class="outline-4">
<h4 id="sec-2-2-3"><span class="section-number-4">2.2.3</span> 对象的自动封装</h4>
<div class="outline-text-4" id="text-2-2-3">
<div class="org-src-container">

<pre class="src src-html"><span style="color: #b22222;">&lt;!-- </span><span style="color: #b22222;">form </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #0000ff;">form</span> <span style="color: #a0522d;">action</span>=<span style="color: #8b2252;">"/greeting"</span>&gt;
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"name"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#35831;&#36755;&#20837;&#21517;&#23383;"</span> /&gt;
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"age"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#35831;&#36755;&#20837;&#24180;&#40836;"</span> /&gt;
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"submit"</span>&gt;
&lt;/<span style="color: #0000ff;">form</span>&gt;
</pre>
</div>

<div class="org-src-container">

<pre class="src src-java"><span style="color: #b22222;">// </span><span style="color: #b22222;">handler</span>
<span style="color: #008b8b;">@RequestMapping</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/greeting"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">greeting</span><span style="color: #707183;">(</span><span style="color: #228b22;">User</span> <span style="color: #a0522d;">user</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"greeting"</span>;
<span style="color: #707183;">}</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">model</span>
<span style="color: #228b22;">Class</span> <span style="color: #a0522d;">User</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">age</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-2-4" class="outline-4">
<h4 id="sec-2-2-4"><span class="section-number-4">2.2.4</span> HttpSession/HttpServletRequest 等的自动绑定</h4>
<div class="outline-text-4" id="text-2-2-4">
<pre class="example">
public String greeting(HttpServletRequest r, HttpSession s)
</pre>
</div>
</div>

<div id="outline-container-sec-2-2-5" class="outline-4">
<h4 id="sec-2-2-5"><span class="section-number-4">2.2.5</span> @RequestParam</h4>
<div class="outline-text-4" id="text-2-2-5">
<p>
定制入参的名字和默认值等
</p>
<pre class="example">
public String greeting(@RequestParam(name = "username", defaultValue = "xyz") String name)
</pre>
</div>
</div>

<div id="outline-container-sec-2-2-6" class="outline-4">
<h4 id="sec-2-2-6"><span class="section-number-4">2.2.6</span> @RequestAttribute</h4>
<div class="outline-text-4" id="text-2-2-6">
<p>
将 request 的某个 Attribute 值，赋予 handler 参数
</p>
<pre class="example">
public String greeting(@RequestAttribute(name = "name") String name)
</pre>
</div>
</div>

<div id="outline-container-sec-2-2-7" class="outline-4">
<h4 id="sec-2-2-7"><span class="section-number-4">2.2.7</span> @CookieValue</h4>
<div class="outline-text-4" id="text-2-2-7">
<p>
用来绑定 cookie 中的值
</p>
</div>
</div>

<div id="outline-container-sec-2-2-8" class="outline-4">
<h4 id="sec-2-2-8"><span class="section-number-4">2.2.8</span> @RequestHeader</h4>
<div class="outline-text-4" id="text-2-2-8">
<p>
绑定 http 请求头部的信息到参数中
</p>
<pre class="example">
public String greeting(@RequestHeader(name = "user-agent") String ua)
</pre>
</div>
</div>

<div id="outline-container-sec-2-2-9" class="outline-4">
<h4 id="sec-2-2-9"><span class="section-number-4">2.2.9</span> @PathVariable</h4>
<div class="outline-text-4" id="text-2-2-9">
<p>
绑定 url 中匹配的串到参数中，用 {} 匹配
</p>
<pre class="example">
@RequestMapping("/greeting/{id}")
public String greeting(@PathVariable int id)
</pre>
</div>
</div>

<div id="outline-container-sec-2-2-10" class="outline-4">
<h4 id="sec-2-2-10"><span class="section-number-4">2.2.10</span> @RequestBody</h4>
<div class="outline-text-4" id="text-2-2-10">
<p>
将 http 请求 body 里的数据自动转换并绑定到参数。
</p>
</div>
</div>

<div id="outline-container-sec-2-2-11" class="outline-4">
<h4 id="sec-2-2-11"><span class="section-number-4">2.2.11</span> @ResponseBody</h4>
<div class="outline-text-4" id="text-2-2-11">
<p>
忽略头部，直接将内容作为响应体返回。
</p>

<p>
示例：
</p>

<div class="org-src-container">

<pre class="src src-js">$<span style="color: #707183;">(</span><span style="color: #8b2252;">"#showmsg"</span><span style="color: #707183;">)</span>.click<span style="color: #707183;">(</span><span style="color: #a020f0;">function</span> <span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
    d = <span style="color: #909183;">{</span><span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"xiaohui"</span>, <span style="color: #8b2252;">"age"</span>: 9<span style="color: #909183;">}</span>;
    $.ajax<span style="color: #909183;">(</span><span style="color: #709870;">{</span>
        method: <span style="color: #8b2252;">'post'</span>,
        url: <span style="color: #8b2252;">'/greeting'</span>,
        data: JSON.stringify<span style="color: #907373;">(</span>d<span style="color: #907373;">)</span>,
        contentType: <span style="color: #8b2252;">'application/json'</span>,
        <span style="color: #0000ff;">success</span>: <span style="color: #a020f0;">function</span> <span style="color: #907373;">(</span><span style="color: #a0522d;">o</span><span style="color: #907373;">)</span> <span style="color: #907373;">{</span>
            console.log<span style="color: #6276ba;">(</span>o<span style="color: #6276ba;">)</span>;  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#24471;&#21040;&#30340;&#26159; json &#23545;&#35937;</span>
            alert<span style="color: #6276ba;">(</span>eee.age<span style="color: #6276ba;">)</span>;
            alert<span style="color: #6276ba;">(</span>eee.name<span style="color: #6276ba;">)</span>;
        <span style="color: #907373;">}</span>
    <span style="color: #709870;">}</span><span style="color: #909183;">)</span>;
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;
</pre>
</div>

<p>
UserController:
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #008b8b;">@RequestMapping</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/greeting"</span><span style="color: #707183;">)</span>
<span style="color: #008b8b;">@ResponseBody</span>
<span style="color: #a020f0;">public</span> <span style="color: #228b22;">User</span> <span style="color: #0000ff;">greeting</span><span style="color: #707183;">(</span><span style="color: #008b8b;">@RequestBody</span> <span style="color: #228b22;">User</span> <span style="color: #a0522d;">user</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
    System.out.println<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#21448;&#36807;&#20102;&#19968;&#20010;&#26032;&#24180;&#65281;"</span><span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">age</span> = user.getAge<span style="color: #7388d6;">()</span>;
    user.setAge<span style="color: #7388d6;">(</span>age + 1<span style="color: #7388d6;">)</span>;
    <span style="color: #a020f0;">return</span> user;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-2-12" class="outline-4">
<h4 id="sec-2-2-12"><span class="section-number-4">2.2.12</span> @SessionAttribute</h4>
</div>
<div id="outline-container-sec-2-2-13" class="outline-4">
<h4 id="sec-2-2-13"><span class="section-number-4">2.2.13</span> @ModelAttribute</h4>
</div>
<div id="outline-container-sec-2-2-14" class="outline-4">
<h4 id="sec-2-2-14"><span class="section-number-4">2.2.14</span> Errors/BindingResult</h4>
<div class="outline-text-4" id="text-2-2-14">
<p>
用来绑定出错的信息
</p>
</div>
</div>

<div id="outline-container-sec-2-2-15" class="outline-4">
<h4 id="sec-2-2-15"><span class="section-number-4">2.2.15</span> Model/View/ModelAndView</h4>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> flow</h3>
<div class="outline-text-3" id="text-2-3">
<p>
当请求被 DispatcherServlet 拦截，会在 doService 里面完成所有的处理逻辑。
</p>

<p>
处理的大致流程是这样的：
</p>
<ol class="org-ol">
<li>预处理
</li>
<li>根据请求的 URL 通过 HandlerMapping 获取匹配的 Controller 和 handler
</li>
<li>创建 ModelAndView 对象，这个对象将会保存所有的模型数据，还会持有页面展现相关的信息
<pre class="example">
ModelAndView mv = null
</pre>
</li>
</ol>
<hr >
<ol class="org-ol">
<li>调用相应的 handler 方法，将结果封装成 ModelAndView 赋值给 mv。
</li>
</ol>
<hr >
<ol class="org-ol">
<li>调用 render 方法，将 Model 里的数据渲染到 View 视图里
</li>
</ol>
<hr >
<ol class="org-ol">
<li>清理工作
</li>
</ol>

<p>
所以我们需要明白，我们的 handler 最终产生的应该是一个保存了数据和视图的 ModelAndView。
即使我们的 handler 返回类型是字符串或其他，到最后还是被封装成了 ModelAndView。
</p>

<p>
而且在封装 ModelAndView 时，会将 handler 参数列表上的数据自动添加到里面。
</p>

<p>
我们可以在 jsp 里，对 ModelAndView 里的所有数据通过 el 表达式或 spring 标签进行获取。
</p>
</div>
</div>

<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> Validation(表单验证)</h3>
<div class="outline-text-3" id="text-2-4">
<p>
三种方法：
</p>
</div>
<div id="outline-container-sec-2-4-1" class="outline-4">
<h4 id="sec-2-4-1"><span class="section-number-4">2.4.1</span> 最基本的校验</h4>
<div class="outline-text-4" id="text-2-4-1">
<p>
几个重要的概念
</p>
<ul class="org-ul">
<li>一个接口 Errors/BindingResult，用来保存绑定错误信息。
</li>
<li>两个方法 errors.reject() / errors.rejectValue()，用来注册全局/字段级别的错误信息
</li>
<li>一个标签 &lt;form:errors path="*" /&gt;
</li>
</ul>

<p>
例子，首先，在页面上：
</p>
<div class="org-src-container">

<pre class="src src-html">&lt;<span style="color: #483d8b;">form</span>:<span style="color: #0000ff;">form</span> <span style="color: #a0522d;">action</span>=<span style="color: #8b2252;">"/users/create"</span> <span style="color: #a0522d;">modelAttribute</span>=<span style="color: #8b2252;">"user"</span>&gt;
  &lt;<span style="color: #0000ff;">ul</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"errorTip"</span>&gt;
    &lt;<span style="color: #483d8b;">form</span>:<span style="color: #0000ff;">errors</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"*"</span> <span style="color: #a0522d;">cssClass</span>=<span style="color: #8b2252;">"error"</span> <span style="color: #a0522d;">element</span>=<span style="color: #8b2252;">"li"</span> /&gt;
  &lt;/<span style="color: #0000ff;">ul</span>&gt;
  &lt;<span style="color: #0000ff;">div</span>&gt;
    &lt;<span style="color: #483d8b;">form</span>:<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"name"</span> /&gt;
    &lt;<span style="color: #483d8b;">form</span>:<span style="color: #0000ff;">errors</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"name"</span> <span style="color: #a0522d;">cssClass</span>=<span style="color: #8b2252;">"error"</span> <span style="color: #a0522d;">element</span>=<span style="color: #8b2252;">"div"</span> /&gt;
  &lt;/<span style="color: #0000ff;">div</span>&gt;
  &lt;<span style="color: #0000ff;">div</span>&gt;
    &lt;<span style="color: #483d8b;">form</span>:<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"number"</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"age"</span> /&gt;
    &lt;<span style="color: #483d8b;">form</span>:<span style="color: #0000ff;">errors</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"age"</span> <span style="color: #a0522d;">cssClass</span>=<span style="color: #8b2252;">"error"</span> <span style="color: #a0522d;">element</span>=<span style="color: #8b2252;">"p"</span> /&gt;
  &lt;/<span style="color: #0000ff;">div</span>&gt;
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"submit"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"&#27880;&#20876;"</span> /&gt;
&lt;/<span style="color: #483d8b;">form</span>:<span style="color: #0000ff;">form</span>&gt;
</pre>
</div>

<p>
然后，可以在 Controller 中的 handler 里进行校验，添加错误信息
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #008b8b;">@Controller</span>
<span style="color: #008b8b;">@RequestMapping</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/users"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">UserController</span> <span style="color: #707183;">{</span>

    <span style="color: #008b8b;">@RequestMapping</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"/create"</span><span style="color: #7388d6;">)</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">create</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">User</span> <span style="color: #a0522d;">user</span>, <span style="color: #228b22;">Errors</span> <span style="color: #a0522d;">errors</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26657;&#39564;&#21517;&#23383;</span>
        <span style="color: #a020f0;">if</span><span style="color: #909183;">(</span>user.getName<span style="color: #709870;">()</span> == <span style="color: #008b8b;">null</span> || empty<span style="color: #709870;">(</span>user.getName<span style="color: #907373;">()</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            errors.rejectValue<span style="color: #709870;">(</span><span style="color: #8b2252;">"name"</span>, <span style="color: #008b8b;">null</span>, <span style="color: #8b2252;">"&#21517;&#23383;&#19981;&#33021;&#20026;&#31354;"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26657;&#39564;&#24180;&#40836;</span>
        <span style="color: #a020f0;">if</span><span style="color: #909183;">(</span>user.getAge<span style="color: #709870;">()</span> &lt; 18<span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            errors.rejectValue<span style="color: #709870;">(</span><span style="color: #8b2252;">"age"</span>, <span style="color: #008b8b;">null</span>, <span style="color: #8b2252;">"&#24180;&#40836;&#22826;&#23567;&#20102;&#65292;18R"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20840;&#23616;&#26816;&#39564;&#30340;&#20363;&#23376;</span>
        <span style="color: #a020f0;">if</span><span style="color: #909183;">(</span>user.getName<span style="color: #709870;">()</span>.equals<span style="color: #709870;">(</span><span style="color: #8b2252;">"admin"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            errors.reject<span style="color: #709870;">(</span><span style="color: #008b8b;">null</span>, <span style="color: #8b2252;">"&#20320;&#26159;&#35841;&#65311;"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>


        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524;&#26377;&#26657;&#39564;&#38169;&#35823;&#65292;&#36820;&#22238;&#30456;&#24212;&#38169;&#35823;&#39029;&#38754;</span>
        <span style="color: #a020f0;">if</span><span style="color: #909183;">(</span>errors.hasErrors<span style="color: #709870;">()</span><span style="color: #909183;">)</span>
            <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"regist"</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524;&#27809;&#26377;&#38169;&#35823;&#65292;&#36820;&#22238;&#30340;&#39029;&#38754;</span>
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"greeting"</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
这样，就可以了。这种方法是基于 handler 的，优点是定义方便，缺点是不便于复用。
</p>
</div>
</div>

<div id="outline-container-sec-2-4-2" class="outline-4">
<h4 id="sec-2-4-2"><span class="section-number-4">2.4.2</span> 自定义验证器</h4>
<div class="outline-text-4" id="text-2-4-2">
<p>
首先，自定义我们的验证器，只需要实现 Validator 接口即可。
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">UserValidator</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">Validator</span> <span style="color: #707183;">{</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#35201;&#26469;&#26657;&#39564;&#39564;&#35777;&#30340;&#31867;</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">boolean</span> <span style="color: #0000ff;">supports</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">Class</span><span style="color: #909183;">&lt;</span>?<span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">clazz</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> clazz.equals<span style="color: #909183;">(</span>User.<span style="color: #a020f0;">class</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20889;&#25105;&#20204;&#30340;&#26657;&#39564;&#36923;&#36753;&#65292;&#25226;&#30456;&#20851;&#38169;&#35823;&#27880;&#20876;&#21040; errors &#37324;&#38754;</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">validate</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">Object</span> <span style="color: #a0522d;">target</span>, <span style="color: #228b22;">Errors</span> <span style="color: #a0522d;">errors</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">User</span> <span style="color: #a0522d;">user</span> = <span style="color: #909183;">(</span><span style="color: #228b22;">User</span><span style="color: #909183;">)</span> target;
        <span style="color: #a020f0;">if</span><span style="color: #909183;">(</span>user.getName<span style="color: #709870;">()</span> == <span style="color: #008b8b;">null</span> || user.getName<span style="color: #709870;">()</span>.length<span style="color: #709870;">()</span> &lt; 3<span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            errors.rejectValue<span style="color: #709870;">(</span><span style="color: #8b2252;">"name"</span>, <span style="color: #008b8b;">null</span>, <span style="color: #8b2252;">"&#21517;&#23383;&#19981;&#33021;&#20026;&#31354;&#65292;&#32780;&#19988;&#24517;&#39035;&#35201;&#22823;&#20110; 3 &#20301;"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #a020f0;">if</span><span style="color: #909183;">(</span>user.getAge<span style="color: #709870;">()</span> &lt; 18 <span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            errors.rejectValue<span style="color: #709870;">(</span><span style="color: #8b2252;">"age"</span>, <span style="color: #008b8b;">null</span>, <span style="color: #8b2252;">"&#24180;&#40836;&#24517;&#39035;&#35201;&#22823;&#20110; 18 &#23681;&#21734;"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
其次，需要注册我们的验证器。
</p>

<p>
可以注册到当前的 Controller 里面，
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#25918;&#21040; Controller &#37324;&#38754;&#65292;&#36825;&#26679;&#20250;&#22312; handler &#25191;&#34892;&#20043;&#21069;&#34987;&#25191;&#34892;</span>
<span style="color: #008b8b;">@InitBinder</span>
<span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">init</span> <span style="color: #707183;">(</span><span style="color: #228b22;">DataBinder</span> <span style="color: #a0522d;">binder</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
    binder.setValidator<span style="color: #7388d6;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">UserValidator</span><span style="color: #909183;">()</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
也可以在 spring-mvc.xml 配置里注册成全局的验证器。
</p>
<div class="org-src-container">

<pre class="src src-xml">&lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">annotation-driven</span> <span style="color: #a0522d;">validator</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">userValidator</span><span style="color: #8b2252;">"</span> /&gt;
&lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">userValidator</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">fish.miniblog.validator.UserValidator</span><span style="color: #8b2252;">"</span> /&gt;
</pre>
</div>

<p>
最后，就可以在所需要验证的参数前面加上 @Validated 注解，来实现参数的自动校验了。
</p>
</div>
</div>

<div id="outline-container-sec-2-4-3" class="outline-4">
<h4 id="sec-2-4-3"><span class="section-number-4">2.4.3</span> JSR-303 风格校验</h4>
<div class="outline-text-4" id="text-2-4-3">
<p>
JSR-303 是 java 官方推出的一套 Validation 接口。
</p>

<p>
hibernate 给出了一个完整实现。
</p>

<p>
首先，如果想使用 JSR-303 的校验风格，需要引入相应的包：
</p>
<pre class="example">
complie "org.hibernate:hibernate-validator:5.4.0.Final"
</pre>

<p>
其次，添加我们的验证逻辑。需要在我们的 model bean 上添加相关注解：
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">User</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@NotNull</span>
    <span style="color: #008b8b;">@Size</span><span style="color: #7388d6;">(</span>min = 3, max = 10<span style="color: #7388d6;">)</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span>;

    <span style="color: #008b8b;">@Range</span><span style="color: #7388d6;">(</span>min = 10, max = 100<span style="color: #7388d6;">)</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">age</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
再次，要保证在我们的 spring-mvc.xml 中存在:
</p>
<pre class="example">
&lt;mvc:annotation-driven /&gt;
</pre>

<p>
最后，使用，只要在 Controller 的相关字段上添加 @Valid 注解即可。
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">create</span><span style="color: #707183;">(</span><span style="color: #008b8b;">@Valid</span> <span style="color: #228b22;">User</span> <span style="color: #a0522d;">user</span>, <span style="color: #228b22;">Errors</span> <span style="color: #a0522d;">errors</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20854;&#20182;&#30340;&#20351;&#29992;&#36319;&#19978;&#38754;&#26159;&#19968;&#33268;&#30340;.</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5"><span class="section-number-3">2.5</span> 日期转换（PropertyEditor/Convertor/Formater）</h3>
<div class="outline-text-3" id="text-2-5">
</div><div id="outline-container-sec-2-5-1" class="outline-4">
<h4 id="sec-2-5-1"><span class="section-number-4">2.5.1</span> 第一种方法：利用内置的 CustomDateEditor</h4>
<div class="outline-text-4" id="text-2-5-1">
<p>
首先，在我们的 Controller 的 InitBinder 里面，注册 CustomEditor
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #008b8b;">@InitBinder</span>
<span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">init</span> <span style="color: #707183;">(</span><span style="color: #228b22;">WebDataBinder</span> <span style="color: #a0522d;">binder</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
    <span style="color: #228b22;">CustomDateEditor</span> <span style="color: #a0522d;">dateEditor</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">CustomDateEditor</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">SimpleDateFormat</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"yyyy-MM-dd"</span><span style="color: #909183;">)</span>, <span style="color: #008b8b;">true</span><span style="color: #7388d6;">)</span>;
    binder.registerCustomEditor<span style="color: #7388d6;">(</span>Date.<span style="color: #a020f0;">class</span>, dateEditor<span style="color: #7388d6;">)</span>;                                <span style="color: #88090B;">)</span>;
<span style="color: #88090B;">}</span>
</pre>
</div>

<p>
然后，就可以正常转换了。
</p>
</div>
</div>

<div id="outline-container-sec-2-5-2" class="outline-4">
<h4 id="sec-2-5-2"><span class="section-number-4">2.5.2</span> 第二种方法：实现自定义转换器</h4>
<div class="outline-text-4" id="text-2-5-2">
<p>
spring 3.0 之后，使用 converter
</p>

<div class="org-src-container">

<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyDateConverter</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">Converter</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">String</span>, <span style="color: #228b22;">Date</span><span style="color: #707183;">&gt;</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Date</span> <span style="color: #0000ff;">convert</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span> <span style="color: #a0522d;">datestr</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#33258;&#24049;&#21435;&#23454;&#29616;&#65292;&#23558;&#23383;&#31526;&#20018;&#36716;&#25442;&#20026; Date &#23545;&#35937;&#12290;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#27880;&#24847;&#32771;&#34385;&#24322;&#24120;&#22788;&#29702;&#31561;</span>
        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">null</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
然后需要在配置文件中注册转换器
</p>
<div class="org-src-container">

<pre class="src src-xml"><span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#37197;&#32622;&#25105;&#20204;&#23450;&#20041;&#30340;&#36716;&#25442;&#26381;&#21153; </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">annotation-driven</span> <span style="color: #a0522d;">conversion-service</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">myConversionService</span><span style="color: #8b2252;">"</span> /&gt;

<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#23450;&#20041;&#20840;&#23616;&#30340;&#36716;&#25442;&#26381;&#21153;&#65292;&#21487;&#20197;&#37197;&#32622;&#22810;&#20010;&#36716;&#25442;&#22120; </span><span style="color: #b22222;">--&gt;</span>
<span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#22312;&#36825;&#37324;&#65292;&#21482;&#37197;&#32622;&#20102;&#25105;&#20204;&#33258;&#23450;&#20041;&#30340;&#36716;&#25442;&#22120;&#65292;DateConverter </span><span style="color: #b22222;">--&gt;</span>
&lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">myConversionService</span><span style="color: #8b2252;">"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">org.springframework.context.support.ConversionServiceFactoryBean</span><span style="color: #8b2252;">"</span>&gt;
  &lt;<span style="color: #0000ff;">property</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">converters</span><span style="color: #8b2252;">"</span>&gt;
    &lt;<span style="color: #0000ff;">set</span>&gt;
      &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">fish.miniblog.converter.MyDateConverter</span><span style="color: #8b2252;">"</span> /&gt;
    &lt;/<span style="color: #0000ff;">set</span>&gt;
  &lt;/<span style="color: #0000ff;">property</span>&gt;
&lt;/<span style="color: #0000ff;">bean</span>&gt;
</pre>
</div>

<p>
这样就可以了。所有的 yyyy-MM-yy 之类的字符串就可以正常转换成 Date 对象了。
</p>
</div>
</div>

<div id="outline-container-sec-2-5-3" class="outline-4">
<h4 id="sec-2-5-3"><span class="section-number-4">2.5.3</span> 第三种方法：使用 @DateTimeFormat 注解</h4>
<div class="outline-text-4" id="text-2-5-3">
<p>
在 model 上，增加相应注解：
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">User</span> <span style="color: #707183;">{</span>
  <span style="color: #008b8b;">@DateTimeFormat</span><span style="color: #7388d6;">(</span>pattern = <span style="color: #8b2252;">"yyyy-MM-dd"</span><span style="color: #7388d6;">)</span>
  <span style="color: #a020f0;">private</span> <span style="color: #228b22;">Date</span> <span style="color: #a0522d;">birthday</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
就可以了。
</p>

<p>
另外，如果想让返回的 JSON 对象中能够准确处理时间类型，需要用到 @JsonFormat 注解
</p>
</div>
</div>

<div id="outline-container-sec-2-5-4" class="outline-4">
<h4 id="sec-2-5-4"><span class="section-number-4">2.5.4</span> 日期在页面上的显示</h4>
<div class="outline-text-4" id="text-2-5-4">
<p>
暂缺。
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-6" class="outline-3">
<h3 id="sec-2-6"><span class="section-number-3">2.6</span> ExceptionHandler(异常处理)</h3>
<div class="outline-text-3" id="text-2-6">
</div><div id="outline-container-sec-2-6-1" class="outline-4">
<h4 id="sec-2-6-1"><span class="section-number-4">2.6.1</span> Controller 范围内的异常处理</h4>
</div>
<div id="outline-container-sec-2-6-2" class="outline-4">
<h4 id="sec-2-6-2"><span class="section-number-4">2.6.2</span> 全局范围的异常配置</h4>
</div>
</div>

<div id="outline-container-sec-2-7" class="outline-3">
<h3 id="sec-2-7"><span class="section-number-3">2.7</span> Interceptor(拦截器)</h3>
<div class="outline-text-3" id="text-2-7">
<p>
拦截器主要用来增强 handler 方法
</p>

<p>
拦截器的接口有两个，定义拦截器就是实现他们之一
</p>
<ul class="org-ul">
<li>HandlerInterceptor      参数比较多，能够更全面控制拦截行为
</li>
<li>WebRequestInterceptor   针对 Web 请求精简了参数列表，主要用来控制 request/ModelAndView/Exception
</li>
</ul>

<p>
主要实现以下三个方法:
</p>
<ul class="org-ul">
<li>preHandler()       在执行 Controller 相应 handler 之前要执行
</li>
<li>postHandler()      执行完 handler，进入 render 页面渲染前的阶段执行
</li>
<li>afterCompletion()  所有的东西都做完，退出前执行。主要用来做一些清理工作
</li>
</ul>

<p>
下面是例子:
</p>

<p>
<b>定义</b>
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#23454;&#29616; HandlerInterceptor &#25509;&#21475;&#30340;&#24418;&#24335;</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyInterceptor</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">HandlerInterceptor</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">boolean</span> <span style="color: #0000ff;">preHandle</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">request</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">response</span>, <span style="color: #228b22;">Object</span> <span style="color: #a0522d;">handler</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22312;&#35843;&#29992; handler &#20043;&#21069;&#34987;&#35843;&#29992;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524;&#36820;&#22238; true&#65292;&#32487;&#32493;&#19979;&#38754;&#30340;&#27969;&#31243;&#65292;&#22914;&#26524;&#36820;&#22238; false&#65292;&#30452;&#25509;&#36339;&#36716;&#21040; afterComplete &#20013;&#27490;&#36816;&#34892;&#12290;</span>
        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">true</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">postHandle</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">request</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">response</span>, <span style="color: #228b22;">Object</span> <span style="color: #a0522d;">handler</span>, <span style="color: #228b22;">ModelAndView</span> <span style="color: #a0522d;">modelAndView</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22312;&#35843;&#29992;&#23436; handler &#24471;&#21040;&#23553;&#35013;&#22909;&#30340; ModelAndView &#20043;&#21518;&#65292;&#28210;&#26579;&#39029;&#38754;&#21069;&#34987;&#35843;&#29992;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22312;&#36825;&#37324;&#65292;&#21487;&#20197;&#23545; ModelAndView &#37324;&#30340;&#25968;&#25454;&#20316;&#20986;&#33258;&#24049;&#30340;&#20462;&#25913;&#31561;</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">afterCompletion</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">request</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">response</span>, <span style="color: #228b22;">Object</span> <span style="color: #a0522d;">handler</span>, <span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">ex</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22312;&#26368;&#21518;&#30340;&#28165;&#29702;&#38454;&#27573;&#34987;&#35843;&#29992;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22312;&#36825;&#37324;&#65292;&#36827;&#34892;&#21892;&#21518;&#25805;&#20316;&#12290;</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>


<span style="color: #b22222;">// </span><span style="color: #b22222;">&#23454;&#29616; WebRequestInterceptor &#25509;&#21475;&#30340;&#24418;&#24335;</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">HisInterceptor</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">WebRequestInterceptor</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">preHandle</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">WebRequest</span> <span style="color: #a0522d;">request</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"pre"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">postHandle</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">WebRequest</span> <span style="color: #a0522d;">request</span>, <span style="color: #228b22;">ModelMap</span> <span style="color: #a0522d;">model</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        System.out.println<span style="color: #909183;">(</span>model<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">afterCompletion</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">WebRequest</span> <span style="color: #a0522d;">request</span>, <span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">ex</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        System.out.println<span style="color: #909183;">(</span>ex<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
<b>注册</b>
</p>
<div class="org-src-container">

<pre class="src src-xml">&lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">interceptors</span>&gt;
  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#20840;&#23616;&#25318;&#25130;&#22120; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">fish.miniblog.interceptor.YourInterceptor</span><span style="color: #8b2252;">"</span> /&gt;
  &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">fish.miniblog.interceptor.MyInterceptor</span><span style="color: #8b2252;">"</span> /&gt;

  <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;"> &#20316;&#29992;&#20110;&#25351;&#23450;&#26144;&#23556;&#30340;&#25318;&#25130;&#22120; </span><span style="color: #b22222;">--&gt;</span>
  &lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">interceptor</span>&gt;
    &lt;<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">mapping</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">fish.miniblog.controller.UserController</span><span style="color: #8b2252;">"</span>/&gt;
    &lt;<span style="color: #0000ff;">bean</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"</span><span style="color: #8b2252;">fish.miniblog.interceptor.HisInterceptor</span><span style="color: #8b2252;">"</span> /&gt;
  &lt;/<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">interceptor</span>&gt;

&lt;/<span style="color: #483d8b;">mvc</span>:<span style="color: #0000ff;">interceptors</span>&gt;
</pre>
</div>

<p>
然后，就这样了。
</p>
</div>
</div>

<div id="outline-container-sec-2-8" class="outline-3">
<h3 id="sec-2-8"><span class="section-number-3">2.8</span> RESTful 风格</h3>
<div class="outline-text-3" id="text-2-8">
</div><div id="outline-container-sec-2-8-1" class="outline-4">
<h4 id="sec-2-8-1"><span class="section-number-4">2.8.1</span> 概念介绍</h4>
</div>
<div id="outline-container-sec-2-8-2" class="outline-4">
<h4 id="sec-2-8-2"><span class="section-number-4">2.8.2</span> 应用示例</h4>
</div>
</div>
</section>
</div>
<div id="postamble" class="status">
<p class="author">Author: imfine</p>
<p class="date">Created: 2017-02-10 周五 10:11</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.1.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation">Go ahead, never stop.</p>
</div>
</body>
</html>
