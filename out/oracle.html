<!DOCTYPE html>
<html>
<head>
<title>Oracle Database</title>
<!-- 2017-03-15 周三 16:38 -->
<meta  charset="utf-8">
<meta  name="generator" content="Org-mode">
<meta  name="author" content="imfine">
<link rel="stylesheet" href="nnn.css">
<meta name="viewport" content="width=device-width,initial-scale=1">
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="index.html"> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content">
<h1 class="title">Oracle Database</h1>
<nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Oracle 的体系结构</a>
<ul>
<li><a href="#sec-1-1">1.1. 服务端</a></li>
<li><a href="#sec-1-2">1.2. 客户端</a></li>
</ul>
</li>
<li><a href="#sec-2">2. Oracle 网络配置</a>
<ul>
<li><a href="#sec-2-1">2.1. 配置途径</a></li>
<li><a href="#sec-2-2">2.2. 服务端 (NETWORK/ADMIN/listener.ora)</a></li>
<li><a href="#sec-2-3">2.3. 客户端 (NETWORK/ADMIN/tnsnames.ora)</a></li>
</ul>
</li>
<li><a href="#sec-3">3. 用户与权限</a>
<ul>
<li><a href="#sec-3-1">3.1. 用户</a></li>
<li><a href="#sec-3-2">3.2. 权限</a></li>
<li><a href="#sec-3-3">3.3. 角色</a></li>
</ul>
</li>
<li><a href="#sec-4">4. SQL语句</a>
<ul>
<li><a href="#sec-4-1">4.1. SQL 的历史及概念</a></li>
<li><a href="#sec-4-2">4.2. SQL 的分类</a></li>
<li><a href="#sec-4-3">4.3. 数据类型</a></li>
<li><a href="#sec-4-4">4.4. 运算符</a></li>
<li><a href="#sec-4-5">4.5. 内置函数</a></li>
</ul>
</li>
<li><a href="#sec-5">5. 锁 (LOCK)</a>
<ul>
<li><a href="#sec-5-1">5.1. 行级锁，事务锁</a></li>
<li><a href="#sec-5-2">5.2. 乐观锁、悲观锁</a></li>
<li><a href="#sec-5-3">5.3. 被锁定的对象，解锁的方法</a></li>
</ul>
</li>
<li><a href="#sec-6">6. 同义词 (Synonymous)</a></li>
<li><a href="#sec-7">7. 序列 (Sequence)</a></li>
<li><a href="#sec-8">8. 分区 (Partition)</a>
<ul>
<li><a href="#sec-8-1">8.1. 范围分区</a></li>
<li><a href="#sec-8-2">8.2. 列表分区</a></li>
<li><a href="#sec-8-3">8.3. 哈希分区</a></li>
<li><a href="#sec-8-4">8.4. 范围-列表分区</a></li>
<li><a href="#sec-8-5">8.5. 范围-列表分区</a></li>
<li><a href="#sec-8-6">8.6. 分区的修改</a></li>
</ul>
</li>
<li><a href="#sec-9">9. 视图 (View)</a>
<ul>
<li><a href="#sec-9-1">9.1. 关系视图</a></li>
<li><a href="#sec-9-2">9.2. 内嵌视图</a></li>
<li><a href="#sec-9-3">9.3. 对象视图（可选）</a></li>
<li><a href="#sec-9-4">9.4. 物化视图</a></li>
</ul>
</li>
<li><a href="#sec-10">10. 索引 (Index)</a></li>
<li><a href="#sec-11">11. 函数 (Function)</a></li>
<li><a href="#sec-12">12. PL/SQL</a>
<ul>
<li><a href="#sec-12-1">12.1. 基本语法</a></li>
<li><a href="#sec-12-2">12.2. 变量赋值</a></li>
<li><a href="#sec-12-3">12.3. 变量类型</a></li>
<li><a href="#sec-12-4">12.4. 操作符</a></li>
<li><a href="#sec-12-5">12.5. 流程控制</a></li>
<li><a href="#sec-12-6">12.6. 异常处理</a></li>
<li><a href="#sec-12-7">12.7. 动态 SQL</a></li>
<li><a href="#sec-12-8">12.8. 游标 (Cursor)</a></li>
<li><a href="#sec-12-9">12.9. 存储过程</a></li>
</ul>
</li>
<li><a href="#sec-13">13. 导入导出</a></li>
<li><a href="#sec-14">14. 生成批量数据</a></li>
<li><a href="#sec-15">15. pages</a></li>
</ul>
</div>
</nav>

<section id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Oracle 的体系结构</h2>
<div class="outline-text-2" id="text-1">
<p>
数据库是一个以某种有组织的方式存储的数据集合。
它本质上是用计算机存储记录的系统，是位于用户和系统之间的一层管理软件。
Oracle 数据库是目前最流行、最强大的面向对象的关系型数据库(ORDBMS)。
</p>

<p>
Oracle 是基于请求响应的方式，分为服务端和客户端。
</p>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> 服务端</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Oracle 是由实例和数据库两部分组成的。
</p>
</div>

<div id="outline-container-sec-1-1-1" class="outline-4">
<h4 id="sec-1-1-1"><span class="section-number-4">1.1.1</span> 实例 (INSTANCE)</h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
又称为oracle数据库引擎，由由内存即SGA(System Global Area,系统全局区)和后台处理进程组成。
</p>
</div>
</div>

<div id="outline-container-sec-1-1-2" class="outline-4">
<h4 id="sec-1-1-2"><span class="section-number-4">1.1.2</span> 数据库 (DATABASE)</h4>
<div class="outline-text-4" id="text-1-1-2">
<p>
保存在计算机上的数据文件等。可以从物理物件或逻辑组件的角度看待。
</p>
</div>

<ol class="org-ol"><li><a id="sec-1-1-2-1" name="sec-1-1-2-1"></a>物理组件<br ><div class="outline-text-5" id="text-1-1-2-1">
<ol class="org-ol">
<li>控制文件 (Control File)
<pre class="example">
select * from v$controlfile;
</pre>
<p>
记录数据库的物理结构和其他控制信息，如数据库名称，数据文件、日志文件名称和位置等。多副本保证安全。
</p>
</li>

<li>数据文件 (Data File)
<pre class="example">
select name,status,enabled from v$datafile;
</pre>
</li>

<li>日志文件 (联机日志文件/归档日志文件)
<pre class="example">
select * from v$log;   -- 查看日志
</pre>

<p>
保存用户的所有操作。一个数据库至少有两个日志组，轮流写入。<br >
  每个日志组至少有一个日志成员，成员之间是镜像关系，这是为了保护数据。<br >
  联机日志组的交换过程叫切换。当一个组写完会自动切换下一组，也可以手动切换：
</p>
<pre class="example">
alter system switch logfile   -- 切换日志文件
</pre>

<p>
如果打开归档模式，切换日志的时候会产生归档文件。打开归档模式命令:
</p>
<pre class="example">
alter database archivelog
</pre>
</li>

<li>初始化参数文件 (Parameter File)
<pre class="example">
$ORA_HOME/admin/&lt;SID&gt;/pfile/init.ora.xxx
</pre>
<p>
记录了数据库启动运行的一系列参数，内存、控制文件等
</p>
</li>
</ol>
</div>
</li>

<li><a id="sec-1-1-2-2" name="sec-1-1-2-2"></a>逻辑组件<br ><div class="outline-text-5" id="text-1-1-2-2">
<ol class="org-ol">
<li>表空间 (tablespace)
<pre class="example">
select * from v$tablespace;
</pre>
<ul class="org-ul">
<li><b>最基本的逻辑结构</b> ，是数据库恢复的最小单位, 容纳着许多数据库实体, 如表、视图、索引、聚簇、回退段和临时段等。
</li>
<li>默认创建的表空间有 SYSTEM/SYSAUX/TEMP/UNDO/USERS
</li>
<li>表空间跟数据文件是 1vN 的关系。一个表空间至少需要一个相应的数据文件
</li>
<li>在实际生产中，不建议用默认表空间，要根据情况自己创建
</li>
<li>创建/删除表空间的语法：
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#34920;&#31354;&#38388;&#21019;&#24314;</span>
<span style="color: #a020f0;">create</span> tablespace xxx
  logging
  datafile <span style="color: #8b2252;">'D:\xxx.dbf'</span>
  <span style="color: #a020f0;">size</span> 50m
  autoextend <span style="color: #a020f0;">on</span>
  <span style="color: #a020f0;">next</span> 50m maxsize 20480m
  extent management <span style="color: #a020f0;">local</span>;

<span style="color: #b22222;">-- &#21019;&#24314;&#20020;&#26102;&#34920;&#31354;&#38388;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">temporary</span> tablespace yyy
  tempfile <span style="color: #8b2252;">'D:\yyy.dbf'</span>;

<span style="color: #b22222;">-- &#21024;&#38500;</span>
<span style="color: #a020f0;">drop</span> tablespace yyy;
</pre>
</div>
</li>
<li>逻辑上说，一个表空间是由一到多个段组成的。
</li>
</ul>
</li>

<li>段 (Segment)
<ul class="org-ul">
<li>段是对象在数据库中占用的空间
</li>
<li>每个段，对应的是每个对象，有 table/index/view 等
</li>
<li>按照存储对象类型的不同，分为数据段、索引段、回滚段和临时段
</li>
<li>逻辑上说，段是由区组成的
</li>
</ul>
</li>

<li>区 (Extend)
<ul class="org-ul">
<li>由连续的数据块组成，由 Oracle 自动分配管理
</li>
<li>当段中的空间已满时，会自动扩展新区
</li>
</ul>
</li>

<li>块 (Block)
<ul class="org-ul">
<li>数据块是Oracle服务器所能分配、读取或写入的最小逻辑单位。
</li>
<li>Oracle服务器以数据块为单位管理数据文件的存储空间。 
</li>
<li>正常情况下，块的大小是操作系统块的整数倍，称作标准块。
</li>
<li>可以通过参数 db_block_size 控制，默认 8k.
</li>
</ul>
</li>
</ol>
</div>
</li></ol>
</div>

<div id="outline-container-sec-1-1-3" class="outline-4">
<h4 id="sec-1-1-3"><span class="section-number-4">1.1.3</span> 启动过程</h4>
<div class="outline-text-4" id="text-1-1-3">
<pre class="example">
startup nomount        -- 只启动了实例 (Instance)
alter database mount   -- 数据库挂载
alter database open    -- 数据库打开
</pre>

<pre class="example">
shutdown immediate     -- 立刻关闭
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> 客户端</h3>
<div class="outline-text-3" id="text-1-2">
</div><div id="outline-container-sec-1-2-1" class="outline-4">
<h4 id="sec-1-2-1"><span class="section-number-4">1.2.1</span> sqlplus</h4>
<div class="outline-text-4" id="text-1-2-1">
</div><ol class="org-ol"><li><a id="sec-1-2-1-1" name="sec-1-2-1-1"></a>连接语法：<br ><div class="outline-text-5" id="text-1-2-1-1">
<pre class="example">
sqlplus sys/southit as sysdba     -- 管理员登录
sqlplus / as sysdba               -- 操作系统认证
sqlplus scott/tiger               -- 普通用户登录
sqlplus scott/tiger@remotedb      -- 连接远程数据库
sqlplus /nolog                    -- 未连接状态，之后可以用 conn user/pass 语法登录
</pre>
</div>
</li>

<li><a id="sec-1-2-1-2" name="sec-1-2-1-2"></a>常用命令 (set/show)<br ><div class="outline-text-5" id="text-1-2-1-2">
<pre class="example">
linesize/pagesize/header/autocommit/echo/pause/serveroutput/autotrace/timing...
column xxx format a22
show parameters [系统参数]
</pre>
</div>
</li>

<li><a id="sec-1-2-1-3" name="sec-1-2-1-3"></a>快速编辑之修改<br ><div class="outline-text-5" id="text-1-2-1-3">
<ol class="org-ol">
<li>list 定位到需要修改的行
</li>
<li>通过 change 去做替换
<pre class="example">
change /table_names/table_name
</pre>
</li>
<li>通过list 命令，查看修改完的语句 
</li>
<li>通过调用 run 命令，运行目前缓存区存在的语句。
</li>
</ol>
</div>
</li>

<li><a id="sec-1-2-1-4" name="sec-1-2-1-4"></a>快速编辑之追加单词<br ><div class="outline-text-5" id="text-1-2-1-4">
<ol class="org-ol">
<li>list 定位到需要修改的行
</li>
<li>通过 append 去追加字段
<pre class="example">
append table_name
</pre>
</li>
<li>通过list做检查
</li>
<li>通过 run 去执行命令。
</li>
</ol>
</div>
</li>

<li><a id="sec-1-2-1-5" name="sec-1-2-1-5"></a>快速编辑之删除<br ><div class="outline-text-5" id="text-1-2-1-5">
<ol class="org-ol">
<li>list 定位到需要修改的行
<pre class="example">
list 1
</pre>
</li>
<li>通过 del 直接删除 / 通过 change 命令，把本行替换为空。
</li>
<li>list 查看结果
</li>
<li>run 运行语句
</li>
</ol>
</div>
</li>

<li><a id="sec-1-2-1-6" name="sec-1-2-1-6"></a>快速编辑之添加新行<br ><div class="outline-text-5" id="text-1-2-1-6">
<ol class="org-ol">
<li>list 定位
</li>
<li>通过 input 输入新行的内容
</li>
<li>list 查看结果
</li>
<li>run 运行命令
</li>
</ol>
</div>
</li>

<li><a id="sec-1-2-1-7" name="sec-1-2-1-7"></a>快速编辑之其他<br ><div class="outline-text-5" id="text-1-2-1-7">
<pre class="example">
list last         -- 定位到缓冲区内容的最后一行
save name         -- 保存当前缓冲区的内容到 .sql 文件。默认为当前目录，可以添加详细路径
start name.sql    -- 加载 .sql 文件并执行。简写为 @name
get name          -- 加载 .sql 文件但不执行
run               -- 执行缓冲区内容。简写为 /
edit              -- 调用外部编辑器修改缓冲区内容
clear buffer      -- 清空缓存区
clear screen      -- 清屏
</pre>
</div>
</li></ol>
</div>

<div id="outline-container-sec-1-2-2" class="outline-4">
<h4 id="sec-1-2-2"><span class="section-number-4">1.2.2</span> jdbc</h4>
<div class="outline-text-4" id="text-1-2-2">
<p>
利用 java 连接 Oracle. 需要 ojdbc.jar
</p>
</div>
</div>

<div id="outline-container-sec-1-2-3" class="outline-4">
<h4 id="sec-1-2-3"><span class="section-number-4">1.2.3</span> 其他的图形化工具</h4>
<div class="outline-text-4" id="text-1-2-3">
<p>
Toad / PLSQL Developer 等
</p>
</div>
</div>
</div>
</section>


<section id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Oracle 网络配置</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> 配置途径</h3>
<div class="outline-text-3" id="text-2-1">
<ol class="org-ol">
<li>直接修改 NETWORK/ADMIN 下的配置文件
</li>
<li>通过 Oracle 的 Net Manager 工具配置
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> 服务端 (NETWORK/ADMIN/listener.ora)</h3>
<div class="outline-text-3" id="text-2-2">
<ol class="org-ol">
<li>直接修改配置文件或通过图形界面配置。主要配置元素有：
<ul class="org-ul">
<li>协议 (TCP/IP)
</li>
<li>连接地址
</li>
<li>端口号 (默认1521，一般不需要修改)
</li>
</ul>
</li>
<li>开启 TNSListener 服务
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> 客户端 (NETWORK/ADMIN/tnsnames.ora)</h3>
<div class="outline-text-3" id="text-2-3">
<ol class="org-ol">
<li>直接修改配置文件或通过图形界面配置。主要配置元素有：
<ul class="org-ul">
<li>协议 (TCP/IP)
</li>
<li>连接地址 (机器名或IP地址)
</li>
<li>端口号 (默认1521，需要跟服务器端的一致)
</li>
<li>数据库的服务名(默认跟SID/数据库名等是一致的)
</li>
</ul>
</li>
<li>配置完后，就可以通过类似如下语句连接：
<pre class="example">
sqlplus scott/tiger@DBALIAS
</pre>
</li>
</ol>
</div>
</div>
</section>



<section id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> 用户与权限</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> 用户</h3>
<div class="outline-text-3" id="text-3-1">
<p>
用户是用于资源控制和权限管理的一个概念
</p>

<p>
开始新的项目时，保持良好的习惯： 
为项目创建新的用户，指定新的表空间。
</p>
</div>

<div id="outline-container-sec-3-1-1" class="outline-4">
<h4 id="sec-3-1-1"><span class="section-number-4">3.1.1</span> 系统缺省用户</h4>
<div class="outline-text-4" id="text-3-1-1">
</div><ol class="org-ol"><li><a id="sec-3-1-1-1" name="sec-3-1-1-1"></a>SYS 用户，又叫特权用户，数据库中至高无上的用户。<br ><div class="outline-text-5" id="text-3-1-1-1">
<ul class="org-ul">
<li>它是数据库的系统管理员，负责的是数据的安装、维护、升级、备份、恢复、优化等操作。
</li>
<li>不能用 normal 的身份登录，必须用 SYSDBA/SYSOPER 的身份登录。
</li>
<li>即使其他的用户用 SYSDBA/SYSOPER 的身份登录，实际上登录的也是 SYS。
</li>
</ul>
</div>
</li>

<li><a id="sec-3-1-1-2" name="sec-3-1-1-2"></a>SYSTEM 用户。<br ><div class="outline-text-5" id="text-3-1-1-2">
<p>
数据库的管理员。SYSTEM 用户之下保存着数据库运行的一些基本字典数据。
它拥有 DBA 的角色。主要负责对数据库中各种对象，各种资源的管理。
</p>
</div>
</li>

<li><a id="sec-3-1-1-3" name="sec-3-1-1-3"></a>其他用户 (如SCOTT)<br ><div class="outline-text-5" id="text-3-1-1-3">
<p>
普通用户，能够执行被授权范围之内的操作。
</p>
</div>
</li></ol>
</div>

<div id="outline-container-sec-3-1-2" class="outline-4">
<h4 id="sec-3-1-2"><span class="section-number-4">3.1.2</span> 用户的默认表空间</h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
SYS/SYSTEM -&gt; SYSTEM 表空间
</p>

<p>
普通用户  -&gt; USERS 表空间
</p>
</div>
</div>

<div id="outline-container-sec-3-1-3" class="outline-4">
<h4 id="sec-3-1-3"><span class="section-number-4">3.1.3</span> 资源文件 (Profile)</h4>
<div class="outline-text-4" id="text-3-1-3">
<p>
资源文件是口令限制、资源限制的命名集合
</p>

<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#26597;&#35810;</span>
<span style="color: #a020f0;">select</span> *<span style="color: #a020f0;">from</span> dba_profiles <span style="color: #a020f0;">where</span> profile = <span style="color: #8b2252;">'DEFAULT'</span>;    <span style="color: #b22222;">-- default profile</span>

<span style="color: #b22222;">-- &#21019;&#24314;</span>
<span style="color: #a020f0;">CREATE</span> PROFILE filename <span style="color: #a020f0;">LIMIT</span>
  SESSION_PER_USER <span style="color: #228b22;">integer</span>
  CPU_PER_SESSION <span style="color: #228b22;">integer</span>
  USER_PER_CALL <span style="color: #228b22;">integer</span>
  CONNECT_TIME <span style="color: #228b22;">integer</span>|UNLIMITED

<span style="color: #b22222;">-- RESOURCE_LIMIT &#35774;&#32622;&#20026; TRUE&#65292;&#25165;&#20250;&#26377;&#25928;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">system</span> <span style="color: #a020f0;">set</span> RESOURCE_LIMIT = <span style="color: #a020f0;">TRUE</span>;
<span style="color: #b22222;">-- &#21019;&#24314;&#36164;&#28304;&#38480;&#21046;&#25991;&#20214;</span>
<span style="color: #a020f0;">create</span> profile myprofile <span style="color: #a020f0;">limit</span> failed_login_attempts 3;
</pre>
</div>

<p>
常用选项（我随便写的，你们自己再整理修订下）
</p>
<table>


<colgroup>
<col  class="left">

<col  class="left">
</colgroup>
<tbody>
<tr>
<td class="left">FAILED_LOGIN_ATTEMPTS</td>
<td class="left">用于指定联系登陆的最大失败次数.</td>
</tr>

<tr>
<td class="left">PASSWORD_LOCK_TIME</td>
<td class="left">用于指定帐户被锁定的天数.</td>
</tr>

<tr>
<td class="left">PASSWORD_LIFE_TIME</td>
<td class="left">用于指定口令有效期</td>
</tr>

<tr>
<td class="left">PASSWORD_GRACE_TIME</td>
<td class="left">用于指定口令宽限期.</td>
</tr>

<tr>
<td class="left">PASSWORD_REUSE_TIME</td>
<td class="left">用于指定口令可用时间.</td>
</tr>

<tr>
<td class="left">PASSWORD_REUSE_MAX</td>
<td class="left">用于指定口令在有效期内可更改次数.</td>
</tr>

<tr>
<td class="left">PASSWORD_VERIFY_FUNCTION</td>
<td class="left">是否校验口令(校验将值改为VERIFY_FUNCTION)</td>
</tr>

<tr>
<td class="left">CPU_PER_SESSION</td>
<td class="left">用于指定每个会话可以占用的最大CPU时间.</td>
</tr>

<tr>
<td class="left">LOGICAL_READS_PER_SESSON</td>
<td class="left">用于指定会话的最大逻辑读取次数.</td>
</tr>

<tr>
<td class="left">PRIVATE_SGA</td>
<td class="left">用于指定会话在共享池中可以分配的最大总计私有空间.</td>
</tr>

<tr>
<td class="left">COMPOSITE_LIMIT</td>
<td class="left">用于指定会话的总计资源消耗</td>
</tr>

<tr>
<td class="left">CPU_PER_CALL</td>
<td class="left">限制每次调用可占用的最大CPU时间</td>
</tr>

<tr>
<td class="left">LOGICAL_READS_PER_CALL</td>
<td class="left">用于限制每次调用的最大逻辑I/O次数.</td>
</tr>

<tr>
<td class="left">SESSIONS_PER_USER</td>
<td class="left">用于指定每个用户的最大并发会话个数.</td>
</tr>

<tr>
<td class="left">CONNECT_TIME</td>
<td class="left">用于指定会话的最大连接时间.</td>
</tr>

<tr>
<td class="left">IDLE_TIME</td>
<td class="left">用于指定会话的最大空闲时间.</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-3-1-4" class="outline-4">
<h4 id="sec-3-1-4"><span class="section-number-4">3.1.4</span> 创建/修改/删除用户</h4>
<div class="outline-text-4" id="text-3-1-4">
<ol class="org-ol">
<li>创建用户语法格式
<pre class="example">
create USER name
  identified by password
  [default tablespace users]
  [temporary tablespace temp]
  [profile default]
  [quota xxx on users]
  [other key/value pair]
</pre>
</li>

<li>修改用户语法格式
<pre class="example">
alter USER name
  identified by password
  [default tablespace users]
  [temporary tablespace temp]
  [profile default]
  [quota xxx on users]
  [other key/value pair]
</pre>
</li>

<li>删除用户
<pre class="example">
drop USER name [cascade]
</pre>
</li>

<li>操作示例
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#26597;&#35810;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> dba_users <span style="color: #a020f0;">where</span> username=<span style="color: #8b2252;">'SCOTT'</span>;

<span style="color: #b22222;">-- &#26368;&#22522;&#26412;&#30340;&#21019;&#24314;&#35821;&#27861;&#65288;&#29992;&#25143;&#21517;+&#23494;&#30721;&#65289;</span>
<span style="color: #a020f0;">create</span> <span style="color: #483d8b;">user</span> vip identified <span style="color: #a020f0;">by</span> vip;

<span style="color: #b22222;">-- &#36739;&#35814;&#32454;&#30340;&#21019;&#24314;&#35821;&#27861;</span>
<span style="color: #a020f0;">create</span> <span style="color: #483d8b;">User</span> vip
  identified <span style="color: #a020f0;">by</span> vip
  <span style="color: #a020f0;">default</span> tablespace users
  <span style="color: #a020f0;">temporary</span> <span style="color: #a020f0;">temporary</span> temp
  profile <span style="color: #a020f0;">default</span>
  quota ulimited <span style="color: #a020f0;">on</span> users;

<span style="color: #b22222;">-- &#20462;&#25913;&#29992;&#25143;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #483d8b;">user</span> vip identified <span style="color: #a020f0;">by</span> vop;
<span style="color: #a020f0;">alter</span> <span style="color: #483d8b;">user</span> vip profile ttt;
<span style="color: #a020f0;">alter</span> <span style="color: #483d8b;">user</span> vip <span style="color: #a020f0;">default</span> <span style="color: #0000ff;">tablespace</span> <span style="color: #a020f0;">system</span>;
<span style="color: #a020f0;">alter</span> <span style="color: #483d8b;">user</span> vip <span style="color: #a020f0;">temporary</span> tablespace mytemp;
<span style="color: #a020f0;">alter</span> <span style="color: #483d8b;">user</span> vip account unlock/lock;
<span style="color: #a020f0;">alter</span> <span style="color: #483d8b;">user</span> vip quota unlimited <span style="color: #a020f0;">on</span> test;  <span style="color: #b22222;">-- very good</span>

<span style="color: #b22222;">-- &#21024;&#38500;&#29992;&#25143;&#12290;&#22914;&#26524;&#29992;&#25143;&#19979;&#23384;&#22312;&#23545;&#35937;&#65292;&#38656;&#35201;&#28155;&#21152; cascade &#20851;&#38190;&#35789;&#12290;</span>
<span style="color: #a020f0;">drop</span> <span style="color: #483d8b;">user</span> vip;
<span style="color: #a020f0;">drop</span> <span style="color: #483d8b;">user</span> vip <span style="color: #a020f0;">cascade</span>;
</pre>
</div>
</li>
</ol>
</div>
</div>
</div>


<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> 权限</h3>
<div class="outline-text-3" id="text-3-2">
<p>
权限指的是执行特定命令或访问数据库对象的权利。分为系统权限和对象权限。
</p>
</div>

<div id="outline-container-sec-3-2-1" class="outline-4">
<h4 id="sec-3-2-1"><span class="section-number-4">3.2.1</span> 系统权限 (执行特定命令)</h4>
<div class="outline-text-4" id="text-3-2-1">
</div><ol class="org-ol"><li><a id="sec-3-2-1-1" name="sec-3-2-1-1"></a>授权语法<br ><div class="outline-text-5" id="text-3-2-1-1">
<pre class="example">
grant 权限名字 to 用户 [with admin option]
</pre>
<p>
with admin option 参数可以使得到授权的用户有权把得到的权限授予其他用户。
</p>
</div>
</li>

<li><a id="sec-3-2-1-2" name="sec-3-2-1-2"></a>撤销语法<br ><div class="outline-text-5" id="text-3-2-1-2">
<pre class="example">
revoke 权限名字 from 用户
</pre>
</div>
</li>

<li><a id="sec-3-2-1-3" name="sec-3-2-1-3"></a>相关的字典表<br ><div class="outline-text-5" id="text-3-2-1-3">
<pre class="example">
select * from system_privilege_map;  -- 所有的系统权限
select * from dba_sys_privs where grantee='SCOTT';         -- 目前已经被授权的系统权限
</pre>
</div>
</li></ol>
</div>

<div id="outline-container-sec-3-2-2" class="outline-4">
<h4 id="sec-3-2-2"><span class="section-number-4">3.2.2</span> 对象权限 (访问数据库对象)</h4>
<div class="outline-text-4" id="text-3-2-2">
</div><ol class="org-ol"><li><a id="sec-3-2-2-1" name="sec-3-2-2-1"></a>授权语法<br ><div class="outline-text-5" id="text-3-2-2-1">
<pre class="example">
grant 对象权限的关键词(select/update/..)on [schema.]对象名字 to 用户 [with granted option];
grant all on scott.emp to vip with grant option;
</pre>
</div>
</li>

<li><a id="sec-3-2-2-2" name="sec-3-2-2-2"></a>撤销权限<br ><div class="outline-text-5" id="text-3-2-2-2">
<pre class="example">
revoke 权限名字 from 用户
</pre>
</div>
</li>

<li><a id="sec-3-2-2-3" name="sec-3-2-2-3"></a>相关的字典表<br ><div class="outline-text-5" id="text-3-2-2-3">
<pre class="example">
select * from dba_tab_privs/all_tab_privs/user_tab_privs;      -- 存放的是所有对象权限的授权情况。
</pre>
</div>
</li></ol>
</div>

<div id="outline-container-sec-3-2-3" class="outline-4">
<h4 id="sec-3-2-3"><span class="section-number-4">3.2.3</span> 示例</h4>
<div class="outline-text-4" id="text-3-2-3">
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#25480;&#26435;</span>
<span style="color: #a020f0;">grant</span> <span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #a020f0;">to</span> vip;
<span style="color: #a020f0;">grant</span> <span style="color: #a020f0;">create</span> <span style="color: #a020f0;">session</span> <span style="color: #a020f0;">to</span> vip <span style="color: #707183;">[</span><span style="color: #a020f0;">with</span> <span style="color: #a020f0;">admin</span> <span style="color: #a020f0;">option</span><span style="color: #707183;">]</span>;
<span style="color: #a020f0;">grant</span> <span style="color: #a020f0;">select</span>, <span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">on</span> sys.dba_tab_privs <span style="color: #a020f0;">to</span> vip;
<span style="color: #a020f0;">grant</span> <span style="color: #a020f0;">all</span> <span style="color: #a020f0;">on</span> scott <span style="color: #a020f0;">to</span> vip;           <span style="color: #b22222;">-- &#25480;&#20104;&#25152;&#26377;</span>

<span style="color: #a020f0;">grant</span> <span style="color: #a020f0;">create</span> synonym <span style="color: #a020f0;">to</span> vip;         <span style="color: #b22222;">-- &#21487;&#20197;&#20026;&#33258;&#24049;&#21019;&#24314; synonym</span>
<span style="color: #a020f0;">grant</span> <span style="color: #a020f0;">create</span> <span style="color: #a020f0;">any</span> synonym <span style="color: #a020f0;">to</span> vip;     <span style="color: #b22222;">-- &#21487;&#20197;&#20026;&#20219;&#24847;&#29992;&#25143;&#21019;&#24314; synonym</span>
<span style="color: #a020f0;">grant</span> <span style="color: #a020f0;">create</span> <span style="color: #a020f0;">public</span> synonym <span style="color: #a020f0;">to</span> vip;  <span style="color: #b22222;">-- &#21487;&#20197;&#21019;&#24314; public synonym</span>

<span style="color: #b22222;">-- &#25764;&#26435;</span>
<span style="color: #a020f0;">revoke</span> <span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span>, <span style="color: #a020f0;">create</span> <span style="color: #a020f0;">session</span> <span style="color: #a020f0;">from</span> rain;
<span style="color: #a020f0;">revoke</span> <span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">on</span> scott <span style="color: #a020f0;">from</span> vip;
</pre>
</div>
</div>
</div>
</div>



<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> 角色</h3>
<div class="outline-text-3" id="text-3-3">
<p>
角色是权限的命名集合。
</p>
</div>

<div id="outline-container-sec-3-3-1" class="outline-4">
<h4 id="sec-3-3-1"><span class="section-number-4">3.3.1</span> 创建角色</h4>
<div class="outline-text-4" id="text-3-3-1">
<pre class="example">
create role name
</pre>
</div>
</div>

<div id="outline-container-sec-3-3-2" class="outline-4">
<h4 id="sec-3-3-2"><span class="section-number-4">3.3.2</span> 配置角色</h4>
<div class="outline-text-4" id="text-3-3-2">
<pre class="example">
grant 权限名字 to 角色名字
grant 角色名字 to 角色名字
</pre>
</div>
</div>

<div id="outline-container-sec-3-3-3" class="outline-4">
<h4 id="sec-3-3-3"><span class="section-number-4">3.3.3</span> 使用角色</h4>
<div class="outline-text-4" id="text-3-3-3">
<pre class="example">
grant 角色名字 to 用户名字
</pre>
</div>
</div>

<div id="outline-container-sec-3-3-4" class="outline-4">
<h4 id="sec-3-3-4"><span class="section-number-4">3.3.4</span> 删除角色</h4>
<div class="outline-text-4" id="text-3-3-4">
<pre class="example">
drop ROLE 角色名字
</pre>
</div>
</div>

<div id="outline-container-sec-3-3-5" class="outline-4">
<h4 id="sec-3-3-5"><span class="section-number-4">3.3.5</span> 相关的字典表</h4>
<div class="outline-text-4" id="text-3-3-5">
<pre class="example">
select * from dba_roles;                            -- 列出系统中所有存在的角色。
select * from dba_sys_privs where grantee='DBA';    -- 查看DBA所拥有的所有系统权限
select * from dba_role_privs where grantee='SYSTEM' -- 查看用户所拥有的所有角色
</pre>
</div>
</div>

<div id="outline-container-sec-3-3-6" class="outline-4">
<h4 id="sec-3-3-6"><span class="section-number-4">3.3.6</span> 特殊的 PUBLIC 角色</h4>
<div class="outline-text-4" id="text-3-3-6">
<p>
公用角色，默认是授予每个用户的。
</p>
</div>
</div>
</div>
</section>

<section id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> SQL语句</h2>
<div class="outline-text-2" id="text-4">
<p>
Structured Query Language，结构性查询语言。
</p>
</div>

<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> SQL 的历史及概念</h3>
</div>
<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> SQL 的分类</h3>
<div class="outline-text-3" id="text-4-2">
</div><div id="outline-container-sec-4-2-1" class="outline-4">
<h4 id="sec-4-2-1"><span class="section-number-4">4.2.1</span> DDL（Data Definition Language）</h4>
<div class="outline-text-4" id="text-4-2-1">
</div><ol class="org-ol"><li><a id="sec-4-2-1-1" name="sec-4-2-1-1"></a>CREATE<br ><div class="outline-text-5" id="text-4-2-1-1">
<p>
创建表的典型语句为:
</p>
<pre class="example">
create TABLE table_name
(column_name column_type,[column_name column_type...]);
</pre>

<p>
例子:
</p>
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#26368;&#22522;&#26412;&#30340;&#21019;&#24314;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">OrderTB</span> <span style="color: #707183;">(</span>id <span style="color: #a020f0;">number</span>, <span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#28155;&#21152;&#20027;&#38190;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">OrderTB</span> <span style="color: #707183;">(</span>id <span style="color: #a020f0;">number</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span>, <span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">OrderTB</span> 
  <span style="color: #707183;">(</span>id <span style="color: #a020f0;">number</span>,
   <span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>,
   <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span><span style="color: #7388d6;">(</span>id<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">OrderTB</span> <span style="color: #707183;">(</span>id <span style="color: #a020f0;">number</span>, <span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>, <span style="color: #a020f0;">constraints</span> pk_ordertb <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span><span style="color: #7388d6;">(</span>id<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#28155;&#21152;&#22806;&#38190;&#65292;&#22806;&#38190;&#26144;&#23556;&#21040;&#30340;&#24517;&#39035;&#26159;&#20027;&#38190;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">sex</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">value</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span>, detail varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">Mates</span> <span style="color: #707183;">(</span>id <span style="color: #a020f0;">number</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span>, <span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>, sex <span style="color: #a020f0;">number</span> <span style="color: #a020f0;">references</span> sex<span style="color: #7388d6;">(</span><span style="color: #a020f0;">value</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;

<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">Mates</span> 
  <span style="color: #707183;">(</span>id <span style="color: #a020f0;">number</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span>,
   <span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>,
   sex <span style="color: #a020f0;">number</span>,
   <span style="color: #a020f0;">foreign</span> <span style="color: #a020f0;">key</span> <span style="color: #7388d6;">(</span>sex<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">references</span> sex<span style="color: #7388d6;">(</span><span style="color: #a020f0;">value</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;

<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">Mates</span> 
  <span style="color: #707183;">(</span>id <span style="color: #a020f0;">number</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span>,
   <span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>,
   sex <span style="color: #a020f0;">number</span>,
   <span style="color: #a020f0;">constraints</span> fk_mates <span style="color: #a020f0;">foreign</span> <span style="color: #a020f0;">key</span> <span style="color: #7388d6;">(</span>sex<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">references</span> sex<span style="color: #7388d6;">(</span><span style="color: #a020f0;">value</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- check &#32422;&#26463;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">Classes</span> <span style="color: #707183;">(</span>id <span style="color: #a020f0;">number</span>, <span style="color: #483d8b;">count</span> <span style="color: #a020f0;">number</span> <span style="color: #a020f0;">check</span> <span style="color: #7388d6;">(</span><span style="color: #483d8b;">count</span> &gt; 10 <span style="color: #a020f0;">and</span> <span style="color: #483d8b;">count</span> &lt; 100<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">Classes222</span>
<span style="color: #707183;">(</span> id <span style="color: #a020f0;">number</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span>,
  <span style="color: #483d8b;">count</span> <span style="color: #a020f0;">number</span>,
  <span style="color: #a020f0;">constraints</span> ck_classes <span style="color: #a020f0;">check</span> <span style="color: #7388d6;">(</span><span style="color: #483d8b;">count</span> &gt; 10 <span style="color: #a020f0;">and</span> <span style="color: #483d8b;">count</span> &lt; 100<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- TODO Unique &#32422;&#26463;</span>


<span style="color: #b22222;">-- &#21452;&#24341;&#21495;&#24378;&#21046;&#34920;&#21517;&#20445;&#30041;&#21407;&#26469;&#30340;&#22823;&#23567;&#20889;&#12290;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> "XiaoMing" <span style="color: #707183;">(</span><span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>, age <span style="color: #228b22;">int</span><span style="color: #707183;">)</span>;


<span style="color: #b22222;">-- &#21019;&#24314;&#19968;&#24352;&#34920;&#65292;&#19981;&#29983;&#20135;&#37325;&#20570;&#26085;&#24535;&#30340;&#35805;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">nologtab</span> <span style="color: #707183;">(</span>id <span style="color: #a020f0;">number</span><span style="color: #707183;">)</span> nologging;


<span style="color: #b22222;">-- &#21019;&#24314;&#19968;&#24352;&#34920;&#65292;&#25351;&#23450;&#21478;&#22806;&#30340;&#34920;&#31354;&#38388;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">spetab</span> <span style="color: #707183;">(</span>id <span style="color: #a020f0;">number</span><span style="color: #707183;">)</span> tablespace <span style="color: #a020f0;">system</span>;

<span style="color: #b22222;">-- &#24378;&#21046;&#23383;&#27573;&#20869;&#23481;&#19981;&#33021;&#20026;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">notnulltab</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#25351;&#23450;&#26576;&#20010;&#23383;&#27573;&#30340;&#40664;&#35748;&#20540;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">tab_defaultval</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>, sex <span style="color: #a020f0;">number</span> <span style="color: #a020f0;">default</span> 1<span style="color: #707183;">)</span>;
</pre>
</div>

<p>
需要注意，首先，表的名字要符合一定的规范(长度，组成字符，保留字，以及其他)。
</p>

<p>
Oracle 会自动把表名转换为大写，但是如果想保留大小写的话，可以在创建表的时候，把表名用双引号括起来。
</p>

<p>
主键：
</p>

<p>
需要简短、效率、不重复、不可改变。
所以，不要用业务字段作为主键，即使觉得业务字段是唯一且不可改变的。因为，你觉得不可改变的东西，往往经不住时间的考验。
需要用自增的，简单的，跟业务没有关系的，所谓的代理主键。<a href="http://www.w3school.com.cn/sql/sql_autoincrement.asp">就比如 sqlserver 中的 identity, MySQL 中的 auto_increment</a>.
</p>

<p>
查看数据库中表的 DDL 语句：
</p>
<pre class="example">
set long 999
select DBMS_METADATA.get_ddl('TABLE', 'EMP') from dual;
</pre>


<p>
从已经存在的表中，创建新的表
</p>

<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#35821;&#27861;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">&#34920;&#21517;</span> <span style="color: #a020f0;">as</span> <span style="color: #a020f0;">select</span> clause...

<span style="color: #b22222;">-- &#31616;&#21333;&#24212;&#29992;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">emp1</span> <span style="color: #a020f0;">as</span> <span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> scott.emp;

<span style="color: #b22222;">-- &#38480;&#23450;&#21015;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">emp2</span> <span style="color: #a020f0;">as</span> <span style="color: #a020f0;">select</span> empno, ename, hiredate <span style="color: #a020f0;">from</span> scott.emp;

<span style="color: #b22222;">-- &#38480;&#23450;&#21015;&#30340;&#36807;&#31243;&#20013;&#65292;&#21487;&#20197;&#20351;&#29992;&#36816;&#31639;&#31526;&#25110;&#32773;&#20989;&#25968;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">emp2</span> <span style="color: #a020f0;">as</span> <span style="color: #a020f0;">select</span> empno, ename, sal/1000 s <span style="color: #a020f0;">from</span> scott.emp;

<span style="color: #b22222;">-- &#38480;&#23450;&#34892;(&#38480;&#23450;&#25554;&#20837;&#30340;&#25968;&#25454;)</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">emp3</span> <span style="color: #a020f0;">as</span> <span style="color: #a020f0;">select</span> empno, ename <span style="color: #a020f0;">from</span> scott.emp <span style="color: #a020f0;">where</span> empno &lt; 7566;

<span style="color: #b22222;">-- &#22914;&#26524;&#21482;&#24819;&#22797;&#21046;&#34920;&#30340;&#32467;&#26500;&#30340;&#35805;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">emp4</span> <span style="color: #a020f0;">as</span> <span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> scott.emp <span style="color: #a020f0;">where</span> 1=2;
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">emp4</span> <span style="color: #a020f0;">as</span> <span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> scott.emp <span style="color: #a020f0;">where</span> rownum &lt; 1;
</pre>
</div>
</div>
</li>


<li><a id="sec-4-2-1-2" name="sec-4-2-1-2"></a>ALTER<br ><div class="outline-text-5" id="text-4-2-1-2">
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#26368;&#22522;&#26412;&#30340;&#29992;&#27861;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">&#34920;&#21517;</span> &#25805;&#20316;&#20851;&#38190;&#35789; &#23646;&#24615;


<span style="color: #b22222;">-- &#28155;&#21152;&#19968;&#20010;&#21015;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> sss <span style="color: #a020f0;">add</span> howsoon <span style="color: #a020f0;">number</span> <span style="color: #a020f0;">default</span> <span style="color: #0000ff;">0</span>;
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">sss</span> <span style="color: #a020f0;">add</span> <span style="color: #707183;">(</span>status <span style="color: #228b22;">char</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">sss</span> <span style="color: #a020f0;">add</span> <span style="color: #707183;">(</span>status <span style="color: #228b22;">char</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span><span style="color: #707183;">)</span>;         <span style="color: #b22222;">-- &#21487;&#20197;&#28155;&#21152;&#20854;&#20182;&#30340;&#23646;&#24615;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">sss</span> <span style="color: #a020f0;">add</span> <span style="color: #707183;">(</span>status <span style="color: #228b22;">char</span> <span style="color: #a020f0;">default</span> <span style="color: #8b2252;">'1'</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#28155;&#21152;&#19968;&#20010;&#20027;&#38190;&#32422;&#26463;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">sss</span> <span style="color: #a020f0;">add</span> <span style="color: #a020f0;">constraints</span> pk_sss <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span> <span style="color: #707183;">(</span>id<span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#21024;&#38500;&#19968;&#20010;&#21015;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">sss</span> <span style="color: #a020f0;">drop</span> <span style="color: #a020f0;">COLUMN</span> howsoon;

<span style="color: #b22222;">-- &#21024;&#38500;&#20027;&#38190;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">sss</span> <span style="color: #a020f0;">drop</span> <span style="color: #a020f0;">CONSTRAINTS</span> pk_sss;

<span style="color: #b22222;">-- &#21024;&#38500;&#22806;&#38190;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">&#34920;&#21517;</span> <span style="color: #a020f0;">drop</span> <span style="color: #a020f0;">constraints</span> &#22806;&#38190;&#21517;;

<span style="color: #b22222;">-- &#20462;&#25913;&#21015;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">sss</span> <span style="color: #a020f0;">modify</span> <span style="color: #707183;">(</span>status varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#26356;&#25913;&#21015;&#21517;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">sss</span> rename <span style="color: #a020f0;">COLUMN</span> status <span style="color: #a020f0;">TO</span> flag;


<span style="color: #b22222;">-- &#26356;&#25913;&#34920;&#30340;&#34920;&#31354;&#38388;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">sss</span> move tablespace <span style="color: #a020f0;">system</span>;


<span style="color: #b22222;">-- &#26356;&#25913;&#26159;&#21542;&#35760;&#24405;&#26085;&#24535;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">sss</span> logging;
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">sss</span> nologging;


<span style="color: #b22222;">-- &#22914;&#20309;&#21435;&#32473;&#19968;&#20010;&#34920;&#25913;&#21517;&#23383;</span>
<span style="color: #a020f0;">ALTER</span> <span style="color: #a020f0;">TABLE</span> <span style="color: #0000ff;">sss</span> RENAME <span style="color: #a020f0;">TO</span> sss_new;
rename sss <span style="color: #a020f0;">to</span> sss_new;
</pre>
</div>
</div>
</li>


<li><a id="sec-4-2-1-3" name="sec-4-2-1-3"></a>DROP<br ><div class="outline-text-5" id="text-4-2-1-3">
<pre class="example">
drop table 表名;
drop table 表名 cascade constraints;  -- 注意，只是删除约束
</pre>

<p>
如果表存在被外键引用的情况的话，要删除有一下几种方式：
</p>
<ol class="org-ol">
<li>删除外键引用的表
</li>
<li>删除外键引用表上存在的外键约束
</li>
<li>在删除的过程中加上关键字 cascade constraints.
</li>
</ol>
</div>
</li></ol>
</div>

<div id="outline-container-sec-4-2-2" class="outline-4">
<h4 id="sec-4-2-2"><span class="section-number-4">4.2.2</span> DML（Data Manipulation Language）</h4>
<div class="outline-text-4" id="text-4-2-2">
<p>
概念，增删改查，又叫 CRUD(Create/Read/Update/Delete)
</p>
</div>

<ol class="org-ol"><li><a id="sec-4-2-2-1" name="sec-4-2-2-1"></a>查询(select)<br ><div class="outline-text-5" id="text-4-2-2-1">
<p>
基本语法:
</p>
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #a020f0;">select</span> <span style="color: #a020f0;">distinct</span> &#23383;&#27573;&#21517;|&#34920;&#36798;&#24335; <span style="color: #a020f0;">from</span> <span style="color: #707183;">[</span><span style="color: #a020f0;">schema</span>.<span style="color: #707183;">]</span>&#34920;&#21517;
  <span style="color: #a020f0;">where</span> clause
  <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> clause
  <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> clause
  <span style="color: #a020f0;">having</span> clause;
</pre>
</div>


<p>
用法示例：
</p>
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#22522;&#26412;&#30340;&#26597;&#35810;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> scott.emp;   <span style="color: #b22222;">-- * &#20195;&#34920;&#25152;&#26377;&#30340;&#21015;&#65292;&#20294;&#22312;&#29983;&#20135;&#29615;&#22659;&#20013;&#19981;&#24314;&#35758;&#20351;&#29992;&#12290;&#26377;&#26102;&#20505;&#20250;&#24456;&#20302;&#25928;&#12290;&#32780;&#19988;&#19981;&#20415;&#20110;&#35299;&#32806;&#21512;&#12290;</span>

<span style="color: #b22222;">-- &#22522;&#26412;&#30340;&#26465;&#20214;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> scott.emp <span style="color: #a020f0;">where</span> empno &lt; 7802;

<span style="color: #b22222;">-- &#25490;&#24207;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> scott.emp <span style="color: #a020f0;">where</span> empno &lt; 7902 <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> empno;
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> scott.emp <span style="color: #a020f0;">where</span> empno &lt; 7902 <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> empno <span style="color: #a020f0;">desc</span>;   <span style="color: #b22222;">-- &#38477;&#24207;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> scott.emp <span style="color: #a020f0;">where</span> empno &lt; 7902 <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> job, empno;   <span style="color: #b22222;">-- &#32452;&#21512;&#22810;&#20010;&#25490;&#24207;&#30340;&#21015;</span>

<span style="color: #b22222;">-- distinct</span>
<span style="color: #a020f0;">select</span> <span style="color: #a020f0;">distinct</span> job <span style="color: #a020f0;">from</span> emp;
<span style="color: #a020f0;">select</span> <span style="color: #a020f0;">distinct</span> job, sal <span style="color: #a020f0;">from</span> emp;

<span style="color: #b22222;">-- alias</span>
<span style="color: #a020f0;">select</span> to_char<span style="color: #707183;">(</span>empno<span style="color: #707183;">)</span> <span style="color: #a020f0;">as</span> empnochar <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> sal &gt; 5000;
</pre>
</div>


<p>
表的连接
</p>
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- cross join(&#21449;&#20056;&#65292;&#31515;&#21345;&#23572;&#31215;)&#12290;&#23637;&#31034;&#25152;&#26377;&#30340;&#35760;&#24405;&#30340;&#32452;&#21512;&#12290;&#26159;&#20869;&#36830;&#25509;&#21644;&#22806;&#36830;&#25509;&#30340;&#22522;&#30784;&#12290;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> a <span style="color: #a020f0;">cross</span> <span style="color: #a020f0;">join</span> b;
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> a, b;

<span style="color: #b22222;">-- inner join(&#20869;&#36830;&#25509;)</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> a <span style="color: #a020f0;">inner</span> <span style="color: #a020f0;">join</span> b <span style="color: #a020f0;">on</span> a.deptno = b.deptno;
<span style="color: #a020f0;">select</span> a.ename, b.deptname <span style="color: #a020f0;">from</span> a <span style="color: #a020f0;">inner</span> <span style="color: #a020f0;">join</span> b <span style="color: #a020f0;">using</span> <span style="color: #707183;">(</span>deptno<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">select</span> a.ename, b.deptname <span style="color: #a020f0;">from</span> a,b <span style="color: #a020f0;">where</span> b.deptno=a.deptno; <span style="color: #b22222;">-- oracle &#20013;&#30340;&#20889;&#27861;</span>

<span style="color: #b22222;">-- outer join(&#22806;&#36830;&#25509;)</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> a <span style="color: #a020f0;">left</span> <span style="color: #a020f0;">join</span> b <span style="color: #a020f0;">on</span> a.deptno = b.deptno;
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> a <span style="color: #a020f0;">left</span> <span style="color: #a020f0;">outer</span> <span style="color: #a020f0;">join</span> b <span style="color: #a020f0;">using</span> <span style="color: #707183;">(</span>deptno<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> a <span style="color: #a020f0;">right</span> <span style="color: #a020f0;">outer</span> <span style="color: #a020f0;">join</span> b <span style="color: #a020f0;">on</span> a.deptno = b.deptno;
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> a <span style="color: #a020f0;">full</span> <span style="color: #a020f0;">join</span> b <span style="color: #a020f0;">on</span> a.deptno = b.deptno;   <span style="color: #b22222;">-- &#20840;&#36830;&#25509;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> a, b <span style="color: #a020f0;">where</span> a.deptno=b.deptno<span style="color: #707183;">(</span>+<span style="color: #707183;">)</span>;        <span style="color: #b22222;">-- &#24038;&#22806;&#36830;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> a, b <span style="color: #a020f0;">where</span> a.deptno<span style="color: #707183;">(</span>+<span style="color: #707183;">)</span>=b.deptno;        <span style="color: #b22222;">-- &#21491;&#36830;&#25509;</span>
</pre>
</div>
</div>

<ol class="org-ol"><li><a id="sec-4-2-2-1-1" name="sec-4-2-2-1-1"></a><span class="todo TODO">TODO</span> 阶段性作业（scott用户下的表）<br ><div class="outline-text-6" id="text-4-2-2-1-1">
<ol class="org-ol">
<li>查询每个部门下有多少员工
</li>
<li>查询除去 salesman 所有平均工资超过 1500 的部门
</li>
<li>查询在 new york 工作的所有员工的姓名，部门名称和工资信息
</li>
<li>查询姓名为 King 的员工的编号，名称跟部门
</li>
<li>查询各种工作的最低工资
</li>
<li>查询工龄大于10年的所有员工信息
</li>
<li>查询每个部门员工数量，平均工资和平均工作年限
</li>
<li>统计各部门每个工种的人数，平均工资。
</li>
<li>查询从事同一种工作但不属于同一部门的员工信息。
</li>
<li>查询所有员工工资都大于1000的部门的信息及员工信息
</li>
<li>查询入职日期早于其直接上级的所有员工信息。
</li>
<li>列出雇员中（除去mgr为空的人)工资第二高的人。
</li>
<li>列出1981年来公司所有员工的总收入（包括sal和comm）
</li>
</ol>
</div>
</li>

<li><a id="sec-4-2-2-1-2" name="sec-4-2-2-1-2"></a>Group By<br ><div class="outline-text-6" id="text-4-2-2-1-2">
<p>
示例：
</p>
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> deptno;    <span style="color: #b22222;">-- &#38169;&#35823;&#30340;&#29992;&#27861;&#12290;&#22240;&#20026;&#29992;group by&#20043;&#21518;&#65292;&#38656;&#35201;&#25351;&#23450;&#36319;&#20998;&#32452;&#30456;&#20851;&#30340;&#21015;&#12289;&#23383;&#27573;&#12290;</span>

<span style="color: #b22222;">-- &#26597;&#30475;&#27599;&#19968;&#32452;&#30340;&#25968;&#30446;</span>
<span style="color: #a020f0;">select</span> deptno, <span style="color: #483d8b;">count</span><span style="color: #707183;">(</span>*<span style="color: #707183;">)</span> <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> deptno;  <span style="color: #b22222;">-- &#26597;&#30475;&#27599;&#19968;&#20010;&#37096;&#38376;&#26377;&#22810;&#23569;&#20154;</span>

<span style="color: #b22222;">-- &#26597;&#35810;&#27599;&#20010;&#37096;&#38376;&#19979;&#26377;&#22810;&#23569;&#21592;&#24037;</span>
<span style="color: #a020f0;">select</span> d.dname, <span style="color: #483d8b;">count</span><span style="color: #707183;">(</span>*<span style="color: #707183;">)</span> <span style="color: #a020f0;">from</span> dept d, emp e 
  <span style="color: #a020f0;">where</span> d.deptno = e.deptno <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> d.dname;
<span style="color: #a020f0;">select</span> d.dname,e.c 
  <span style="color: #a020f0;">from</span> dept d,
       <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> deptno, <span style="color: #483d8b;">count</span><span style="color: #7388d6;">(</span>*<span style="color: #7388d6;">)</span> c <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> deptno<span style="color: #707183;">)</span> e
 <span style="color: #a020f0;">where</span> d.deptno = e.deptno;


<span style="color: #b22222;">-- &#20998;&#32452;&#30340;&#39034;&#24207;&#26159;&#36825;&#26679;&#30340;&#65306; </span>
<span style="color: #b22222;">-- &#39318;&#20808;&#65292;where&#36807;&#28388;&#21407;&#22987;&#25968;&#25454;&#65307;</span>
<span style="color: #b22222;">-- &#20854;&#27425;,&#20381;&#25454; group by &#36827;&#34892;&#20998;&#32452;&#65292;&#24471;&#21040;&#36319;&#20998;&#32452;&#25968;&#30456;&#21516;&#30340;&#35760;&#24405;&#25968;&#30446;&#65307;</span>
<span style="color: #b22222;">-- &#26368;&#21518;&#65292;&#29992;having&#23545;groupby&#20043;&#21518;&#20135;&#29983;&#30340;&#32467;&#26524;&#20877;&#36827;&#34892;&#36807;&#28388;&#12290;</span>
<span style="color: #a020f0;">select</span> gno,
    <span style="color: #483d8b;">count</span><span style="color: #707183;">(</span>*<span style="color: #707183;">)</span> &#20154;&#25968;,
    <span style="color: #483d8b;">max</span><span style="color: #707183;">(</span>yanzhi<span style="color: #707183;">)</span> &#26368;&#32654;,
    <span style="color: #483d8b;">min</span><span style="color: #707183;">(</span>yanzhi<span style="color: #707183;">)</span> &#26368;&#26377;&#25165;,
    <span style="color: #483d8b;">avg</span><span style="color: #707183;">(</span>yanzhi<span style="color: #707183;">)</span> &#24179;&#22343;,
    <span style="color: #483d8b;">sum</span><span style="color: #707183;">(</span>yanzhi<span style="color: #707183;">)</span> &#24635;&#21644;
  <span style="color: #a020f0;">from</span> boysandgirls
    <span style="color: #a020f0;">where</span> <span style="color: #a020f0;">name</span> &lt;&gt; <span style="color: #8b2252;">'&#40644;'</span>
    <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> gno
    <span style="color: #a020f0;">having</span> <span style="color: #483d8b;">sum</span><span style="color: #707183;">(</span>yanzhi<span style="color: #707183;">)</span>&gt;400;

<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span>
  <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> gno,
      <span style="color: #483d8b;">count</span><span style="color: #7388d6;">(</span>*<span style="color: #7388d6;">)</span> &#20154;&#25968;,
      <span style="color: #483d8b;">max</span><span style="color: #7388d6;">(</span>yanzhi<span style="color: #7388d6;">)</span> &#26368;&#32654;,
      <span style="color: #483d8b;">min</span><span style="color: #7388d6;">(</span>yanzhi<span style="color: #7388d6;">)</span> &#26368;&#26377;&#25165;,
      <span style="color: #483d8b;">avg</span><span style="color: #7388d6;">(</span>yanzhi<span style="color: #7388d6;">)</span> &#24179;&#22343;,
      <span style="color: #483d8b;">sum</span><span style="color: #7388d6;">(</span>yanzhi<span style="color: #7388d6;">)</span> &#24635;&#21644;
    <span style="color: #a020f0;">from</span> boysandgirls
      <span style="color: #a020f0;">where</span> <span style="color: #a020f0;">name</span> &lt;&gt; <span style="color: #8b2252;">'&#40644;'</span>
      <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> gno<span style="color: #707183;">)</span> a
   <span style="color: #a020f0;">where</span> a.&#24635;&#21644;&gt;400;

<span style="color: #b22222;">-- &#20998;&#32452;&#20043;&#21518;&#30340;&#34920;&#30340;&#36830;&#25509;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span>
  groups a,
  <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> gno,
       <span style="color: #483d8b;">count</span><span style="color: #7388d6;">(</span>*<span style="color: #7388d6;">)</span> &#20154;&#25968;,
       <span style="color: #483d8b;">max</span><span style="color: #7388d6;">(</span>yanzhi<span style="color: #7388d6;">)</span> &#26368;&#32654;,
       <span style="color: #483d8b;">min</span><span style="color: #7388d6;">(</span>yanzhi<span style="color: #7388d6;">)</span> &#26368;&#26377;&#25165;,
       <span style="color: #483d8b;">avg</span><span style="color: #7388d6;">(</span>yanzhi<span style="color: #7388d6;">)</span> &#24179;&#22343;,
       <span style="color: #483d8b;">sum</span><span style="color: #7388d6;">(</span>yanzhi<span style="color: #7388d6;">)</span> &#24635;&#21644;
     <span style="color: #a020f0;">from</span> boysandgirls
       <span style="color: #a020f0;">where</span> <span style="color: #a020f0;">name</span> &lt;&gt; <span style="color: #8b2252;">'&#40644;'</span>
       <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> gno
       <span style="color: #a020f0;">having</span> <span style="color: #483d8b;">sum</span><span style="color: #7388d6;">(</span>yanzhi<span style="color: #7388d6;">)</span>&gt;400<span style="color: #707183;">)</span> b
<span style="color: #a020f0;">where</span> a.gno = b.gno;

<span style="color: #b22222;">-- &#34920;&#30340;&#36830;&#25509;&#20043;&#21518;&#20877;&#20998;&#32452;</span>
<span style="color: #a020f0;">select</span> gname, <span style="color: #483d8b;">sum</span><span style="color: #707183;">(</span>yanzhi<span style="color: #707183;">)</span> 
  <span style="color: #a020f0;">from</span> mates a, groups b 
  <span style="color: #a020f0;">where</span> a.gno=b.gno <span style="color: #a020f0;">and</span> <span style="color: #a020f0;">name</span>&lt;&gt;<span style="color: #8b2252;">'&#40644;&#23567;&#27874;'</span> 
  <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> gname
  <span style="color: #a020f0;">having</span> <span style="color: #483d8b;">sum</span><span style="color: #707183;">(</span>a.yanzhi<span style="color: #707183;">)</span>&gt;350;
</pre>
</div>
</div>
</li></ol>
</li>

<li><a id="sec-4-2-2-2" name="sec-4-2-2-2"></a>插入(insert)<br ><div class="outline-text-5" id="text-4-2-2-2">
<p>
最基本的语法
</p>
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> <span style="color: #a020f0;">table_name</span> <span style="color: #707183;">[</span>columns<span style="color: #707183;">]</span> <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">value</span>...<span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#31034;&#20363;&#34920;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">demo</span> <span style="color: #707183;">(</span>id <span style="color: #a020f0;">number</span>, <span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#26368;&#31616;&#21333;&#25554;&#20837;</span>
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> demo <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>1, <span style="color: #8b2252;">'haha'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> demo <span style="color: #707183;">(</span>id, <span style="color: #a020f0;">name</span><span style="color: #707183;">)</span> <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>2, <span style="color: #8b2252;">'hehe'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> demo <span style="color: #707183;">(</span>id<span style="color: #707183;">)</span> <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>3<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> demo <span style="color: #707183;">(</span><span style="color: #a020f0;">name</span>, id<span style="color: #707183;">)</span> <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'heihei'</span>, 4<span style="color: #707183;">)</span>;


<span style="color: #b22222;">-- &#27880;&#24847;&#65292;&#25554;&#20837;&#26102;&#65292;&#26368;&#22909;&#25351;&#23450;&#25554;&#20837;&#30340;&#23383;&#27573;&#12290;&#22240;&#20026;&#21487;&#20197;&#25552;&#39640;&#25928;&#29575;&#65292;&#21487;&#20197;&#36991;&#20813;&#38169;&#35823;&#12290;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">demo</span> <span style="color: #a020f0;">add</span> age <span style="color: #a020f0;">number</span>;      <span style="color: #b22222;">-- &#23545;&#34920;&#36827;&#34892;&#25193;&#20805;</span>
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> demo <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>1, <span style="color: #8b2252;">'haha'</span><span style="color: #707183;">)</span>;  <span style="color: #b22222;">-- &#20250;&#20986;&#38169;&#65292;&#22240;&#20026;&#22810;&#20102;&#19968;&#21015;&#65292;&#20294;&#26159;&#25554;&#20837;&#30340;&#35821;&#27861;&#27809;&#21464;</span>
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> demo <span style="color: #707183;">(</span><span style="color: #a020f0;">name</span>, id<span style="color: #707183;">)</span> <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'heihei'</span>, 4<span style="color: #707183;">)</span>;  <span style="color: #b22222;">-- &#27809;&#26377;&#38382;&#39064;&#12290;</span>




<span style="color: #b22222;">-- &#20174;&#20854;&#20182;&#30340;&#34920;&#20013;&#21152;&#36733;&#25968;&#25454;</span>
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> <span style="color: #a020f0;">table_name</span> <span style="color: #a020f0;">select</span> xxx <span style="color: #a020f0;">from</span> yyy;

<span style="color: #b22222;">-- &#22797;&#21046; scott.dept &#20013;&#30340;deptno&gt;20&#30340;&#25152;&#26377;&#25968;&#25454;&#21040;&#25351;&#23450;&#34920;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">d</span> <span style="color: #a020f0;">as</span> <span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> scott.dept <span style="color: #a020f0;">where</span> 1=2;  <span style="color: #b22222;">-- &#25353;&#29031;&#20043;&#21069;&#23398;&#30340;&#35821;&#27861;&#65292;&#22797;&#21046;&#34920;&#30340;&#32467;&#26500;</span>
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> dept <span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> scott.dept <span style="color: #a020f0;">where</span> deptno&gt;20;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> dept <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> scott.dept <span style="color: #a020f0;">where</span> deptno&gt;20<span style="color: #707183;">)</span>;


<span style="color: #b22222;">-- &#21019;&#24314;&#19968;&#24352;&#34920;&#65292;&#21482;&#26377;&#19968;&#20010;&#23383;&#27573;&#65292; varchar2(20)</span>
<span style="color: #b22222;">-- &#25226; scott.dept &#20013;&#25152;&#26377; deptno &gt; 20 &#30340;&#37096;&#38376;&#30340;&#21517;&#31216;&#25554;&#20837;&#20854;&#20013;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">dept2</span> <span style="color: #707183;">(</span>dname varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;   <span style="color: #b22222;">-- &#21019;&#24314;&#34920;&#30340;&#35821;&#21477;</span>
<span style="color: #b22222;">-- &#19979;&#38754;&#19977;&#31181;&#26159;&#31561;&#20215;&#30340;</span>
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> dept2 <span style="color: #a020f0;">select</span> dname <span style="color: #a020f0;">from</span> scott.dept <span style="color: #a020f0;">where</span> deptno &gt; 20;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> dept2 <span style="color: #707183;">(</span>dname<span style="color: #707183;">)</span> <span style="color: #a020f0;">select</span> dname <span style="color: #a020f0;">from</span> scott.dept <span style="color: #a020f0;">where</span> deptno &gt; 20;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> dept2 <span style="color: #a020f0;">value</span> <span style="color: #a020f0;">select</span> dname <span style="color: #a020f0;">from</span> scott.dept <span style="color: #a020f0;">where</span> deptno &gt; 20;
<span style="color: #b22222;">-- &#19979;&#38754;&#19968;&#31181;&#26159;&#38169;&#35823;&#30340;&#65292;&#22240;&#20026;&#22312;&#25351;&#23450;&#23383;&#27573;&#30340;&#26102;&#20505;&#65292;&#19981;&#33021;&#22815;&#36319; value &#20851;&#38190;&#23383;&#19968;&#36215;&#20351;&#29992;</span>
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> dept2 <span style="color: #707183;">(</span>dname<span style="color: #707183;">)</span> <span style="color: #a020f0;">value</span> <span style="color: #a020f0;">select</span> dname <span style="color: #a020f0;">from</span> scott.dept <span style="color: #a020f0;">where</span> deptno &gt; 20;  <span style="color: #b22222;">---</span>
</pre>
</div>
</div>
</li>





<li><a id="sec-4-2-2-3" name="sec-4-2-2-3"></a>更新(update)<br ><div class="outline-text-5" id="text-4-2-2-3">
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#22522;&#26412;&#35821;&#27861;</span>
<span style="color: #a020f0;">UPDATE</span> <span style="color: #a020f0;">table_name</span> <span style="color: #a020f0;">SET</span> <span style="color: #a020f0;">column</span>=<span style="color: #a020f0;">value</span><span style="color: #707183;">[</span>, <span style="color: #a020f0;">column</span>=<span style="color: #a020f0;">value</span>...<span style="color: #707183;">]</span> <span style="color: #707183;">[</span><span style="color: #a020f0;">WHERE</span> condition<span style="color: #707183;">]</span>

<span style="color: #b22222;">-- &#27880;&#24847;&#65292;&#19968;&#23450;&#19981;&#35201;&#32570;&#23569;&#30456;&#24212;&#30340;where&#65292;&#31895;&#24515;&#22823;&#24847;&#26159;dba&#25110;&#32773;&#25968;&#25454;&#24211;&#25805;&#20316;&#21592;&#30340;&#22825;&#25932;&#12290;</span>
<span style="color: #b22222;">-- where &#26465;&#20214;&#65292;&#23613;&#21487;&#33021;&#20351;&#29992;&#20027;&#38190;&#65292;&#22240;&#20026;&#20027;&#38190;&#26159;&#29992;&#26469;&#26631;&#35782;&#21807;&#19968;&#19968;&#26465;&#35760;&#24405;&#30340;&#12290;</span>
<span style="color: #a020f0;">update</span> dept <span style="color: #a020f0;">set</span> dname=<span style="color: #8b2252;">'&#38144;&#21806;&#37096;'</span> <span style="color: #a020f0;">where</span> deptno = 30;
</pre>
</div>
</div>
</li>
<li><a id="sec-4-2-2-4" name="sec-4-2-2-4"></a>删除(delete)<br ><div class="outline-text-5" id="text-4-2-2-4">
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#35821;&#27861;</span>
<span style="color: #a020f0;">delete</span> <span style="color: #a020f0;">from</span> <span style="color: #a020f0;">table_name</span> <span style="color: #707183;">[</span><span style="color: #a020f0;">where</span> condition<span style="color: #707183;">]</span>

<span style="color: #a020f0;">delete</span> <span style="color: #a020f0;">from</span> dept;   <span style="color: #b22222;">-- &#21024;&#38500;&#34920;&#20013;&#25152;&#26377;&#35760;&#24405;</span>
<span style="color: #a020f0;">delete</span> <span style="color: #a020f0;">from</span> dept <span style="color: #a020f0;">where</span> dname = <span style="color: #8b2252;">'SALES'</span>; <span style="color: #b22222;">-- &#21024;&#38500;&#34920;&#20013;&#25152;&#26377; SALES &#30340;&#35760;&#24405;</span>

<span style="color: #b22222;">-- truncate &#35821;&#27861;&#65292;&#25130;&#26029;&#25968;&#25454;&#65292;&#20250;&#28165;&#31354;&#34920;&#20013;&#30340;&#25152;&#26377;&#25968;&#25454;&#12290;</span>
<span style="color: #b22222;">-- &#19981;&#38656;&#35201;&#25552;&#20132;&#20107;&#21153;&#65292;&#20063;&#19981;&#33021;&#22815;&#22238;&#28378;&#12290;&#22240;&#20026; truncate &#19981;&#20135;&#29983;&#22238;&#28378;&#27573;&#65292;&#19981;&#20889; redolog</span>
<span style="color: #b22222;">-- &#23427;&#21024;&#38500;&#30340;&#25928;&#29575;&#35201;&#39640;&#20110; delete from&#65292;&#20294;&#22240;&#20026;&#19981;&#33021;&#22238;&#28378;&#65292;&#25152;&#20197;&#24212;&#29992;&#20013;&#24212;&#35813;&#24910;&#20043;&#21448;&#24910;&#12290;</span>
truncate <span style="color: #a020f0;">table</span> <span style="color: #a020f0;">table_name</span>;
</pre>
</div>
</div>
</li></ol>
</div>



<div id="outline-container-sec-4-2-3" class="outline-4">
<h4 id="sec-4-2-3"><span class="section-number-4">4.2.3</span> TCL（Transaction Control Language)</h4>
<div class="outline-text-4" id="text-4-2-3">
<p>
控制数据的事务。事务就是把数据当做一个完整的操作单元，一起成功或者一起失败。这样才能保证数据的一致性。
</p>
<ul class="org-ul">
<li>set transaction xxx 配置事务属性
<pre class="example">
set transaction read only/write      -- 设置事务是否只读
set transaction ISOLATION level read committed   -- 设置事务的隔离属性
</pre>
</li>
<li>savepoint name 保存点
</li>
<li>rollback to [savepint] 回撤
</li>
<li>commit 提交
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4-2-4" class="outline-4">
<h4 id="sec-4-2-4"><span class="section-number-4">4.2.4</span> DCL（Data Control Language)</h4>
<div class="outline-text-4" id="text-4-2-4">
<ul class="org-ul">
<li>grant
</li>
<li>revoke
</li>
</ul>
</div>
</div>
</div>










<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> 数据类型</h3>
<div class="outline-text-3" id="text-4-3">
</div><div id="outline-container-sec-4-3-1" class="outline-4">
<h4 id="sec-4-3-1"><span class="section-number-4">4.3.1</span> 字符类型</h4>
<div class="outline-text-4" id="text-4-3-1">
</div><ol class="org-ol"><li><a id="sec-4-3-1-1" name="sec-4-3-1-1"></a>char 类型(nchar)<br ><div class="outline-text-5" id="text-4-3-1-1">
<p>
固定长度，默认是1，最大长度是2000个字节。不够的长度，oracle 会用空格进行填充。
</p>
<pre class="example">
create table s1 (c char(2001));  -- 错误，因为2001超出了类型的范围
create table s2 (c char);        -- 默认char的长度为1.
insert into s2 values ('a');     -- 它是正确的。
insert into s2 values ('你');    -- 它是错误的。列的值太大，(实际值: 2, 最大值: 1)
</pre>
</div>
</li>

<li><a id="sec-4-3-1-2" name="sec-4-3-1-2"></a>varchar 类型<br ><div class="outline-text-5" id="text-4-3-1-2">
<p>
是SQL的标准类型。
不建议使用，用 varchar2 代替。因为 varchar2 有更高的效率和更好的兼容性。
</p>
</div>
</li>
<li><a id="sec-4-3-1-3" name="sec-4-3-1-3"></a>varchar2 类型(nvarchar2)<br ><div class="outline-text-5" id="text-4-3-1-3">
<p>
可变长度的。最大长度为 4000。效率不及固定长度的char类型。英文占用一个字节，中文占用多字节，所以，中文跟中文占用空间不一致。
nvarchar2, 在 varchar2 基础上加入了字符集支持。
</p>

<p>
nvarchar2中，长度表示的是字符个数。
</p>

<pre class="example">
create table demo (a char(100), b varchar2(100), c nvarchar2(100));
insert into demo values ('a', 'a', 'a');
insert into demo values ('你', '你', '你');
select lengthb(a), lengthb(b), lengthb(c) from demo;
create table s4 (c varchar2(4 char));    -- char 是代表字符个数，是一个单位符号。这个语句创建的表格，只有一个字段， 是 varchar2 类型，可以填充 4 个字符（注意，不是字节）。
create table s4 (c varchar2(4 byte));    -- byte 是跟上面语句一样的单位符号，代表的是字节。这是 varchar2 的默认单位。这个语句创建的表格，只有一个字段，是 varchar2 类型，可以填充 4 个字节（注意，不是字符）。
</pre>
</div>
</li>

<li><a id="sec-4-3-1-4" name="sec-4-3-1-4"></a>long 类型<br ><div class="outline-text-5" id="text-4-3-1-4">
<p>
用来存储大容量数据的，最大是 2GB。已弃用，建议使用 LOB 字段代替。
</p>
</div>
</li></ol>
</div>

<div id="outline-container-sec-4-3-2" class="outline-4">
<h4 id="sec-4-3-2"><span class="section-number-4">4.3.2</span> 数字类型</h4>
<div class="outline-text-4" id="text-4-3-2">
</div><ol class="org-ol"><li><a id="sec-4-3-2-1" name="sec-4-3-2-1"></a>NUMBER 类型<br ><div class="outline-text-5" id="text-4-3-2-1">
<p>
定义语法为：
</p>
<pre class="example">
COLUMN number[(precision, scale)]
</pre>
<p>
默认的长度是38。
</p>

<p>
如果不带参数，精度和小数的位数是根据填充的数字自动判定的。
</p>
<pre class="example">
create table s5 (c number);
</pre>
<p>
如果 scale 为空，那么默认， scale 为 0。小数点后被截断的数位，采取的是四舍五入制。
</p>
<pre class="example">
create table s7 (c number(5));
insert into s7 values (9.2222);   -- 插入的是 9
insert into s7 values (9.7777);   -- 插入的是 10
</pre>
<p>
如果 precision 为空，那么，确定小数点位数为 scale，precision 自动判定。
</p>
<pre class="example">
create table s8 (c number(*, 2));
insert into s8 values (6.23236);
</pre>
<p>
两个参数都具备的情况：
</p>
<pre class="example">
create table demo (a number(4, 2));
insert into demo values (987.1);  -- 值大于为此列指定的允许精度
insert into demo values (7.101);  -- 实际上插入的是 7.10
</pre>
<p>
两个参数，第一个代表精度，第二个代表小数位数。
</p>
</div>
</li>

<li><a id="sec-4-3-2-2" name="sec-4-3-2-2"></a>INT/FLOAT 子类型<br ><div class="outline-text-5" id="text-4-3-2-2">
<pre class="example">
create table s9 (c int);
insert into s9 values (22.22);
</pre>
</div>
</li></ol>
</div>

<div id="outline-container-sec-4-3-3" class="outline-4">
<h4 id="sec-4-3-3"><span class="section-number-4">4.3.3</span> 时间类型</h4>
<div class="outline-text-4" id="text-4-3-3">
</div><ol class="org-ol"><li><a id="sec-4-3-3-1" name="sec-4-3-3-1"></a>DATE 数据类型<br ><div class="outline-text-5" id="text-4-3-3-1">
<p>
显示的是年月日。
</p>
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#26597;&#30475;&#24403;&#22825;&#30340;&#26085;&#26399;</span>
<span style="color: #a020f0;">select</span> sysdate <span style="color: #a020f0;">from</span> dual;

<span style="color: #b22222;">-- &#20462;&#25913;&#24403;&#21069;&#26085;&#26399;&#26174;&#31034;&#30340;&#26684;&#24335;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">session</span> <span style="color: #a020f0;">set</span> nls_date_format=<span style="color: #8b2252;">'yyyy.mm.dd'</span>;

<span style="color: #b22222;">-- &#24212;&#29992;&#31034;&#20363;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">d1</span> <span style="color: #707183;">(</span>birth <span style="color: #228b22;">date</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> d1 <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>sysdate<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> d1 <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>sysdate - 1<span style="color: #707183;">)</span>;             <span style="color: #b22222;">-- &#21487;&#20197;&#36827;&#34892;&#31616;&#21333;&#36816;&#31639;&#65292;&#40664;&#35748;&#21333;&#20301;&#26159;&#8220;&#22825;&#8221;</span>
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> d1 <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>to_date<span style="color: #7388d6;">(</span><span style="color: #8b2252;">'20120701'</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;     <span style="color: #b22222;">-- &#29992; to_date &#20989;&#25968;&#23545;&#23383;&#31526;&#20018;&#36827;&#34892;&#36716;&#25442;&#12290;&#21487;&#20197;&#24102;&#20004;&#20010;&#21442;&#25968;&#65292;&#31532;&#19968;&#20010;&#26159;&#24517;&#39035;&#30340;&#12290;&#22914;&#26524;&#31532;&#20108;&#20010;&#21442;&#25968;&#34987;&#24573;&#30053;&#65292;&#37027;&#20040; oracle &#20250;&#26681;&#25454; yyyy/mm/dd &#30340;&#39034;&#24207;&#23581;&#35797;&#23545;&#26085;&#26399;&#36827;&#34892;&#26684;&#24335;&#21270;&#12290;</span>
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> d1 <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>to_date<span style="color: #7388d6;">(</span><span style="color: #8b2252;">'2012/07/01'</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> d1 <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>to_date<span style="color: #7388d6;">(</span><span style="color: #8b2252;">'2012=07=01'</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;

<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> d1 <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>to_date<span style="color: #7388d6;">(</span><span style="color: #8b2252;">'01.07.2012'</span>, <span style="color: #8b2252;">'dd.mm.yyyy'</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;   <span style="color: #b22222;">-- &#20004;&#20010;&#21442;&#25968;&#37117;&#26159;&#23383;&#31526;&#20018;&#65292;&#38656;&#35201;&#29992;&#21333;&#24341;&#21495;&#24341;&#36215;&#26469;&#12290;</span>

<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">s1</span> <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>birth varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> s1 <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>to_char<span style="color: #7388d6;">(</span>sysdate, <span style="color: #8b2252;">'yyyy-mm-dd'</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;        <span style="color: #b22222;">-- to_char &#26159;&#25226;&#20854;&#20182;&#30340;&#31867;&#22411;&#36716;&#25442;&#20026; char &#31867;&#22411;</span>
</pre>
</div>
</div>
</li>

<li><a id="sec-4-3-3-2" name="sec-4-3-3-2"></a>TIMESTAMP 数据类型<br ><div class="outline-text-5" id="text-4-3-3-2">
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#36820;&#22238;&#30340;&#26159; timestamp with timezone &#31867;&#22411;&#65292;&#21253;&#21547;&#24180;&#26376;&#26085;&#26102;&#20998;&#31186;&#24494;&#22937;&#27627;&#31186;&#65292;&#19978;&#21320;&#19979;&#21320;&#65292;&#26102;&#21306;</span>
<span style="color: #b22222;">-- &#22312;&#19968;&#33324;&#19994;&#21153;&#31995;&#32479;&#20013;&#65292;&#26102;&#38388;&#22522;&#26412;&#19978;&#29992;&#30340;&#37117;&#26159; timestamp &#31867;&#22411;</span>
<span style="color: #b22222;">-- &#21487;&#20197;&#29992; nls_timestamp_format &#23450;&#21046;&#26174;&#31034;&#26041;&#24335;</span>
<span style="color: #a020f0;">select</span> systimestamp <span style="color: #a020f0;">from</span> dual;;
</pre>
</div>
</div>
</li></ol>
</div>

<div id="outline-container-sec-4-3-4" class="outline-4">
<h4 id="sec-4-3-4"><span class="section-number-4">4.3.4</span> RAW 类型</h4>
<div class="outline-text-4" id="text-4-3-4">
<p>
主要用来处理二进制的。
</p>

<p>
分为
</p>
</div>
<ol class="org-ol"><li><a id="sec-4-3-4-1" name="sec-4-3-4-1"></a>RAW<br ><div class="outline-text-5" id="text-4-3-4-1">
<p>
默认占用空间为 2kb
</p>
</div>
</li>

<li><a id="sec-4-3-4-2" name="sec-4-3-4-2"></a>Long RAW<br ><div class="outline-text-5" id="text-4-3-4-2">
<p>
不建议使用，跟 long 类型有相同的缺点。
</p>
</div>
</li></ol>
</div>

<div id="outline-container-sec-4-3-5" class="outline-4">
<h4 id="sec-4-3-5"><span class="section-number-4">4.3.5</span> LOB类型(large Object)</h4>
<div class="outline-text-4" id="text-4-3-5">
</div><ol class="org-ol"><li><a id="sec-4-3-5-1" name="sec-4-3-5-1"></a>CLOB 类型<br ><div class="outline-text-5" id="text-4-3-5-1">
<p>
是存储字符的大对象类型。
</p>
<pre class="example">
create table lobdemo1 (c clob);  -- 创建一个具备 blob 字段的表
insert into lobdemo1 values ('ssss');
insert into lobdemo1 values (22222222222222222);
insert into lobdemo1 values (null);
insert into lobdemo1 values (empty_clob());   -- 插入的不是空值
</pre>
</div>
</li>

<li><a id="sec-4-3-5-2" name="sec-4-3-5-2"></a>BLOB 类型<br ><div class="outline-text-5" id="text-4-3-5-2">
<p>
是存储二进制数据的大对象类型。主要的用处是存储图形，音频，视频等。
</p>

<p>
oracle 提供了dbms_lob 包，对 lob 字段进行操作。
</p>
</div>
</li>

<li><a id="sec-4-3-5-3" name="sec-4-3-5-3"></a>BFILE 类型<br ><div class="outline-text-5" id="text-4-3-5-3">
<p>
也是存储二进制。是以外部文件的形式进行存储的。
</p>
</div>
</li>

<li><a id="sec-4-3-5-4" name="sec-4-3-5-4"></a>XMLType 类型<br ><div class="outline-text-5" id="text-4-3-5-4">
<p>
主要是为了处理 xml 文档的。
</p>
</div>
</li></ol>
</div>


<div id="outline-container-sec-4-3-6" class="outline-4">
<h4 id="sec-4-3-6"><span class="section-number-4">4.3.6</span> ROWID/ROWNUM</h4>
<div class="outline-text-4" id="text-4-3-6">
</div><ol class="org-ol"><li><a id="sec-4-3-6-1" name="sec-4-3-6-1"></a>rowid<br ><div class="outline-text-5" id="text-4-3-6-1">
<p>
rowid 是 oracle 中的伪列。可以通过下面语句显示:
</p>
<pre class="example">
select d.rowid, d.* from dept d
</pre>
<p>
它是唯一的，不可变的，固定长度的。
</p>

<p>
它是数据存储物理地址的一种映射。一共有18位，前6位表示对象id，后3位表示fno，后6位表示块编号，最后3位表示行编号。
所以，通过rowid可以最快速度地定位到数据所在的位置。
</p>

<p>
rowid 是 oracle 特有的。
</p>

<p>
不建议使用 rowid 作为表的主键。迁移的需求，有改变的风险。
</p>
</div>
</li>



<li><a id="sec-4-3-6-2" name="sec-4-3-6-2"></a>rownum<br ><div class="outline-text-5" id="text-4-3-6-2">
<p>
列出每一行数据的行数，从1开始，自然增长。
</p>

<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#22522;&#26412;&#29992;&#27861;</span>
<span style="color: #a020f0;">select</span> rownum, d.* <span style="color: #a020f0;">from</span> dept;
<span style="color: #a020f0;">select</span> rownum, d.* <span style="color: #a020f0;">from</span> dept d <span style="color: #a020f0;">where</span> rownum &lt; 3;     <span style="color: #b22222;">-- &#26174;&#31034;&#21069;&#20004;&#26465;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> rownum rn, d.* <span style="color: #a020f0;">from</span> dept d<span style="color: #707183;">)</span> t <span style="color: #a020f0;">where</span> t.rn = 3;   <span style="color: #b22222;">-- &#21482;&#26174;&#31034;&#31532;&#19977;&#26465;</span>

<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> sal <span style="color: #a020f0;">desc</span><span style="color: #707183;">)</span> <span style="color: #a020f0;">where</span> rownum&lt;=3;  <span style="color: #b22222;">-- &#26174;&#31034; emp &#34920;&#20013;&#24037;&#36164;&#21069;&#19977;&#20301;&#30340;&#38599;&#21592;&#20449;&#24687;&#12290;</span>
</pre>
</div>
</div>
</li></ol>
</div>


<div id="outline-container-sec-4-3-7" class="outline-4">
<h4 id="sec-4-3-7"><span class="section-number-4">4.3.7</span> NULL</h4>
<div class="outline-text-4" id="text-4-3-7">
<p>
它是 Oracle 中非常特殊的一种类型。它表示不确定，表示没有值。并且它能转化成所有的类型。
向数据库中插入空字符串时，oracle 会把它自动转化为 null 类型。所以，在查询空字符的时候：
</p>
<pre class="example">
select * from n3 where s = '';
</pre>
<p>
上面的语句是非法，不合适的。应该这样查：
</p>
<pre class="example">
select * from n3 where s is null;
select * from n3 where s is not null;
</pre>
<p>
创建表的时候，为了约束插入的数据不能为空，应该在字段的后面写上 not null 约束。
</p>
<pre class="example">
create table n5 (s varchar2(20) not null);
</pre>
<p>
跟 null 做任何的运算，结果仍然是 null.
</p>
<pre class="example">
select null + '' from dual;
</pre>
</div>
</div>
</div>



<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4"><span class="section-number-3">4.4</span> 运算符</h3>
<div class="outline-text-3" id="text-4-4">
</div><ol class="org-ol"><li><a id="sec-4-4-0-1" name="sec-4-4-0-1"></a>算术运算符<br ><div class="outline-text-5" id="text-4-4-0-1">
<p>
加/减/乘/除
</p>
</div>
</li>
<li><a id="sec-4-4-0-2" name="sec-4-4-0-2"></a>连接运算符<br ><div class="outline-text-5" id="text-4-4-0-2">
<p>
是用来连接字符串的。跟java中的 + 是一致的。
</p>
<pre class="example">
select 'abc' || ' bcd ' as 连接后的结果 from dual;
select d.dname || ' 部门' from dept d;
</pre>
</div>
</li>

<li><a id="sec-4-4-0-3" name="sec-4-4-0-3"></a>关系运算符<br ><div class="outline-text-5" id="text-4-4-0-3">
<p>
见课本
</p>
</div>
</li>
<li><a id="sec-4-4-0-4" name="sec-4-4-0-4"></a>比较运算符<br ><div class="outline-text-5" id="text-4-4-0-4">
<p>
IS NULL / Like / Between / In / Exsist.
</p>
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#21028;&#26029; null &#20540;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> n5 <span style="color: #a020f0;">where</span> s <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">null</span>;
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> n5 <span style="color: #a020f0;">where</span> s <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>;

<span style="color: #b22222;">-- like &#27169;&#31946;&#26597;&#35810;&#12290;&#24910;&#29992;&#65292;&#26377;&#21487;&#33021;&#20250;&#23548;&#33268;&#20840;&#34920;&#25195;&#25551;&#65292;&#25928;&#29575;&#20302;&#12290;</span>
<span style="color: #a020f0;">select</span> username <span style="color: #a020f0;">from</span> dba_users <span style="color: #a020f0;">where</span> username <span style="color: #a020f0;">like</span> <span style="color: #8b2252;">'VI_'</span>;
<span style="color: #a020f0;">select</span> username <span style="color: #a020f0;">from</span> dba_users <span style="color: #a020f0;">where</span> username <span style="color: #a020f0;">like</span> <span style="color: #8b2252;">'SC%'</span>;
<span style="color: #a020f0;">select</span> username <span style="color: #a020f0;">from</span> dba_users <span style="color: #a020f0;">where</span> username <span style="color: #a020f0;">like</span> <span style="color: #8b2252;">'%SC%'</span>;

<span style="color: #b22222;">-- in&#65292;&#26159; where x = a or x = b or x = c &#30340;&#19968;&#31181;&#32553;&#20889;&#12290;&#19979;&#38754;&#20004;&#26465;&#26159;&#31561;&#20215;&#30340;&#12290;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> empno <span style="color: #a020f0;">in</span> <span style="color: #707183;">(</span>700, 800, 900<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> empno = 700 <span style="color: #a020f0;">or</span> empno = 800 <span style="color: #a020f0;">or</span> empno = 900;
<span style="color: #b22222;">-- in &#21518;&#38754;&#36319;&#30340;&#19981;&#19968;&#23450;&#26159;&#36887;&#21495;&#20998;&#38548;&#30340;&#21333;&#39033;&#65292;&#20063;&#21487;&#33021;&#26159;&#19968;&#20010;&#23436;&#25972;&#30340;&#26597;&#35810;&#35821;&#21477;&#12290;</span>
<span style="color: #b22222;">-- &#19979;&#38754;&#20004;&#26465;&#32467;&#26524;&#26159;&#19968;&#33268;&#30340;</span>
<span style="color: #b22222;">-- &#36825;&#31181; in &#24910;&#29992;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> deptno <span style="color: #a020f0;">in</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> deptno <span style="color: #a020f0;">from</span> dept <span style="color: #a020f0;">where</span> dname = <span style="color: #8b2252;">'SALES'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">select</span> a.* <span style="color: #a020f0;">from</span> emp a,dept d <span style="color: #a020f0;">where</span> a.deptno =d.deptno <span style="color: #a020f0;">and</span> d.dname=<span style="color: #8b2252;">'SALES'</span>;


<span style="color: #b22222;">-- between...and</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> empno <span style="color: #a020f0;">between</span> 7800 <span style="color: #a020f0;">and</span> 9000;
</pre>
</div>
</div>
</li>

<li><a id="sec-4-4-0-5" name="sec-4-4-0-5"></a>逻辑运算符<br ><div class="outline-text-5" id="text-4-4-0-5">
<p>
and / or / not
</p>

<p>
<a href="http://www.cnblogs.com/nick-huang/p/4027038.html">not 的优先级 &gt; and 的优先级 &gt; or 的优先级</a>
</p>
</div>
</li>

<li><a id="sec-4-4-0-6" name="sec-4-4-0-6"></a>集合操作符<br ><div class="outline-text-5" id="text-4-4-0-6">
<p>
Union/UnionAll/Intersect/Minus
</p>
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">depd</span> <span style="color: #a020f0;">as</span> <span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> dept <span style="color: #a020f0;">where</span> rownum &lt; 2;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> depd <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>99, <span style="color: #8b2252;">'&#22806;&#21334;&#37096;'</span>, <span style="color: #8b2252;">'&#29664;&#28023;'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> depd <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>98, <span style="color: #8b2252;">'&#23567;&#21507;&#37096;'</span>, <span style="color: #8b2252;">'&#26007;&#38376;'</span><span style="color: #707183;">)</span>;

<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> depd
<span style="color: #a020f0;">union</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> dept;

<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> depd
<span style="color: #a020f0;">union</span> <span style="color: #a020f0;">all</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> dept;

<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> depd
<span style="color: #a020f0;">intersect</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> dept;

<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> depd
minus
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> dept;
</pre>
</div>
</div>
</li></ol>
</div>





<div id="outline-container-sec-4-5" class="outline-3">
<h3 id="sec-4-5"><span class="section-number-3">4.5</span> 内置函数</h3>
<div class="outline-text-3" id="text-4-5">
</div><div id="outline-container-sec-4-5-1" class="outline-4">
<h4 id="sec-4-5-1"><span class="section-number-4">4.5.1</span> 数值函数</h4>
<div class="outline-text-4" id="text-4-5-1">
<ul class="org-ul">
<li>abs 求绝对值
<pre class="example">
select abs(-22) from dual;
</pre>
</li>
<li>round 四舍五入
<pre class="example">
SELECT ROUND(123415.193) "Round" FROM DUAL;
SELECT ROUND(123415.193, 2) "Round" FROM DUAL;
SELECT ROUND(123415.193, -1) "Round" FROM DUAL;
</pre>
</li>
<li>power 求幂
</li>
<li>sqrt 开根号
</li>
<li>trunc 保留小数有效数字
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4-5-2" class="outline-4">
<h4 id="sec-4-5-2"><span class="section-number-4">4.5.2</span> 字符函数</h4>
<div class="outline-text-4" id="text-4-5-2">
<ul class="org-ul">
<li>lower 转化为小写
</li>
<li>upper 转换为大写
</li>
<li>trim 去除某些字符
<pre class="example">
select trim('x' from 'xsxdfsxxxx') from dual;
select trim(both 'x' from 'xsxdfsxxxx') from dual; -- 去除开始的 x 字符
select trim(leading 'x' from 'xsxdfsxxxx') from dual; -- 去除开始的 x 字符
select trim(trailing 'x' from 'xsxdfsxxxx') from dual; -- 去除结尾的 x 字符
</pre>
</li>
<li>ltrim / rtrim 左右去除字符
<pre class="example">
SELECT RTRIM('BROWNING: ./=./=./=./=./=.=',      '/=.') FROM DUAL;  -- 第二个参数包含了要砍掉的所有字符的集合
SELECT RTRIM('BROWNING: ./=./=./=./=./=.=     ') FROM DUAL;         -- 如果第二个参数为空，那么默认 trim 掉的是空格
</pre>
</li>
<li>lpad / rpad 填充字符
<pre class="example">
SELECT LPAD('Page 1',15,'*.') "LPAD example" FROM DUAL;  -- 第二个参数代表了返回值的总长度，最后一个参数如果去掉的话，那么默认填充的是空格
</pre>
</li>
<li>concate(||) 连接字符
</li>
<li>REGEXP_REPLACE 正则替换
</li>
<li>replace 常规替换
<pre class="example">
SELECT REPLACE('JACK and JUE','J','BL') "Changes" FROM DUAL; -- 一共 3 个参数，第一个是源字符串，第二个是要替换的字符串，第三个是要替换为的字符串。
SELECT REPLACE('JACK and JUE','J') "Changes" FROM DUAL;      -- 如果第三个参数为空的话，默认把第二个字符串替换为空。
</pre>
</li>
<li>SUBSTR 
<pre class="example">
SELECT SUBSTR('ABCDEFG',3,4) "Substring" FROM DUAL;   -- 第一参数表示要处理的源字符串，第二个参数表示子串起始的位置，第三个参数是可选的，表示子串的长度
SELECT SUBSTR('ABCDEFG',3) "Substring" FROM DUAL;     -- 如果不适用第三个参数，那么子串默认到源字符串的结尾。
SELECT SUBSTR('ABCDEFG',-2,1) "Substring" FROM DUAL;  -- 如果第二个参数是负数，表示从结尾往回回溯。
</pre>
</li>
<li>TRANSLATE 替换相应的字符
<pre class="example">
select translate('hehehello,haha', 'o,h', '0!') from dual;  -- 三个参数，第一个源字符串，第二个和第三个参数里面的字符是按顺序一一对应的。这个函数就是按照后面两个参数内的字符，进行顺序替换。
</pre>
</li>

<li>ASCII 显示字符ascii码
<pre class="example">
select ascii('A') from dual;   -- 结果是 65
select * from scott.emp e where ascii(substr(e.ename, 1, 1)) = 67;  -- 显示 emp 中所有名字以 C 开头的员工。
</pre>
</li>
<li>LENGTH/LENGTHB 表示长度。
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4-5-3" class="outline-4">
<h4 id="sec-4-5-3"><span class="section-number-4">4.5.3</span> 时间函数</h4>
<div class="outline-text-4" id="text-4-5-3">
<ul class="org-ul">
<li>sysdate/systimestamp systimestamp 显示的时间时区是从操作系统中获取的。的返回值是 TIMESTAMP WITH TIME ZONE 类型。
</li>
<li>current_date/current_timestamp 返回的是当前会话时区的时间。跟 sessiontimezone 有关系的。可以通过 alter session set time_zone='-5:0' 来修改会话的时区。
</li>
<li>localtimestamp 显示当前时间，但是不带时区信息
</li>
<li>add_months 增加日期
<pre class="example">
select add_months(sysdate, 5) from dual;
select add_months(sysdate, -5) from dual;   -- 如果第二个参数是负数，相应的是减少几个月
</pre>
</li>
<li>LAST_DAY 一个月的最后一天
<pre class="example">
select last_day(sysdate) from dual;
</pre>
</li>
<li>MONTHS_BETWEEN 计算相差的月数
<pre class="example">
select months_between(sysdate, to_date('19981105')) from dual;  -- 周强从出生到现在经历了多少个月。如果把两个参数换过来，得到的是相应的负数。
select (sysdate - to_date('19981105'))/30 from dual;  -- 这样写是错误的，因为，一个月未必是30天
</pre>
</li>
<li>next_day 计算日期之后的第一个相应工作日日期
<pre class="example">
SELECT NEXT_DAY(sysdate, 1) "NEXT DAY" from dual;    -- 如果是数字，那么只能是1-7。相应1表示星期日，2代表星期一...
SELECT NEXT_DAY(to_date('20111111', '星期六') "NEXT DAY" from dual;    -- 第二个参数必须跟 nls_date_language 指定的字符集相关联
</pre>
</li>
<li>round(date) 最接近的日期
<pre class="example">
select round(sysdate - 200, 'YEAR') from dual;  -- 跟现在最接近的年份
select round(sysdate, 'MONTH') from dual;       -- 跟今天最接近的月份
</pre>
</li>
<li>trunc(date) 截取日期
<pre class="example">
SELECT TRUNC(TO_DATE('2010-09-20'), 'MONTH') "New Year" FROM DUAL;
</pre>
</li>
<li>dbtimezone 显示时区
</li>
<li>EXTRACT(datetime) 分解时间
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #a020f0;">SELECT</span> <span style="color: #483d8b;">EXTRACT</span><span style="color: #707183;">(</span><span style="color: #a020f0;">year</span> <span style="color: #a020f0;">FROM</span> systimestamp<span style="color: #707183;">)</span> "&#24180;",
  <span style="color: #483d8b;">EXTRACT</span><span style="color: #707183;">(</span><span style="color: #a020f0;">month</span> <span style="color: #a020f0;">FROM</span> systimestamp<span style="color: #707183;">)</span> "&#26376;",
  <span style="color: #483d8b;">EXTRACT</span><span style="color: #707183;">(</span><span style="color: #a020f0;">day</span> <span style="color: #a020f0;">FROM</span> systimestamp<span style="color: #707183;">)</span> "&#26085;" <span style="color: #a020f0;">from</span> dual;  <span style="color: #b22222;">-- &#40664;&#35748;&#37319;&#21462;&#30340;&#26159; 0 &#26102;&#21306;&#65292;&#21363; unk &#26102;&#21306;&#30340;&#20540;.</span>

<span style="color: #a020f0;">select</span> <span style="color: #483d8b;">extract</span><span style="color: #707183;">(</span><span style="color: #a020f0;">hour</span> <span style="color: #a020f0;">from</span> <span style="color: #228b22;">timestamp</span> <span style="color: #8b2252;">'1998-03-03 9:10:11'</span><span style="color: #707183;">)</span> <span style="color: #a020f0;">from</span> dual;  <span style="color: #b22222;">-- &#36820;&#22238;&#30340;&#26159; 9</span>
</pre>
</div>
</li>
</ul>
</div>
</div>


<div id="outline-container-sec-4-5-4" class="outline-4">
<h4 id="sec-4-5-4"><span class="section-number-4">4.5.4</span> 比较函数</h4>
<div class="outline-text-4" id="text-4-5-4">
<ul class="org-ul">
<li>GREATEST 取最大值
<pre class="example">
select greatest(2, 3, 4) from dual;  -- 结果 4
</pre>
</li>
<li>LEAST 取最小值
<pre class="example">
select least(2, 3, 4) from dual;     -- 结果 2
</pre>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4-5-5" class="outline-4">
<h4 id="sec-4-5-5"><span class="section-number-4">4.5.5</span> 转换函数</h4>
<div class="outline-text-4" id="text-4-5-5">
<ul class="org-ul">
<li>to_char
</li>
<li>to_date
</li>
<li>to_number
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4-5-6" class="outline-4">
<h4 id="sec-4-5-6"><span class="section-number-4">4.5.6</span> 其他函数</h4>
<div class="outline-text-4" id="text-4-5-6">
<ul class="org-ul">
<li>nvl(e1, e2) 判定e1是否为空，如果为空那么替换为指定的e2.
<pre class="example">
select nvl(null, 2) from dual;
select e.ename, nvl(e.comm, 0) from scott.emp e where comm is null;
</pre>
</li>
<li>nvl2(e1, e2, e3)
<pre class="example">
select e.ename, nvl2(e.comm, e.comm/10, 0) "佣金/10"  from scott.emp e; -- 三个参数。判定第一个是否为 null，如果不是，返回第二个参数，如果是，返回第三个参数。
</pre>
</li>
<li>nullif
<pre class="example">
select nullif(100, 50*2) n1, nullif(100, 33*3) n2 from dual;
</pre>
</li>
<li>decode 大家自我修炼，继续深入。因为它很强大，很厉害，很牛x。我们要掌握它，熟练使用它，让它成为我们的好朋友。
<pre class="example">
select m.name, decode(m.sex, 2, '男', 1, '女', '未知') from mates m;
</pre>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4-5-7" class="outline-4">
<h4 id="sec-4-5-7"><span class="section-number-4">4.5.7</span> 分组函数</h4>
<div class="outline-text-4" id="text-4-5-7">
<ul class="org-ul">
<li>avg
</li>
<li>max
</li>
<li>sum
</li>
<li>count(*|1)
<pre class="example">
select count(*) from scott.emp;
select count(1) from scott.emp;
select count(distinct deptno) from scott.emp;
</pre>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4-5-8" class="outline-4">
<h4 id="sec-4-5-8"><span class="section-number-4">4.5.8</span> 分析函数</h4>
<div class="outline-text-4" id="text-4-5-8">
<ul class="org-ul">
<li>row_number
</li>
<li>rank
</li>
<li>dense_rank
</li>
</ul>
</div>
</div>
</div>
</section>




<section id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> 锁 (LOCK)</h2>
<div class="outline-text-2" id="text-5">
<p>
锁是为了保证数据的并行性，一致性，完整性
</p>
</div>

<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> 行级锁，事务锁</h3>
<div class="outline-text-3" id="text-5-1">
<p>
可以通过 update/insert/delete/select for update 对指定数据加上行级锁。
</p>

<p>
大致的原理如下：
</p>
<blockquote>
<p>
Oracle 的每行数据上，都存在一个标志位表示每行数据是否被锁定。每个表也有标志位表示表的锁定情况。
</p>
<pre class="example">
update emp set sal = sal + 1000 where empno = 7788;
</pre>
<p>
Oracle 对语句进行解析后，找到7788记录的数据块，并找到一个可用的undo块，将sal列的原数据放入undo块，
然后在数据头部设置相应SCN (System Change Number) 号、事务槽信息、锁定标志等，表明行被锁定。
若有其他人也要修改这一行，其过程是一样的，但在设置锁定标志的时候，如果发现锁定已经存在，就会等待，直到之前的锁消失。
</p>
</blockquote>

<p>
下面句子中，nowait表示，如果发现数据锁定了，不等待，而是立刻返回错误。
</p>
<pre class="example">
select for update nowait;
</pre>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> 乐观锁、悲观锁</h3>
<div class="outline-text-3" id="text-5-2">
<p>
自己找一下相关资料
</p>
</div>
</div>


<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> 被锁定的对象，解锁的方法</h3>
<div class="outline-text-3" id="text-5-3">
<p>
只能杀掉锁定对象的 session，查看锁定对象的语句：
</p>
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #a020f0;">SELECT</span> c.sid, c.serial#, a.object_id, a.session_id, b.object_name, c.*
  <span style="color: #a020f0;">FROM</span> v$locked_object a, dba_objects b, v$<span style="color: #a020f0;">session</span> c
 <span style="color: #a020f0;">WHERE</span> a.object_id = b.object_id
   <span style="color: #a020f0;">AND</span> a.SESSION_ID = c.sid<span style="color: #707183;">(</span>+<span style="color: #707183;">)</span>;
</pre>
</div>
<p>
杀掉 Session 的语句:
</p>
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">system</span> kill <span style="color: #a020f0;">session</span> <span style="color: #8b2252;">'sid, serial#'</span>;
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">system</span> kill <span style="color: #a020f0;">session</span> <span style="color: #8b2252;">'2,33'</span>;
</pre>
</div>
</div>
</div>
</section>


<section id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> 同义词 (Synonymous)</h2>
<div class="outline-text-2" id="text-6">
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#24517;&#39035;&#35201;&#25317;&#26377;&#21019;&#24314;&#21516;&#20041;&#35789;&#30340;&#26435;&#38480;</span>
<span style="color: #a020f0;">grant</span> <span style="color: #a020f0;">create</span> synonym <span style="color: #a020f0;">to</span> vip;

<span style="color: #b22222;">-- &#22522;&#26412;&#30340;&#21019;&#24314;</span>
<span style="color: #a020f0;">create</span> synonym s10 <span style="color: #a020f0;">for</span> sssssssss;                    <span style="color: #b22222;">-- &#31616;&#21270; sql &#35821;&#21477;.</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">or</span> replace synonym e <span style="color: #a020f0;">for</span> scott.emp;           <span style="color: #b22222;">-- &#30465;&#30053; schema&#65292;&#38544;&#34255;&#32454;&#33410;&#65292;&#31616;&#21270;&#25805;&#20316;</span>


<span style="color: #b22222;">-- &#21516;&#20041;&#35789;&#30340;&#21024;&#38500;</span>
<span style="color: #a020f0;">drop</span> synonym e;


<span style="color: #b22222;">-- &#20844;&#29992;&#21516;&#20041;&#35789;&#30340;&#20351;&#29992;&#12290;&#19968;&#27425;&#21019;&#24314;&#65292;&#27599;&#20010;&#29992;&#25143;&#37117;&#21487;&#20197;&#20351;&#29992;&#12290;</span>
<span style="color: #a020f0;">grant</span> <span style="color: #a020f0;">create</span> <span style="color: #a020f0;">public</span> synonym <span style="color: #a020f0;">to</span> vip;
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">public</span> synonym e <span style="color: #a020f0;">for</span> scott.emp;


<span style="color: #b22222;">-- &#21024;&#38500;&#20844;&#29992;&#21516;&#20041;&#35789;</span>
<span style="color: #a020f0;">drop</span> <span style="color: #a020f0;">public</span> synonym e;


<span style="color: #b22222;">-- DBA_XXX &#31561;&#20854;&#23454;&#20063;&#26159;&#21516;&#20041;&#35789;&#65292;&#25152;&#20197;&#22312;&#35843;&#29992;&#30340;&#26102;&#20505;&#65292;&#19981;&#38656;&#35201;&#20889; SYS.</span>
<span style="color: #a020f0;">select</span> object_name, object_type <span style="color: #a020f0;">from</span> dba_objects <span style="color: #a020f0;">where</span> object_name = <span style="color: #8b2252;">'DBA_OBJECTS;'</span>
</pre>
</div>

<p>
有余力的同学也可以看一下 database link 的概念。
</p>
</div>
</section>

<section id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> 序列 (Sequence)</h2>
<div class="outline-text-2" id="text-7">
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- SQLServer &#20013;&#33258;&#22686;&#23383;&#27573;&#30340;&#20889;&#27861;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">test</span><span style="color: #707183;">(</span>id <span style="color: #228b22;">int</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span> <span style="color: #a020f0;">identity</span><span style="color: #707183;">)</span>;
<span style="color: #b22222;">-- MySQL &#20013;&#33258;&#22686;&#23383;&#27573;&#30340;&#20889;&#27861;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">test</span><span style="color: #707183;">(</span>id <span style="color: #228b22;">int</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span> auto_increment<span style="color: #707183;">)</span>;


<span style="color: #b22222;">-- &#21019;&#24314;&#19968;&#20010;&#24207;&#21015;&#35821;&#27861;</span>
<span style="color: #a020f0;">CREATE</span> <span style="color: #a020f0;">SEQUENCE</span> <span style="color: #0000ff;">&#24207;&#21015;&#21517;&#23383;</span>
  <span style="color: #707183;">[</span><span style="color: #a020f0;">start</span> <span style="color: #a020f0;">with</span> &#25968;&#23383;<span style="color: #707183;">]</span>     <span style="color: #b22222;">-- &#21021;&#22987;&#25968;&#23383;</span>
  <span style="color: #707183;">[</span>minvalue &#25968;&#23383;<span style="color: #707183;">]</span>       <span style="color: #b22222;">-- &#26368;&#23567;&#20540;</span>
  <span style="color: #707183;">[</span>maxvalue &#25968;&#23383;<span style="color: #707183;">]</span>       <span style="color: #b22222;">-- &#26368;&#22823;&#20540;</span>
  <span style="color: #707183;">[</span>increment <span style="color: #a020f0;">by</span> &#25968;&#23383;<span style="color: #707183;">]</span>   <span style="color: #b22222;">-- &#22686;&#37327;</span>
  <span style="color: #707183;">[</span><span style="color: #a020f0;">cycle</span><span style="color: #707183;">]</span>               <span style="color: #b22222;">-- &#26159;&#21542;&#35201;&#24490;&#29615;</span>
  <span style="color: #707183;">[</span>cache &#25968;&#23383;<span style="color: #707183;">]</span>          <span style="color: #b22222;">-- &#26159;&#21542;&#32531;&#23384;&#65292;&#21363;&#26159;&#21542;&#22312;&#20869;&#23384;&#20013;&#39044;&#20808;&#20998;&#37197;&#25509;&#19979;&#26469;&#35201;&#29992;&#21040;&#30340;&#25968;&#23383;</span>
  <span style="color: #707183;">[</span><span style="color: #a020f0;">order</span> | nooreder<span style="color: #707183;">]</span>    <span style="color: #b22222;">-- &#25490;&#24207;</span>
&#12288;

<span style="color: #b22222;">-- &#26368;&#22522;&#26412;&#30340;&#21019;&#24314;&#12290;&#40664;&#35748;&#20174;1&#24320;&#22987;&#65292;&#22686;&#37327;&#20026;1</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">sequence</span> <span style="color: #0000ff;">seq_001</span>;

<span style="color: #b22222;">-- start with &#30340;&#20540;&#34920;&#31034;&#21021;&#22987;&#65292;&#24517;&#39035;&#35201;&#22823;&#20110;&#31561;&#20110; minvalue</span>
<span style="color: #b22222;">-- &#22914;&#26524;&#26159; nocycle &#27169;&#24335;&#65292;&#21040;&#36798;&#26368;&#22823;&#20540;&#32487;&#32493;&#25191;&#34892;&#20250;&#25253;&#38169;&#12290;&#21542;&#21017;&#65292;&#20250;&#24490;&#29615;&#12290;</span>
<span style="color: #b22222;">-- &#24490;&#29615;&#30340;&#36215;&#22987;&#25968;&#20540;&#26159; minvalue &#32780;&#19981;&#26159; start with &#30340;&#20540;&#12290;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">sequence</span> <span style="color: #0000ff;">seq_006</span> <span style="color: #a020f0;">start</span> <span style="color: #a020f0;">with</span> 3 minvalue -6 maxvalue 8 <span style="color: #a020f0;">cycle</span> nocache;

<span style="color: #b22222;">-- &#20462;&#25913;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">sequence</span> <span style="color: #0000ff;">increment</span> <span style="color: #a020f0;">by</span> 8;
rename seq_006 <span style="color: #a020f0;">to</span> seq_666;

<span style="color: #b22222;">-- &#21024;&#38500;&#24207;&#21015;</span>
<span style="color: #a020f0;">drop</span> <span style="color: #a020f0;">sequence</span> <span style="color: #0000ff;">seq_006</span>;

<span style="color: #b22222;">-- &#24207;&#21015;&#30340;&#20351;&#29992;</span>
<span style="color: #a020f0;">select</span> &#24207;&#21015;&#21517;&#23383;.nextval <span style="color: #a020f0;">from</span> dual;    <span style="color: #b22222;">-- &#24207;&#21015;&#30340;&#19979;&#19968;&#20010;&#20540;&#65292;&#35843;&#29992;&#20043;&#21518;&#20250;&#33258;&#21160;&#22686;&#38271;&#65292;&#27599;&#27425;&#36820;&#22238;&#20540;&#19981;&#19968;&#23450;&#30456;&#21516;&#12290;</span>
<span style="color: #a020f0;">select</span> &#24207;&#21015;&#21517;&#23383;.currval <span style="color: #a020f0;">from</span> dual;    <span style="color: #b22222;">-- &#36820;&#22238;&#24207;&#21015;&#30340;&#24403;&#21069;&#20540;&#65292;&#27599;&#27425;&#35843;&#29992;&#36820;&#22238;&#20540;&#26159;&#19968;&#33268;&#30340;&#12290;&#38656;&#35201;&#24207;&#21015;&#34987;&#21021;&#22987;&#21270;(nextval)&#20043;&#21518;&#25165;&#33021;&#20351;&#29992;&#65292;&#21542;&#21017;&#25253;&#38169;&#12290;</span>

<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">seqtab</span> <span style="color: #707183;">(</span>id <span style="color: #a020f0;">number</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span>, <span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> seqtab <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>seq_001.nextval, <span style="color: #8b2252;">'hello'</span><span style="color: #707183;">)</span>; <span style="color: #b22222;">-- &#36825;&#31181;&#20889;&#27861;&#34429;&#28982;&#30475;&#36215;&#26469;&#40635;&#28902;&#65292;&#20294;&#26159;&#22312;&#24320;&#21457;&#20013;&#26377;&#20854;&#28789;&#27963;&#24615;&#21644;&#36890;&#29992;&#24615;&#65292;&#26159;&#38750;&#24120;&#24378;&#22823;&#30340;&#12290;</span>

<span style="color: #b22222;">-- &#33258;&#21160;&#25554;&#20837;&#65292;&#38656;&#35201;&#37197;&#21512;&#35302;&#21457;&#22120; (triggle) &#20351;&#29992;&#12290;&#26377;&#20852;&#36259;&#12289;&#26377;&#20313;&#21147;&#30340;&#21516;&#23398;&#65292;&#35831;&#33258;&#24049;&#20851;&#27880;&#12290;&#20854;&#20182;&#20154;&#26080;&#35270;&#21017;&#21487;&#12290;</span>
</pre>
</div>
</div>
</section>

<section id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> 分区 (Partition)</h2>
<div class="outline-text-2" id="text-8">
<p>
建议在下面两种情况下要对表进行分区:
</p>
<ol class="org-ol">
<li>表的数据量超过 2G
</li>
<li>表里面存在大量的历史数据
</li>
</ol>

<p>
表分区是为了达到分而治之的目的，是鸡蛋不能放在同一个篮子里的切实实践。首先能提高效率，再者可保障安全。
</p>

<p>
Oracle 里的基本分区有：
</p>
<ol class="org-ol">
<li>范围分区(Range)
</li>
<li>列表分区(List)
</li>
<li>哈希分区(Hash)
</li>
</ol>

<p>
另外可以对表的分区进行复合，建立子分区。 Oracle 11 之后添加了很多不同的复合形式，但常用的有两种：
</p>
<ol class="org-ol">
<li>范围-哈希分区
</li>
<li>范围-列表分区
</li>
</ol>

<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#26597;&#30475;&#24403;&#21069;&#29992;&#25143;&#19979;&#34920;&#30340;&#20998;&#21306;&#35814;&#24773;&#12290;</span>
<span style="color: #a020f0;">select</span> <span style="color: #a020f0;">table_name</span>, partition_name <span style="color: #a020f0;">from</span> user_tab_partitions;
<span style="color: #a020f0;">select</span> <span style="color: #a020f0;">table_name</span>, partition_name, subpartition_name <span style="color: #a020f0;">from</span> user_tab_subpartitions;

<span style="color: #b22222;">-- &#20174;&#20998;&#21306;&#20013;&#26597;&#35810;&#25968;&#25454;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> <span style="color: #a020f0;">table_name</span> partition <span style="color: #707183;">(</span>partition_name<span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#22797;&#21512;&#20998;&#21306;&#20013;&#36827;&#34892;&#26597;&#35810;&#25968;&#25454;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> cxbe3 subpartition <span style="color: #707183;">(</span>p1_ps4<span style="color: #707183;">)</span>;   <span style="color: #b22222;">-- &#34920;&#31034; p1 &#20998;&#21306;&#19979;&#30340; ps4 &#23376;&#20998;&#21306;</span>
</pre>
</div>
</div>

<div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1"><span class="section-number-3">8.1</span> 范围分区</h3>
<div class="outline-text-3" id="text-8-1">
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#22522;&#26412;&#21019;&#24314;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">bea1</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>, birth <span style="color: #228b22;">date</span>, yz <span style="color: #a020f0;">number</span><span style="color: #707183;">)</span>;   <span style="color: #b22222;">-- &#34920;&#30340;&#21019;&#24314;&#35821;&#21477;&#65292;&#19981;&#24102;&#20998;&#21306;&#30340;&#24773;&#20917;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">bea2</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>, birth <span style="color: #228b22;">date</span>, yz <span style="color: #a020f0;">number</span><span style="color: #707183;">)</span>    <span style="color: #b22222;">-- &#25353;&#29031;&#29983;&#26085;&#65292;&#33539;&#22260;&#20998;&#21306;&#12290;</span>
partition <span style="color: #a020f0;">by</span> range <span style="color: #707183;">(</span>birth<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>
  partition p1 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #7388d6;">(</span>to_date<span style="color: #909183;">(</span><span style="color: #8b2252;">'19900101'</span>, <span style="color: #8b2252;">'yyyymmdd'</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>,
  partition p2 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #7388d6;">(</span>to_date<span style="color: #909183;">(</span><span style="color: #8b2252;">'20000101'</span>, <span style="color: #8b2252;">'yyyymmdd'</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
<span style="color: #707183;">)</span>;
<span style="color: #b22222;">-- &#27979;&#35797; bea2</span>
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> bea2 <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'xxx'</span>, to_date<span style="color: #7388d6;">(</span><span style="color: #8b2252;">'19880102'</span><span style="color: #7388d6;">)</span>, 87<span style="color: #707183;">)</span>;   <span style="color: #b22222;">-- &#20250;&#34987;&#25554;&#20837;&#21040; p1 &#20998;&#21306;</span>
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> bea2 <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'yyy'</span>, to_date<span style="color: #7388d6;">(</span><span style="color: #8b2252;">'19920102'</span><span style="color: #7388d6;">)</span>, 82<span style="color: #707183;">)</span>;   <span style="color: #b22222;">-- &#20250;&#34987;&#25554;&#20837;&#21040; p2 &#20998;&#21306;</span>
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> bea2 <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'zzz'</span>, to_date<span style="color: #7388d6;">(</span><span style="color: #8b2252;">'20010102'</span><span style="color: #7388d6;">)</span>, 89<span style="color: #707183;">)</span>;   <span style="color: #b22222;">-- &#20250;&#20986;&#29616;&#38169;&#35823;&#65292;ORA-14400: &#25554;&#20837;&#30340;&#20998;&#21306;&#20851;&#38190;&#23383;&#26410;&#26144;&#23556;&#21040;&#20219;&#20309;&#20998;&#21306;&#12290;&#22240;&#20026;&#27809;&#20026;&#36825;&#26465;&#25968;&#25454;&#21019;&#24314;&#30456;&#24212;&#20998;&#21306;&#12290;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> bea2;                   <span style="color: #b22222;">-- &#20004;&#26465;&#25968;&#25454;&#65292;xxx &#21644; yyy</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> bea2 partition <span style="color: #707183;">(</span>p1<span style="color: #707183;">)</span>;    <span style="color: #b22222;">-- &#26174;&#31034;&#30340;&#26159; xxx &#30340;&#25968;&#25454;&#12290;&#36825;&#26159;&#20174;&#29305;&#23450;&#20998;&#21306;&#20013;&#26597;&#35810;&#25968;&#25454;&#30340;&#35821;&#27861;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> bea2 partition <span style="color: #707183;">(</span>p2<span style="color: #707183;">)</span>;    <span style="color: #b22222;">-- &#26174;&#31034;&#30340;&#26159; yyy &#30340;&#25968;&#25454;</span>

<span style="color: #b22222;">-- maxvalue &#30340;&#20351;&#29992;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">bea3</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>, birth <span style="color: #228b22;">date</span>, yz <span style="color: #a020f0;">number</span><span style="color: #707183;">)</span>    <span style="color: #b22222;">-- &#25353;&#29031;&#29983;&#26085;&#65292;&#33539;&#22260;&#20998;&#21306;&#12290;</span>
partition <span style="color: #a020f0;">by</span> range <span style="color: #707183;">(</span>birth<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>
  partition p1 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #7388d6;">(</span>to_date<span style="color: #909183;">(</span><span style="color: #8b2252;">'19900101'</span>, <span style="color: #8b2252;">'yyyymmdd'</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>,
  partition p2 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #7388d6;">(</span>to_date<span style="color: #909183;">(</span><span style="color: #8b2252;">'20000101'</span>, <span style="color: #8b2252;">'yyyymmdd'</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>,
  partition p3 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #7388d6;">(</span>MAXVALUE<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> bea3 <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'zzz'</span>, to_date<span style="color: #7388d6;">(</span><span style="color: #8b2252;">'20010102'</span><span style="color: #7388d6;">)</span>, 89<span style="color: #707183;">)</span>;   <span style="color: #b22222;">-- &#25554;&#20837;&#30340;&#26159;&#26377;maxvalue&#20851;&#38190;&#23383;&#30340; p3 &#20998;&#21306;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> bea3 partition <span style="color: #707183;">(</span>p3<span style="color: #707183;">)</span>;                          <span style="color: #b22222;">-- &#21487;&#20197;&#26597;&#35810;&#21040;.</span>

<span style="color: #b22222;">-- &#20998;&#21306;&#30340;&#20851;&#38190;&#23383;&#65292;&#21487;&#20197;&#26159;&#25968;&#20540;&#65292;&#21487;&#20197;&#26159;&#26085;&#26399;&#65292;&#20063;&#21487;&#20197;&#26159;&#23383;&#31526;&#20018;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">bea5</span><span style="color: #707183;">(</span><span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>,birth <span style="color: #228b22;">date</span>, yz <span style="color: #a020f0;">number</span><span style="color: #707183;">)</span>
partition <span style="color: #a020f0;">by</span> range<span style="color: #707183;">(</span><span style="color: #a020f0;">name</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>
  partition p1 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #7388d6;">(</span><span style="color: #8b2252;">'i'</span><span style="color: #7388d6;">)</span>,
  partition p2 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #7388d6;">(</span><span style="color: #8b2252;">'x'</span><span style="color: #7388d6;">)</span>,
  partition p3 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #7388d6;">(</span>MAXVALUE<span style="color: #7388d6;">)</span>
<span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#22312;&#21019;&#24314;&#27599;&#20010;&#20998;&#21306;&#30340;&#26102;&#20505;&#65292;&#20026;&#27599;&#20010;&#20998;&#21306;&#25351;&#23450;&#34920;&#31354;&#38388;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">bea6</span><span style="color: #707183;">(</span><span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>,birth <span style="color: #228b22;">date</span>, yz <span style="color: #a020f0;">number</span><span style="color: #707183;">)</span>
partition <span style="color: #a020f0;">by</span> range<span style="color: #707183;">(</span>yz<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>
  partition p1 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #7388d6;">(</span>60<span style="color: #7388d6;">)</span>,
  partition p2 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #7388d6;">(</span>85<span style="color: #7388d6;">)</span> tablespace users,
  partition p3 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #7388d6;">(</span>MAXVALUE<span style="color: #7388d6;">)</span> tablespace <span style="color: #a020f0;">system</span>
<span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#21487;&#20197;&#25353;&#29031;&#22810;&#20010;&#23383;&#27573;&#36827;&#34892;&#20998;&#21306;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">bea7</span><span style="color: #707183;">(</span><span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>,birth <span style="color: #228b22;">date</span>, yz <span style="color: #a020f0;">number</span><span style="color: #707183;">)</span>
partition <span style="color: #a020f0;">by</span> range<span style="color: #707183;">(</span><span style="color: #a020f0;">name</span>, yz<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>
  partition p1 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #7388d6;">(</span><span style="color: #8b2252;">'j'</span>, 60<span style="color: #7388d6;">)</span>,
  partition p2 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #7388d6;">(</span><span style="color: #8b2252;">'z'</span>, 90<span style="color: #7388d6;">)</span>,
  partition p3 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #7388d6;">(</span>MAXVALUE, MAXVALUE<span style="color: #7388d6;">)</span>
<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-8-2" class="outline-3">
<h3 id="sec-8-2"><span class="section-number-3">8.2</span> 列表分区</h3>
<div class="outline-text-3" id="text-8-2">
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#25353;&#29031;&#24615;&#21035;&#36827;&#34892;&#20998;&#21306;&#12290;&#19981;&#35201;&#24536;&#35760;&#25351;&#23450;&#40664;&#35748;&#20998;&#21306;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">beaa</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>, sex varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>, yz <span style="color: #a020f0;">number</span><span style="color: #707183;">)</span>
partition <span style="color: #a020f0;">by</span> list <span style="color: #707183;">(</span>sex<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>
    partition p1 <span style="color: #a020f0;">values</span> <span style="color: #7388d6;">(</span><span style="color: #8b2252;">'&#30007;'</span><span style="color: #7388d6;">)</span>,
    partition p2 <span style="color: #a020f0;">values</span> <span style="color: #7388d6;">(</span><span style="color: #8b2252;">'&#22899;'</span><span style="color: #7388d6;">)</span>,
    partition p3 <span style="color: #a020f0;">values</span> <span style="color: #7388d6;">(</span><span style="color: #a020f0;">DEFAULT</span><span style="color: #7388d6;">)</span>
<span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#25351;&#23450;&#30456;&#24212;&#30340;&#23384;&#20648;&#34920;&#31354;&#38388;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">beaa</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>, sex varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>, yz <span style="color: #a020f0;">number</span><span style="color: #707183;">)</span>
partition <span style="color: #a020f0;">by</span> list <span style="color: #707183;">(</span>sex<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>
    partition p1 <span style="color: #a020f0;">values</span> <span style="color: #7388d6;">(</span><span style="color: #8b2252;">'&#30007;'</span><span style="color: #7388d6;">)</span> tablespace users,
    partition p2 <span style="color: #a020f0;">values</span> <span style="color: #7388d6;">(</span><span style="color: #8b2252;">'&#22899;'</span><span style="color: #7388d6;">)</span> tablespace <span style="color: #a020f0;">system</span>,
    partition p3 <span style="color: #a020f0;">values</span> <span style="color: #7388d6;">(</span><span style="color: #a020f0;">DEFAULT</span><span style="color: #7388d6;">)</span>
<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-8-3" class="outline-3">
<h3 id="sec-8-3"><span class="section-number-3">8.3</span> 哈希分区</h3>
<div class="outline-text-3" id="text-8-3">
<p>
<a href="http://www.bing.com/knows/search?q=%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95&mkt=zh-cn&FORM=BKACAI">哈希算法</a>,散列是也~
</p>

<div class="org-src-container">

<pre class="src src-sql"><span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">beax</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>, yz <span style="color: #a020f0;">number</span><span style="color: #707183;">)</span>
partition <span style="color: #a020f0;">by</span> hash <span style="color: #707183;">(</span><span style="color: #a020f0;">name</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>
  partition p1 tablespace users,
  partition p2,
  partition p3,
  partition p4,
  partition p5
<span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#21019;&#24314;&#22810;&#20010;&#20998;&#21306;&#30340;&#31616;&#30053;&#20889;&#27861;&#12290;&#20998;&#21306;&#30340;&#21517;&#23383;&#30001;oracle&#33258;&#21160;&#32500;&#25252;&#12290;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">beax</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>, yz <span style="color: #a020f0;">number</span><span style="color: #707183;">)</span>
partition <span style="color: #a020f0;">by</span> hash <span style="color: #707183;">(</span><span style="color: #a020f0;">name</span><span style="color: #707183;">)</span>
partitions 5;

<span style="color: #b22222;">-- &#25351;&#23450;&#34920;&#31354;&#38388;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">beax</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>, yz <span style="color: #a020f0;">number</span><span style="color: #707183;">)</span>
partition <span style="color: #a020f0;">by</span> hash <span style="color: #707183;">(</span><span style="color: #a020f0;">name</span><span style="color: #707183;">)</span>
partitions 5 stores <span style="color: #a020f0;">in</span> <span style="color: #707183;">(</span>users, <span style="color: #a020f0;">system</span>, users, <span style="color: #a020f0;">system</span>, <span style="color: #a020f0;">system</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-8-4" class="outline-3">
<h3 id="sec-8-4"><span class="section-number-3">8.4</span> 范围-列表分区</h3>
<div class="outline-text-3" id="text-8-4">
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#20808;&#25353;&#29031;&#29983;&#26085;&#20998;&#21306;&#65292;&#20043;&#21518;&#23376;&#20998;&#21306;&#26159;&#25353;&#29031;&#21517;&#23383;&#21704;&#24076;&#20998;&#21306;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">cxbe1</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>, birth <span style="color: #228b22;">date</span>, yz <span style="color: #a020f0;">number</span><span style="color: #707183;">)</span>
partition <span style="color: #a020f0;">by</span> range <span style="color: #707183;">(</span>birth<span style="color: #707183;">)</span>
subpartition <span style="color: #a020f0;">by</span> hash <span style="color: #707183;">(</span><span style="color: #a020f0;">name</span><span style="color: #707183;">)</span>
subpartitions 3
<span style="color: #707183;">(</span>
  partition p1 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #7388d6;">(</span>to_date<span style="color: #909183;">(</span><span style="color: #8b2252;">'19900101'</span>,<span style="color: #8b2252;">'yyyymmdd'</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>,
  partition p2 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #7388d6;">(</span>to_date<span style="color: #909183;">(</span><span style="color: #8b2252;">'20000101'</span>,<span style="color: #8b2252;">'yyyymmdd'</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>,
  partition p3 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #7388d6;">(</span>maxvalue<span style="color: #7388d6;">)</span>
<span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#20808;&#25353;&#29031;&#39068;&#20540;&#20998;&#21306;&#65292;&#20043;&#21518;&#23376;&#20998;&#21306;&#26159;&#25353;&#29031;&#29983;&#26085;&#21704;&#24076;&#20998;&#21306;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">cxbe2</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>, birth <span style="color: #228b22;">date</span>, yz <span style="color: #a020f0;">number</span><span style="color: #707183;">)</span>
partition <span style="color: #a020f0;">by</span> range <span style="color: #707183;">(</span>yz<span style="color: #707183;">)</span>
subpartition <span style="color: #a020f0;">by</span> hash <span style="color: #707183;">(</span>birth<span style="color: #707183;">)</span>
subpartitions 3
<span style="color: #707183;">(</span>
  partition p1 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #7388d6;">(</span>50<span style="color: #7388d6;">)</span>,
  partition p2 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #7388d6;">(</span>80<span style="color: #7388d6;">)</span>,
  partition p3 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #7388d6;">(</span>MAXVALUE<span style="color: #7388d6;">)</span>
<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-8-5" class="outline-3">
<h3 id="sec-8-5"><span class="section-number-3">8.5</span> 范围-列表分区</h3>
<div class="outline-text-3" id="text-8-5">
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#20808;&#25353;&#29031;&#39068;&#20540;&#33539;&#22260;&#20998;&#21306;&#65292;&#22312;&#27599;&#20010;&#20998;&#21306;&#20869;&#20877;&#36827;&#34892;&#21704;&#24076;&#20998;&#21306;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">cxbe3</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>, sex varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>, yz <span style="color: #a020f0;">number</span><span style="color: #707183;">)</span>
partition <span style="color: #a020f0;">by</span> range <span style="color: #707183;">(</span>yz<span style="color: #707183;">)</span>
subpartition <span style="color: #a020f0;">by</span> list <span style="color: #707183;">(</span>sex<span style="color: #707183;">)</span>
subpartitions template
<span style="color: #707183;">(</span>
  subpartition ps1 <span style="color: #a020f0;">values</span> <span style="color: #7388d6;">(</span><span style="color: #8b2252;">'&#30007;'</span><span style="color: #7388d6;">)</span> tablespace users,
  subpartition ps2 <span style="color: #a020f0;">values</span> <span style="color: #7388d6;">(</span><span style="color: #8b2252;">'&#22899;'</span><span style="color: #7388d6;">)</span> tablespace users,
  subpartition ps2 <span style="color: #a020f0;">values</span> <span style="color: #7388d6;">(</span><span style="color: #a020f0;">DEFAULT</span><span style="color: #7388d6;">)</span>
<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>
  partition p1 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #7388d6;">(</span>60<span style="color: #7388d6;">)</span>,
  partition p2 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #7388d6;">(</span>80<span style="color: #7388d6;">)</span>,
  partition p3 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #7388d6;">(</span>MAXVALUE<span style="color: #7388d6;">)</span>
<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-8-6" class="outline-3">
<h3 id="sec-8-6"><span class="section-number-3">8.6</span> 分区的修改</h3>
<div class="outline-text-3" id="text-8-6">
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#28155;&#21152;&#20998;&#21306;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">bea2</span> <span style="color: #a020f0;">add</span> partition p9 <span style="color: #a020f0;">values</span> <span style="color: #a020f0;">less</span> <span style="color: #a020f0;">than</span> <span style="color: #707183;">(</span>MAXVALUE<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">bea2</span> <span style="color: #a020f0;">add</span> partition p9 <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>1, 2<span style="color: #707183;">)</span>;   <span style="color: #b22222;">-- &#38024;&#23545; list &#20998;&#21306;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">bea2</span> <span style="color: #a020f0;">add</span> partition;                    <span style="color: #b22222;">-- &#38024;&#23545; hash &#20998;&#21306;</span>

<span style="color: #b22222;">-- &#21024;&#38500;&#20998;&#21306;&#20869;&#25968;&#25454;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">bea2</span> truncate partition p3;

<span style="color: #b22222;">-- &#21024;&#38500;&#20998;&#21306;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">bea2</span> <span style="color: #a020f0;">drop</span> partition p3;

<span style="color: #b22222;">-- &#21512;&#24182;&#30456;&#37051;&#20998;&#21306;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">bea2</span> merge partitions p2, p3 <span style="color: #a020f0;">into</span> partition p8;

<span style="color: #b22222;">-- &#25286;&#20998;&#20998;&#21306;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">bea2</span> split partition p2 <span style="color: #a020f0;">at</span> <span style="color: #707183;">(</span>3000<span style="color: #707183;">)</span> <span style="color: #a020f0;">into</span> <span style="color: #707183;">(</span>partition p3, partition p14<span style="color: #707183;">)</span>;     <span style="color: #b22222;">-- &#33539;&#22260;&#20998;&#21306;&#30340;&#25286;&#20998;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">bea2</span> split partition p2 <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>1,2<span style="color: #707183;">)</span> <span style="color: #a020f0;">into</span> <span style="color: #707183;">(</span>partition p3, partition p4<span style="color: #707183;">)</span>;   <span style="color: #b22222;">-- &#21015;&#34920;&#20998;&#21306;&#30340;&#25286;&#20998;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">bea2</span> split partition p2 <span style="color: #a020f0;">into</span> <span style="color: #707183;">(</span>partition p3 <span style="color: #a020f0;">values</span> <span style="color: #7388d6;">(</span>1, 2<span style="color: #7388d6;">)</span>, partition p4 <span style="color: #a020f0;">values</span> <span style="color: #7388d6;">(</span>3<span style="color: #7388d6;">)</span>, partition p5<span style="color: #707183;">)</span>;   <span style="color: #b22222;">-- &#21015;&#34920;&#20998;&#21306;&#30340;&#25286;&#20998;</span>

<span style="color: #b22222;">-- &#37325;&#21629;&#21517;&#20998;&#21306;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">bea2</span> rename partition p2 <span style="color: #a020f0;">to</span> p12;
</pre>
</div>

<p>
如果分区字段的数据被 update，发生了跨分区的情况，会发生什么？
</p>
<pre class="example">
错误:更新分区关键字列将导致分区的更改
</pre>
<p>
可以通过以下语法，使行数据可以移动
</p>
<pre class="example">
alter table m8 enable row movement;
</pre>
<p>
通过这种方式，实现了行数据的迁移。但是数据的 rowid 也会随之发生变化。
</p>
</div>
</div>
</section>

<section id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> 视图 (View)</h2>
<div class="outline-text-2" id="text-9">
<p>
四种类型
</p>
<ol class="org-ol">
<li>关系视图 (Relational View)
</li>
<li>内嵌式图 (Inline View)
</li>
<li>对象视图 (Object View)
</li>
<li>物化视图 (Materialize View)
</li>
</ol>
</div>

<div id="outline-container-sec-9-1" class="outline-3">
<h3 id="sec-9-1"><span class="section-number-3">9.1</span> 关系视图</h3>
<div class="outline-text-3" id="text-9-1">
<p>
又称为虚表，不占物理空间，存储在数据字典中。它能简化命令，隐藏复杂度，解耦，增强安全性。
</p>

<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#21021;&#22987;&#21270;&#35201;&#20351;&#29992;&#30340;&#34920;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">emp</span> <span style="color: #a020f0;">as</span> <span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp;                        <span style="color: #b22222;">-- &#22797;&#21046;&#34920;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">emp</span> <span style="color: #a020f0;">add</span> <span style="color: #a020f0;">constraints</span> pk_emp <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span> <span style="color: #707183;">(</span>empno<span style="color: #707183;">)</span>;   <span style="color: #b22222;">-- &#28155;&#21152;&#20027;&#38190;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">dept</span> <span style="color: #a020f0;">as</span> <span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> dept;

<span style="color: #b22222;">-- &#21019;&#24314;&#35821;&#27861;</span>
<span style="color: #a020f0;">create</span> <span style="color: #707183;">[</span><span style="color: #a020f0;">or</span> replace<span style="color: #707183;">]</span> <span style="color: #707183;">[</span>force | noforce<span style="color: #707183;">]</span>
<span style="color: #a020f0;">view</span> view_name <span style="color: #a020f0;">as</span> <span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> <span style="color: #a020f0;">table_name</span>
<span style="color: #707183;">[</span><span style="color: #a020f0;">with</span> <span style="color: #a020f0;">read</span> <span style="color: #a020f0;">only</span><span style="color: #707183;">]</span>              <span style="color: #b22222;">-- &#24378;&#36843;&#35270;&#22270;&#21482;&#33021;&#26597;&#30475;&#65292;&#19981;&#33021;&#20462;&#25913;</span>
<span style="color: #707183;">[</span><span style="color: #a020f0;">with</span> <span style="color: #a020f0;">check</span> <span style="color: #a020f0;">option</span><span style="color: #707183;">]</span>
;

<span style="color: #b22222;">-- &#21019;&#24314;&#35270;&#22270;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">view</span> <span style="color: #0000ff;">v_emp</span> <span style="color: #a020f0;">as</span> <span style="color: #a020f0;">select</span> empno, ename, sal <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> sal &gt; 1000;

<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">view</span> <span style="color: #0000ff;">v_emp01</span> <span style="color: #a020f0;">as</span>
<span style="color: #a020f0;">select</span> e.ename, e.sal, d.dname <span style="color: #a020f0;">from</span> emp e, dept d <span style="color: #a020f0;">where</span> e.deptno = d.deptno;


<span style="color: #b22222;">-- &#21024;&#38500;&#35270;&#22270;</span>
<span style="color: #a020f0;">drop</span> <span style="color: #a020f0;">view</span> <span style="color: #0000ff;">v_emp01</span>;
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-9-2" class="outline-3">
<h3 id="sec-9-2"><span class="section-number-3">9.2</span> 内嵌视图</h3>
<div class="outline-text-3" id="text-9-2">
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#26597;&#35810;&#30340;&#22522;&#26412;&#35821;&#21477;&#65292;from &#21518;&#38754;&#36319;&#30340;&#26159;&#34920;&#25110;&#32773;&#35270;&#22270;</span>
<span style="color: #a020f0;">select</span> &#25152;&#26377;&#35201;&#26597;&#35810;&#30340;&#21015; <span style="color: #a020f0;">from</span> &#35201;&#26597;&#35810;&#30340;&#34920;/&#35270;&#22270; <span style="color: #a020f0;">where</span> clause;

<span style="color: #b22222;">-- &#36825;&#26159;&#20043;&#21069;&#25105;&#20204;&#29992;&#36807;&#30340;&#19968;&#20010;&#26597;&#35810;&#65292;&#26597;&#35810;&#25152;&#26377; rownum &gt; 2 &#30340;&#25152;&#26377;&#25968;&#25454;</span>
<span style="color: #b22222;">-- &#22312;&#36825;&#20010;&#26597;&#35810;&#20013;&#65292;&#25105;&#20204;&#22312; from &#20043;&#21518;&#29992;&#21040;&#20102;&#19968;&#20010;&#24102;&#25324;&#21495;&#30340;&#26597;&#35810;&#35821;&#21477;&#65292;&#36825;&#20010;&#26597;&#35810;&#35821;&#21477;&#23601;&#26159;&#20869;&#23884;&#35270;&#22270;&#12290;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> 
  <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> rownum rn, empno, ename, sal <span style="color: #a020f0;">from</span> scott.emp<span style="color: #707183;">)</span> 
  <span style="color: #a020f0;">where</span> rn &gt; 2;

<span style="color: #b22222;">-- &#20869;&#23884;&#35270;&#22270;&#65292;&#20174;&#36923;&#36753;&#19978;&#21487;&#20197;&#20998;&#35299;&#20026;:</span>
<span style="color: #b22222;">-- &#31532;&#19968;&#27493;&#65306;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">view</span> <span style="color: #0000ff;">linshigong001</span> <span style="color: #a020f0;">as</span> <span style="color: #a020f0;">select</span> rownum rn, empno, ename, sal <span style="color: #a020f0;">from</span> scott.emp;
<span style="color: #b22222;">-- &#31532;&#20108;&#27493;&#65306;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> linshigong001 <span style="color: #a020f0;">where</span> rn &gt; 2;
<span style="color: #b22222;">-- &#31532;&#19977;&#27493;&#65306;</span>
<span style="color: #a020f0;">drop</span> <span style="color: #a020f0;">view</span> <span style="color: #0000ff;">linshigong001</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-9-3" class="outline-3">
<h3 id="sec-9-3"><span class="section-number-3">9.3</span> 对象视图（可选）</h3>
<div class="outline-text-3" id="text-9-3">
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#21019;&#24314;&#23545;&#35937;</span>
<span style="color: #a020f0;">CREATE</span> <span style="color: #a020f0;">OR</span> REPLACE <span style="color: #a020f0;">TYPE</span> <span style="color: #0000ff;">depttype</span> 
<span style="color: #a020f0;">AS</span> <span style="color: #228b22;">OBJECT</span> 
<span style="color: #707183;">(</span>
deptid <span style="color: #a020f0;">number</span>,
deptname varchar2<span style="color: #7388d6;">(</span>30<span style="color: #7388d6;">)</span>,
loc <span style="color: #a020f0;">number</span>
<span style="color: #707183;">)</span>;

<span style="color: #a020f0;">CREATE</span> <span style="color: #a020f0;">OR</span> REPLACE <span style="color: #a020f0;">VIEW</span> <span style="color: #0000ff;">v_dept</span> <span style="color: #a020f0;">OF</span> depttype
  <span style="color: #a020f0;">WITH</span> <span style="color: #228b22;">OBJECT</span> OID <span style="color: #707183;">(</span>deptid<span style="color: #707183;">)</span> 
<span style="color: #a020f0;">AS</span> 
  <span style="color: #a020f0;">SELECT</span> deptid, deptname, loc <span style="color: #a020f0;">FROM</span> emp;

<span style="color: #a020f0;">SELECT</span> * <span style="color: #a020f0;">FROM</span> v_dept;
<span style="color: #a020f0;">select</span> <span style="color: #228b22;">ref</span><span style="color: #707183;">(</span>t<span style="color: #707183;">)</span> <span style="color: #a020f0;">from</span> v_dept t;  <span style="color: #b22222;">-- oid</span>
</pre>
</div>
</div>
</div>



<div id="outline-container-sec-9-4" class="outline-3">
<h3 id="sec-9-4"><span class="section-number-3">9.4</span> 物化视图</h3>
<div class="outline-text-3" id="text-9-4">
<p>
它是 Oracle 中保存了查询结果的对象。它把查询的数据保存为实实在在的数据，再次访问的时候，就不需要从基表中去查询，而直接从保存的数据里拿取。所以能大大提高效率，增强性能。我们可以用能自动同步数据的临时表的概念来理解它。所以，它不是虚表，它占用存储空间。
</p>

<p>
它主要用来提高效率，所以用在查询消耗比较大的连接上。也可以用来把远程的数据缓存到本地，通过这种方式保障性能。
</p>

<p>
这是一种以空间换时间的方法。
</p>

<p>
创建物化视图要考虑一下几个方面：
</p>
<ol class="org-ol">
<li>什么时候生成数据。
<pre class="example">
build immediate/deferred                               -- 在创建无话视图的时候立刻创建，或者推迟到需要的时候手动创建
</pre>
</li>
<li>如果基表里的数据发生变化，以一种什么样的策略保持同步
<pre class="example">
refresh complete/fast/force/never                      -- 四种方式依次对应： 全量刷新，即删除后重新生成 / 增量刷新 / oracle 自动判断，如果能增量则增量否则全量 / 不同步数据
</pre>
</li>
<li>如果基表里的数据发生变化，刷新的时机
<pre class="example">
on commit/demand start with sysdate next sysdate + 1   -- 分别为： 基表有更新的话立刻同步 / 按照时间段，按需同步，按需同步要与 start with next 一起使用
</pre>
</li>
<li>告诉 Oracle，如果从基本中查询数据的时候，允不允许参考使用物化视图里的结果。（如果使用物化视图的话，实质上 oracle 要修改你查询的语句，所以才叫查询重写）
<pre class="example">
enable/disable query rewrite
</pre>
</li>
</ol>


<p>
详细的栗子如下：
</p>
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#26368;&#22522;&#26412;&#30340;&#21019;&#24314;&#12290;&#36825;&#37324;&#29992;&#30340;&#26159;&#20840;&#37327;&#26356;&#26032;&#12290;&#20840;&#37327;&#26356;&#26032;&#20250;&#24456;&#31528;&#37325;&#12290;</span>
<span style="color: #a020f0;">create</span> materialized <span style="color: #a020f0;">view</span> <span style="color: #0000ff;">mv_emp</span>
  build <span style="color: #a020f0;">immediate</span>
  refresh complete
  <span style="color: #a020f0;">on</span> demand <span style="color: #a020f0;">start</span> <span style="color: #a020f0;">with</span> sysdate <span style="color: #a020f0;">next</span> sysdate + 1
  enable query rewrite
  <span style="color: #a020f0;">as</span>
  <span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp;




<span style="color: #b22222;">-- &#20294;&#22914;&#26524;&#35201;&#29992; refresh fast &#26041;&#24335;&#65292;&#21363;&#22686;&#37327;&#26356;&#26032;&#26041;&#24335;&#65292;&#37027;&#20040;&#65292;&#38656;&#35201;&#22312;&#21407;&#26469;&#30340;&#34920;&#19978;&#21019;&#24314;&#29289;&#21270;&#35270;&#22270;&#26085;&#24535;&#34920;&#65292;&#20197;&#20415;&#35753; oracle &#30693;&#36947;&#38656;&#35201;&#21516;&#27493;&#20123;&#20160;&#20040;&#19996;&#35199;&#12290;</span>
<span style="color: #b22222;">-- &#21019;&#24314;&#35821;&#21477;&#20026;&#22914;&#19979;&#65292;&#21518;&#38754;&#38656;&#35201; with &#35821;&#21477;&#25351;&#23450;&#25353;&#29031; rowid &#36824;&#26159;&#20027;&#38190;&#20316;&#20026;&#27599;&#19968;&#34892;&#25968;&#25454;&#30340;&#36523;&#20221;&#35777;&#21495;&#30721;&#12290;</span>
<span style="color: #a020f0;">create</span> materialized <span style="color: #a020f0;">view</span> <span style="color: #0000ff;">log</span> <span style="color: #a020f0;">on</span> emp <span style="color: #a020f0;">with</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span>;
<span style="color: #b22222;">-- &#20043;&#21518;&#21019;&#24314;&#22686;&#37327;&#21047;&#26032;&#30340;&#29289;&#21270;&#35270;&#22270;</span>
<span style="color: #a020f0;">create</span> materialized <span style="color: #a020f0;">view</span> <span style="color: #0000ff;">mv_emp_fast</span>
  build <span style="color: #a020f0;">immediate</span>
  refresh fast
  <span style="color: #a020f0;">on</span> demand <span style="color: #a020f0;">start</span> <span style="color: #a020f0;">with</span> sysdate <span style="color: #a020f0;">next</span> sysdate + 1
  <span style="color: #a020f0;">with</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span>   <span style="color: #b22222;">-- &#36825;&#37324;&#35201;&#36319;&#29289;&#21270;&#35270;&#22270;&#26085;&#24535;&#25351;&#23450;&#30340;&#30456;&#23545;&#24212;&#12290;</span>
  enable query rewrite
  <span style="color: #a020f0;">as</span>
  <span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp;



<span style="color: #b22222;">-- &#21024;&#38500;</span>
<span style="color: #a020f0;">drop</span> materialized <span style="color: #a020f0;">view</span> <span style="color: #0000ff;">log</span> <span style="color: #a020f0;">on</span> emp;
<span style="color: #a020f0;">drop</span> materialized <span style="color: #a020f0;">view</span> <span style="color: #0000ff;">mv_emp</span>;
</pre>
</div>
</div>
</div>
</section>


<section id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> 索引 (Index)</h2>
<div class="outline-text-2" id="text-10">
<p>
创建语句
</p>
<pre class="example">
CREATE INDEX 索引名字 ON 表名 (表的字段名) [TABLESPACE 表空间名字];
</pre>
<p>
重建索引
</p>
<pre class="example">
alter index ind_s rebuild;
</pre>
<p>
删除语句
</p>
<pre class="example">
drop index ind_s;
</pre>

<p>
索引的类型
</p>

<ol class="org-ol">
<li>唯一索引
<pre class="example">
create unique index ind_s on s (name);
</pre>
</li>
<li>组合索引
<pre class="example">
create index ind_s on s (name, addr);
</pre>
</li>
<li>反向索引
<pre class="example">
create index ind_s_reverse on s (name) reverse;
</pre>
</li>
<li>函数索引
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#21019;&#24314;&#19968;&#20010;&#34920;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">ss</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">name</span> varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>, <span style="color: #a020f0;">value</span> <span style="color: #a020f0;">number</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#25554;&#20837;&#20960;&#26465;&#25968;&#25454;</span>
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> ss <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'abc'</span>, 100<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> ss <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'hello'</span>, 99<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> ss <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'ok'</span>, 22<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> ss <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'miss'</span>, 111<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> ss <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'admin'</span>, 190<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">commit</span>;

<span style="color: #b22222;">-- &#22312; name &#23383;&#27573;&#19978;&#21019;&#24314;&#26222;&#36890;&#30340;&#32034;&#24341;</span>
<span style="color: #a020f0;">create</span> index ind_ss_normal <span style="color: #a020f0;">on</span> ss <span style="color: #707183;">(</span><span style="color: #a020f0;">name</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#25171;&#24320; autotrace&#65292;&#26597;&#30475;&#25191;&#34892;&#35745;&#21010;&#12290;</span>
<span style="color: #b22222;">-- &#32467;&#26524;&#65292; table_access_full&#65292;&#21363;&#20840;&#34920;&#25195;&#25551;&#65292;&#20063;&#23601;&#26159;&#35828;&#65292;&#27809;&#26377;&#36208;&#32034;&#24341;</span>
<span style="color: #a020f0;">set</span> autotrace <span style="color: #a020f0;">on</span>;
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> ss <span style="color: #a020f0;">where</span> substr<span style="color: #707183;">(</span><span style="color: #a020f0;">name</span>, 1, 1<span style="color: #707183;">)</span> = <span style="color: #8b2252;">'h'</span>;

<span style="color: #b22222;">-- &#21019;&#24314;&#20851;&#20110; name &#30340;&#20989;&#25968;&#32034;&#24341;</span>
<span style="color: #a020f0;">create</span> index ind_ss_substr <span style="color: #a020f0;">on</span> ss <span style="color: #707183;">(</span>substr<span style="color: #7388d6;">(</span><span style="color: #a020f0;">name</span>, 1, 1<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#20877;&#27425;&#26597;&#30475;&#25191;&#34892;&#35745;&#21010;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> ss <span style="color: #a020f0;">where</span> substr<span style="color: #707183;">(</span><span style="color: #a020f0;">name</span>, 1, 1<span style="color: #707183;">)</span> = <span style="color: #8b2252;">'h'</span>;
<span style="color: #b22222;">-- &#26174;&#31034;&#32467;&#26524;&#22914;&#19979;&#65292;&#21363;&#36208;&#20102;&#32034;&#24341;&#65292;&#36208;&#30340;&#26159;&#25105;&#20204;&#21019;&#24314;&#30340;&#20989;&#25968;&#32034;&#24341;&#12290;</span>
<span style="color: #b22222;">-- | TABLE ACCESS BY INDEX ROWID | SS              |</span>
<span style="color: #b22222;">-- | INDEX RANGE SCAN            | INDEX_SS_SUBSTR |</span>
</pre>
</div>
</li>

<li>位图索引
<pre class="example">
create bitmap index ind_aaa on s (sex);
create bitmap index ind_aaa on s (status);
create bitmap index ind_aaa on s (mz);
</pre>
</li>
</ol>


<p>
注意，要合理使用索引。因为，不合理的索引，不仅不能带来效率的提升，反而会拖累系统。
索引的更新同步，是比较消耗资源的。
</p>




<p>
不要只凭主观去看 SQL 语句到底有没有走索引，要学会看Oracle的 Explain Plan（解释计划)。
主要有两种方式:
</p>
<ol class="org-ol">
<li>在 sqlplus 之下，打开 autotrace 选项:
<pre class="example">
set autotrace on
</pre>
<p>
这样，每条语句执行之后就会打印出相关的执行计划情况。
其中， Table_Access_Full 表示全表扫描， xxx_by_index_rowid 表示扫描索引。
</p>
</li>

<li>手动生成解释计划，在 sqlplus 下的语法为:
<div class="org-src-container">

<pre class="src src-sql">explain plan <span style="color: #a020f0;">for</span> <span style="color: #a020f0;">select</span> CLAUSE;   <span style="color: #b22222;">-- &#36890;&#36807; explain plan for &#29983;&#25104;&#35745;&#21010;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> plan_table;         <span style="color: #b22222;">-- plan_table &#20445;&#23384;&#30340;&#26159;&#19978;&#36848;&#35299;&#37322;&#35745;&#21010;&#30340;&#32467;&#26524;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> <span style="color: #a020f0;">table</span><span style="color: #707183;">(</span>dbms_xplan.display<span style="color: #707183;">)</span>;  <span style="color: #b22222;">-- &#26159;&#23545;&#19978;&#38754;&#34920;&#37324;&#38754;&#25968;&#25454;&#30340;&#26356;&#30452;&#35266;&#26174;&#31034;</span>
</pre>
</div>
</li>
</ol>
</div>
</section>


<section id="outline-container-sec-11" class="outline-2">
<h2 id="sec-11"><span class="section-number-2">11</span> 函数 (Function)</h2>
<div class="outline-text-2" id="text-11">
<p>
语法:
</p>
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #a020f0;">CREATE</span> <span style="color: #707183;">[</span><span style="color: #a020f0;">or</span> REPLACE<span style="color: #707183;">]</span> <span style="color: #a020f0;">FUNCTION</span> function_name <span style="color: #707183;">[</span><span style="color: #7388d6;">(</span>&#21442;&#25968; &#21442;&#25968;&#31867;&#22411; := &#40664;&#35748;&#20540; <span style="color: #909183;">[</span>, &#20854;&#20182;&#21442;&#25968;<span style="color: #909183;">]</span><span style="color: #7388d6;">)</span><span style="color: #707183;">]</span> <span style="color: #a020f0;">RETURN</span> &#21442;&#25968;&#31867;&#22411;
<span style="color: #a020f0;">AS</span>|<span style="color: #a020f0;">IS</span>
  &#23450;&#20041;&#30340;&#21464;&#37327;
<span style="color: #a020f0;">BEGIN</span>
  &#36923;&#36753;
  <span style="color: #a020f0;">return</span> xxx;
<span style="color: #a020f0;">END</span>;
</pre>
</div>

<p>
示例:
</p>
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#38543;&#26426;&#25277;&#21462; 1-n &#20043;&#38388;&#30340;&#19968;&#20010;&#25972;&#25968;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">or</span> replace <span style="color: #a020f0;">function</span> <span style="color: #0000ff;">hehe</span> <span style="color: #707183;">(</span>n <span style="color: #a020f0;">number</span> := 10<span style="color: #707183;">)</span> <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">number</span>
<span style="color: #a020f0;">is</span>
  s <span style="color: #a020f0;">number</span>;
<span style="color: #a020f0;">begin</span>
  s = round<span style="color: #707183;">(</span>dbms_random.<span style="color: #a020f0;">value</span><span style="color: #7388d6;">(</span>0.5, n + 0.5<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
  <span style="color: #a020f0;">return</span> s;
<span style="color: #a020f0;">end</span> hehe;
/


<span style="color: #b22222;">-- &#20320;&#35201;&#36824;&#35201;&#22810;&#20037;&#27605;&#19994;&#65311;&#31034;&#20363;&#12290;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">or</span> replace <span style="color: #a020f0;">function</span> <span style="color: #0000ff;">howsoon</span> <span style="color: #707183;">(</span>d <span style="color: #228b22;">date</span> := to_date<span style="color: #7388d6;">(</span><span style="color: #8b2252;">'20170101'</span>, <span style="color: #8b2252;">'yyyymmdd'</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span> <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">number</span>
<span style="color: #a020f0;">is</span>
<span style="color: #a020f0;">begin</span>
  <span style="color: #a020f0;">return</span> to_number<span style="color: #707183;">(</span>d - sysdate<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">end</span>;
/


<span style="color: #b22222;">-- &#20989;&#25968;&#30340;&#21442;&#25968;&#21487;&#20197;&#24102;&#19977;&#31181;&#31867;&#22411;&#65292; in/out/in out</span>
<span style="color: #b22222;">-- &#22914;&#26524;&#21442;&#25968;&#27809;&#26377;&#27880;&#26126;in&#25110;out&#31561;&#65292;&#37027;&#20040;&#40664;&#35748;&#23601;&#26159; in &#31867;&#22411;</span>
<span style="color: #b22222;">-- in &#31867;&#22411;&#30340;&#21442;&#25968;&#65292;&#26159;&#20256;&#20837;&#20540;&#65292;&#25152;&#20197;&#65292;&#24517;&#39035;&#22312;&#20256;&#20837;&#30340;&#26102;&#20505;&#65292;&#36171;&#20104;&#19968;&#20010;&#20855;&#20307;&#30340;&#20540;&#12290;</span>
<span style="color: #b22222;">-- out &#31867;&#22411;&#30340;&#21442;&#25968;&#65292;&#26159;&#20256;&#20986;&#20540;&#65292;&#25152;&#20197;&#65292;&#22312;&#20256;&#20837;&#30340;&#26102;&#20505;&#65292;&#19981;&#24517;&#36171;&#20540;&#65292;&#20294;&#26159;&#65292;&#22312;&#20989;&#25968;&#20307;&#20869;&#65292;&#24517;&#39035;&#35201;&#32473;&#19982;&#19968;&#20010;&#20540;&#12290;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">or</span> replace <span style="color: #a020f0;">function</span> <span style="color: #0000ff;">mtimes</span> <span style="color: #707183;">(</span>a <span style="color: #a020f0;">number</span>, res <span style="color: #a020f0;">out</span> <span style="color: #a020f0;">number</span><span style="color: #707183;">)</span> <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">number</span>
<span style="color: #a020f0;">as</span>
<span style="color: #a020f0;">begin</span>
  res := a*a*a;  <span style="color: #b22222;">-- &#24517;&#39035;&#35201;&#26377;&#36825;&#26679;&#30340;&#36171;&#20540;&#25805;&#20316;&#65292;&#25165;&#33021;&#20351; res &#24471;&#21040;&#19968;&#20010;&#20540;&#65292;&#36825;&#26679;&#25165;&#26377;&#24847;&#20041;&#12290;</span>
  <span style="color: #a020f0;">return</span> a;  
<span style="color: #a020f0;">end</span>;

<span style="color: #b22222;">-- &#19978;&#36848;&#20989;&#25968;&#30340;&#35843;&#29992;&#26041;&#24335;</span>
<span style="color: #a020f0;">declare</span>
  abc <span style="color: #a020f0;">number</span>;
<span style="color: #a020f0;">begin</span>
  dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#25105;&#20204;&#20256;&#20837;&#30340;&#21442;&#25968;&#26159;:'</span> || mtimes<span style="color: #7388d6;">(</span>82, abc<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
  dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#23427;&#30340;&#30340;&#19977;&#27425;&#26041;&#26159;:'</span> || abc<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">end</span>;
</pre>
</div>
</div>
</section>


<section id="outline-container-sec-12" class="outline-2">
<h2 id="sec-12"><span class="section-number-2">12</span> PL/SQL</h2>
<div class="outline-text-2" id="text-12">
<p>
全称为 Procedure Language / Structured Query Language.
</p>

<p>
它是Oracle开发的，结合过程与结构化查询语言的一种程序语言。
所以，它充分利用了 SQL 语言的优势，又添加了过程化的功能。
在解决实际问题的过程中，非常强大、实用。
</p>
</div>

<div id="outline-container-sec-12-1" class="outline-3">
<h3 id="sec-12-1"><span class="section-number-3">12.1</span> 基本语法</h3>
<div class="outline-text-3" id="text-12-1">
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#31616;&#21333;&#26469;&#35828;&#65292;&#32467;&#26500;</span>
<span style="color: #707183;">[</span><span style="color: #a020f0;">declare</span><span style="color: #707183;">]</span>
...
<span style="color: #a020f0;">begin</span>
...
<span style="color: #707183;">[</span><span style="color: #a020f0;">exception</span><span style="color: #707183;">]</span>
...
<span style="color: #a020f0;">end</span>;

<span style="color: #b22222;">-- &#19968;&#20010;&#23436;&#25972;&#28857;&#30340;&#26647;&#23376;</span>
<span style="color: #a020f0;">DECLARE</span>
  <span style="color: #b22222;">-- &#21464;&#37327;&#23450;&#20041;&#21306;&#65292;&#22312;&#36825;&#37324;&#23450;&#20041;&#25152;&#26377;&#35201;&#20351;&#29992;&#30340;&#21464;&#37327;&#65288;&#25110;&#24120;&#37327;&#65289;</span>
  <span style="color: #b22222;">-- &#36825;&#19968;&#37096;&#20998;&#26159;&#21487;&#36873;&#30340;</span>
  id <span style="color: #a020f0;">number</span>;
  flag CONSTANT <span style="color: #a020f0;">number</span> := 1;      <span style="color: #b22222;">-- CONSTANT &#20851;&#38190;&#23383;&#23450;&#20041;&#30340;&#26159;&#24120;&#37327;&#65292;&#21518;&#38754;&#19981;&#33021;&#34987;&#20462;&#25913;</span>
  <span style="color: #a020f0;">name</span> varchar2<span style="color: #707183;">(</span>20<span style="color: #707183;">)</span> := <span style="color: #8b2252;">'hello'</span>;   <span style="color: #b22222;">-- &#21487;&#20197;&#22312;&#23450;&#20041;&#30340;&#26102;&#20505;&#65292;&#36171;&#20104;&#21021;&#22987;&#20540;</span>
  sal emp.sal%<span style="color: #a020f0;">TYPE</span>;               <span style="color: #b22222;">-- &#23450;&#20041;&#21464;&#37327;&#30340;&#31867;&#22411;&#21487;&#20197;&#29992; %TYPE/%ROWTYPE &#33719;&#21462;</span>

<span style="color: #a020f0;">BEGIN</span>
  <span style="color: #b22222;">-- &#20195;&#30721;&#21306;&#65292;&#36807;&#31243;&#22359;&#30340;&#20027;&#20307;&#12290;</span>
  <span style="color: #b22222;">-- &#37324;&#38754;&#21253;&#21547; DDL/DML &#31561; SQL &#35821;&#21477;&#65292;&#20063;&#21253;&#21547;&#19968;&#20123;&#38754;&#21521;&#36807;&#31243;&#30340;&#25511;&#21046;&#35821;&#21477;&#12290;</span>

  <span style="color: #b22222;">-- &#21028;&#26029;&#35821;&#21477;</span>
  if flag = 1 <span style="color: #a020f0;">then</span>
    <span style="color: #b22222;">-- &#36825;&#21477;&#30456;&#24403;&#20110; java &#20013;&#30340; System.out.println(string);</span>
    dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#21495;&#30721;&#65306; '</span> || flag<span style="color: #707183;">)</span>;
  <span style="color: #a020f0;">end</span> if;


  <span style="color: #b22222;">-- select into &#35821;&#21477;&#33719;&#21462;&#35760;&#24405;&#65292;&#24182;&#32473;&#21464;&#37327;&#36171;&#20540;</span>
  <span style="color: #a020f0;">select</span> <span style="color: #483d8b;">max</span><span style="color: #707183;">(</span>empno<span style="color: #707183;">)</span> <span style="color: #a020f0;">into</span> id <span style="color: #a020f0;">from</span> emp;


  <span style="color: #b22222;">-- &#24490;&#29615;&#35821;&#21477;</span>
  <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> 1..10 loop
    <span style="color: #b22222;">-- insert into returning&#65292;&#23436;&#25104;&#25554;&#20837;&#25805;&#20316;&#65292;&#24182;&#25226;&#26412;&#34892;&#30456;&#20851;&#30340;&#20449;&#24687;&#36171;&#20540;&#32473;&#21464;&#37327;</span>
    <span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> emp <span style="color: #707183;">(</span>empno, ename, sal<span style="color: #707183;">)</span> <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>id + i, dbms_random.string<span style="color: #7388d6;">(</span><span style="color: #8b2252;">'u'</span>, 5<span style="color: #7388d6;">)</span>, i*100<span style="color: #707183;">)</span>
      returning ename, sal <span style="color: #a020f0;">into</span> <span style="color: #a020f0;">name</span>, sal;

    dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#21592;&#24037;'</span> || <span style="color: #a020f0;">name</span> || <span style="color: #8b2252;">'&#30340;&#24037;&#36164;&#20026;&#65306;'</span> || sal<span style="color: #707183;">)</span>;
    <span style="color: #a020f0;">commit</span>;

  <span style="color: #a020f0;">end</span> loop;


<span style="color: #a020f0;">EXCEPTION</span>
  <span style="color: #b22222;">-- &#36825;&#37324;&#26159;&#24322;&#24120;&#22788;&#29702;&#21306;&#65292;&#22788;&#29702;&#25429;&#33719;&#21040;&#30340;&#24322;&#24120;</span>
  <span style="color: #b22222;">-- &#36825;&#37096;&#20998;&#20063;&#26159;&#21487;&#36873;&#30340;</span>
  <span style="color: #a020f0;">WHEN</span> no_data_found <span style="color: #a020f0;">THEN</span>
    dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#27809;&#26377;&#26597;&#35810;&#21040;&#20219;&#20309;&#30340;&#25968;&#25454;'</span><span style="color: #707183;">)</span>;
  <span style="color: #a020f0;">WHEN</span> others <span style="color: #a020f0;">THEN</span>
    dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#26410;&#30693;&#38169;&#35823;:'</span> || sqlerrm<span style="color: #707183;">)</span>;

<span style="color: #a020f0;">END</span>;
/



<span style="color: #b22222;">-- pl/sql &#29256;&#26412;&#30340; hello,world</span>
<span style="color: #b22222;">-- &#19968;&#20010; pl/sql &#22359;&#65292;&#33267;&#23569;&#35201;&#21253;&#21547; begin &#21644; end;</span>
<span style="color: #b22222;">-- &#38656;&#35201;&#25226; serveroutput &#36873;&#39033;&#35774;&#20026; on&#65292;&#25165;&#33021;&#30475;&#21040;&#25171;&#21360;&#30340;&#32467;&#26524;</span>
<span style="color: #a020f0;">begin</span>
  dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'hello,world'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">end</span>;


<span style="color: #b22222;">-- &#20877;&#22797;&#26434;&#19968;&#28857;&#28857;&#65292;&#22686;&#21152;&#21464;&#37327;&#65292;&#38656;&#35201;&#29992;&#21040; declare &#27573;</span>
<span style="color: #a020f0;">declare</span>
  str varchar2<span style="color: #707183;">(</span>20<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">begin</span>
  str := <span style="color: #8b2252;">'hello, world'</span>;
  dbms_output.put_line<span style="color: #707183;">(</span>str<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">end</span>;


<span style="color: #b22222;">-- &#20877;&#22797;&#26434;&#19968;&#28857;&#65292;&#22686;&#21152;&#24322;&#24120;&#22788;&#29702;&#65292;&#38656;&#35201;&#29992;&#21040; exception &#27573;</span>
<span style="color: #a020f0;">declare</span>
  n <span style="color: #a020f0;">number</span>;
<span style="color: #a020f0;">begin</span>
  n := 10/0;
<span style="color: #a020f0;">exception</span>
  <span style="color: #a020f0;">when</span> others <span style="color: #a020f0;">then</span>
    dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#26377;&#38169;&#35823;&#21457;&#29983;'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">end</span>;


<span style="color: #b22222;">-- &#20877;&#22797;&#26434;&#19968;&#28857;&#65292;&#25226;&#38169;&#35823;&#30340;&#20449;&#24687;&#20445;&#23384;&#21040;&#25351;&#23450;&#34920;&#20013;</span>
<span style="color: #a020f0;">declare</span>
  n <span style="color: #a020f0;">number</span>;
  emsg varchar2<span style="color: #707183;">(</span>20<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">begin</span>
  n := 10/0;
<span style="color: #a020f0;">exception</span>
  <span style="color: #a020f0;">when</span> others <span style="color: #a020f0;">then</span>
    dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#26377;&#38169;&#35823;&#21457;&#29983;'</span><span style="color: #707183;">)</span>;
    emsg := sqlerrm;   <span style="color: #b22222;">-- sqlerrm &#20989;&#25968;&#21487;&#20197;&#33719;&#21462;&#24322;&#24120;&#30340;&#25551;&#36848;&#20449;&#24687;</span>
    <span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> log <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>emsg<span style="color: #707183;">)</span>;
    <span style="color: #a020f0;">commit</span>;
<span style="color: #a020f0;">end</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-12-2" class="outline-3">
<h3 id="sec-12-2"><span class="section-number-3">12.2</span> 变量赋值</h3>
<div class="outline-text-3" id="text-12-2">
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#26368;&#22522;&#26412;&#30340;&#36171;&#20540;&#36816;&#31639;&#31526;&#26159;:</span>
a := 666;


<span style="color: #b22222;">-- &#22312; begin &#20043;&#21518;&#65292;&#22914;&#26524; select &#35821;&#21477;&#19981;&#24102; into &#20851;&#38190;&#35789;&#30340;&#35805;&#65292;&#20250;&#25253;&#38169;&#12290;</span>
<span style="color: #b22222;">-- &#36890;&#36807; select x into y from &#36825;&#26679;&#30340;&#21477;&#24335;&#65292;&#21487;&#20197;&#25226;&#26597;&#35810;&#21040;&#30340;&#32467;&#26524;&#36171;&#20540;&#32473;&#30456;&#24212;&#21464;&#37327;&#12290;</span>
<span style="color: #a020f0;">declare</span>
  a emp.ename%<span style="color: #a020f0;">type</span>;
<span style="color: #a020f0;">begin</span>
  <span style="color: #a020f0;">select</span> ename <span style="color: #a020f0;">into</span> a <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> rownum &lt; 2;
  dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'print result: '</span> || a<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">end</span>;
/

<span style="color: #b22222;">-- &#22914;&#26524;&#26377;&#22810;&#20010;&#21464;&#37327;&#65292;&#37027;&#20040;&#65292;&#20381;&#27425;&#29992;&#36887;&#21495;&#38548;&#24320;</span>
<span style="color: #a020f0;">declare</span>
  a emp.ename%<span style="color: #a020f0;">type</span>;
  b emp.sal%<span style="color: #a020f0;">type</span>;
<span style="color: #a020f0;">begin</span>
  <span style="color: #a020f0;">select</span> ename, sal <span style="color: #a020f0;">into</span> a, b <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> rownum &lt; 2;
  dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'print result: '</span> || a || <span style="color: #8b2252;">'  &#30340;&#24037;&#36164;&#26159;: '</span> || b || <span style="color: #8b2252;">'&#32654;&#20803;'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">end</span>;
/
<span style="color: #b22222;">-- result: SMITH  &#30340;&#24037;&#36164;&#26159;: 800&#32654;&#20803;</span>



<span style="color: #b22222;">-- &#22312;&#22686;&#21024;&#25913;&#30340;&#36807;&#31243;&#20013;&#65292;DML&#35821;&#21477;&#20043;&#21518;&#36890;&#36807;&#21152;&#20837; returning into &#35821;&#21477;&#65292;</span>
<span style="color: #b22222;">-- &#20063;&#21487;&#20197;&#23454;&#29616;&#36319; select into &#31867;&#20284;&#30340;&#21464;&#37327;&#36171;&#20540;&#12290;</span>
<span style="color: #a020f0;">declare</span>
  a <span style="color: #a020f0;">number</span>;
<span style="color: #a020f0;">begin</span>
  <span style="color: #a020f0;">update</span> emp <span style="color: #a020f0;">set</span> comm=800 <span style="color: #a020f0;">where</span> ename=<span style="color: #8b2252;">'KING'</span>
    returning sal + comm <span style="color: #a020f0;">into</span> a;
  dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'King &#29616;&#22312;&#30340;&#24037;&#36164;&#26159;:'</span> || a<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">end</span>;
/



<span style="color: #b22222;">-- &#22312;&#28216;&#26631;&#30340;&#20351;&#29992;&#20013;&#65292;&#36890;&#36807; fetch into &#36171;&#20540;</span>
<span style="color: #a020f0;">declare</span>
  <span style="color: #a020f0;">cursor</span> a <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">select</span> ename <span style="color: #a020f0;">from</span> emp;
  b varchar2<span style="color: #707183;">(</span>20<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">begin</span>
  <span style="color: #a020f0;">open</span> a;
  <span style="color: #a020f0;">fetch</span> a <span style="color: #a020f0;">into</span> b;   <span style="color: #b22222;">-- &#36890;&#36807; fetch into &#25226;&#32467;&#26524;&#36171;&#20104; a;</span>
  dbms_output.put_line<span style="color: #707183;">(</span>b<span style="color: #707183;">)</span>;
  <span style="color: #a020f0;">close</span> a;
<span style="color: #a020f0;">end</span>;
/
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-12-3" class="outline-3">
<h3 id="sec-12-3"><span class="section-number-3">12.3</span> 变量类型</h3>
<div class="outline-text-3" id="text-12-3">
</div><div id="outline-container-sec-12-3-1" class="outline-4">
<h4 id="sec-12-3-1"><span class="section-number-4">12.3.1</span> 标量类型(Scalar)</h4>
<div class="outline-text-4" id="text-12-3-1">
<p>
基本等同于 sql 中的数据类型，比如 varchar2, number, date, blob, raw 等，还包括 boolean 类型。
</p>

<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#36825;&#26159;&#26368;&#24120;&#29992;&#30340;&#25968;&#20540;&#31867;&#22411;&#30340;&#23450;&#20041;</span>
<span style="color: #a020f0;">declare</span>
  a <span style="color: #a020f0;">number</span>;
  b <span style="color: #a020f0;">number</span><span style="color: #707183;">(</span>20<span style="color: #707183;">)</span>;
  c <span style="color: #228b22;">int</span> := 222;
  d <span style="color: #228b22;">integer</span>;
  f <span style="color: #228b22;">float</span>;
<span style="color: #a020f0;">begin</span>
  d := 222;
  dbms_output.put_line<span style="color: #707183;">(</span>d<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">end</span>;
/

<span style="color: #b22222;">-- &#20854;&#20182;&#24120;&#29992;&#31867;&#22411;</span>
<span style="color: #a020f0;">declare</span>
  a varchar2<span style="color: #707183;">(</span>20<span style="color: #707183;">)</span>;
  b <span style="color: #228b22;">char</span><span style="color: #707183;">(</span>20<span style="color: #707183;">)</span>;
  c <span style="color: #228b22;">blob</span>;
  d <span style="color: #228b22;">date</span>;
<span style="color: #a020f0;">begin</span>
  a := <span style="color: #8b2252;">'hello'</span>;
  b := <span style="color: #8b2252;">' world'</span>;
  d := sysdate;

  dbms_output.put_line<span style="color: #707183;">(</span>a || b || to_char<span style="color: #7388d6;">(</span>d, <span style="color: #8b2252;">'yyyy/mm/dd'</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;

<span style="color: #a020f0;">end</span>;
/



<span style="color: #b22222;">-- &#23545;&#20110; lob &#31867;&#22411;&#65292;&#21487;&#20197;&#36890;&#36807; Oracle &#25552;&#20379;&#30340; dbms_lob &#21253;&#36827;&#34892;&#25805;&#20316;</span>
<span style="color: #b22222;">-- &#19979;&#38754;&#26159;&#19968;&#20010;&#26647;&#23376;&#65292;&#19968;&#31687;&#25991;&#31456;&#12290;</span>
<span style="color: #b22222;">-- &#19968;&#31687;&#25991;&#31456;&#21487;&#33021;&#26377;&#20197;&#19979;&#23383;&#27573;&#65306;&#20027;&#38190;&#12289;&#20316;&#32773;&#12289;&#39064;&#30446;&#12289;&#20869;&#23481;&#12289;&#21019;&#20316;&#26085;&#26399;&#12289;&#28857;&#36190;&#25968;&#31561;&#65292;&#20998;&#21035;&#20351;&#29992;&#20102;&#19981;&#21516;&#30340;&#21464;&#37327;&#31867;&#22411;&#12290;</span>
<span style="color: #b22222;">-- &#22240;&#20026;&#25991;&#31456;&#27491;&#25991;&#30340;&#20869;&#23481;&#21487;&#33021;&#24456;&#38271;&#65292;&#20250;&#36229;&#36807; varchar2 &#31867;&#22411; 4000 &#23383;&#33410;&#30340;&#38480;&#21046;&#65292;&#25152;&#20197;&#26368;&#22909;&#20351;&#29992;&#30340;&#26159; clob &#31867;&#22411;&#12290;</span>
<span style="color: #b22222;">-- &#39318;&#20808;&#21019;&#24314;&#34920;&#65292;&#22914;&#19979;:</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">article</span> 
<span style="color: #707183;">(</span>
  id <span style="color: #a020f0;">number</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span>,
  author varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>,
  title varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>, 
  content <span style="color: #228b22;">clob</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>,
  create_date <span style="color: #228b22;">timestamp</span> <span style="color: #a020f0;">default</span> sysdate,
  score <span style="color: #a020f0;">number</span>
<span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#20026;&#25554;&#20837;&#25968;&#25454;&#21019;&#24314;&#19968;&#20010;&#24207;&#21015;&#12290;&#40664;&#35748;&#20174;1&#24320;&#22987;&#65292;&#27493;&#38271;&#20026;1</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">sequence</span> <span style="color: #0000ff;">seq_article</span>;
<span style="color: #b22222;">-- &#25554;&#20837;&#19968;&#26465;&#25968;&#25454;</span>
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> article <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>seq_article.nextval, <span style="color: #8b2252;">'&#38889;&#23506;'</span>, <span style="color: #8b2252;">'&#31359;&#30528;&#26825;&#34948;&#27927;&#28577;'</span>, <span style="color: #8b2252;">'&#25105;&#20204;&#26377;&#24456;&#22810;&#26825;&#34948;&#65292;&#25105;&#20204;&#26377;&#24456;&#22810;&#26825;&#34948;&#65292;&#25105;&#20204;&#26377;&#24456;&#22810;&#26825;&#34948;&#65292;&#25105;&#20204;&#26377;&#24456;&#22810;&#26825;&#34948;&#65292;&#25105;&#20204;&#26377;&#24456;&#22810;&#26825;&#34948;&#65292;&#25105;&#20204;&#26377;&#24456;&#22810;&#26825;&#34948;&#65292;&#25105;&#20204;&#26377;&#24456;&#22810;&#26825;&#34948;&#65292;&#25105;&#20204;&#26377;&#24456;&#22810;&#26825;&#34948;&#65292;&#25105;&#20204;&#26377;&#24456;&#22810;&#26825;&#34948;&#65292;&#25105;&#20204;&#26377;&#24456;&#22810;&#26825;&#34948;&#65292;&#25105;&#20204;&#26377;&#24456;&#22810;&#26825;&#34948;&#65292;&#25105;&#20204;&#26377;&#24456;&#22810;&#26825;&#34948;&#65292;&#25105;&#20204;&#26377;&#24456;&#22810;&#26825;&#34948;&#65292;&#25105;&#20204;&#26377;&#24456;&#22810;&#26825;&#34948;'</span>, systimestamp, 0<span style="color: #707183;">)</span>;
<span style="color: #b22222;">-- &#25554;&#20837;&#19968;&#26465;&#20869;&#23481;&#20026;&#31354;&#30340;&#25991;&#31456;&#12290;&#29992; empty_clob() &#20989;&#25968;&#21021;&#22987;&#21270; clob &#23383;&#27573;</span>
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> article <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>seq_article.nextval, <span style="color: #8b2252;">'&#37101;&#25964;&#26126;'</span>, <span style="color: #8b2252;">'&#24040;&#22823;&#26102;&#20195;'</span>, empty_clob<span style="color: #7388d6;">()</span>, systimestamp, 0<span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#20889;&#19968;&#20010;&#26647;&#23376;&#65292;&#25171;&#21360;&#25991;&#31456;&#30340;&#20316;&#32773;&#12289;&#21019;&#20316;&#26085;&#26399;&#12289;&#26631;&#39064;&#12289;&#20869;&#23481;&#31616;&#20171;&#65288;&#21069;20&#20010;&#23383;&#65289;&#12290;</span>
<span style="color: #a020f0;">declare</span>
  amount <span style="color: #a020f0;">number</span> <span style="color: #a020f0;">default</span> 20;
  v_author varchar2<span style="color: #707183;">(</span>20<span style="color: #707183;">)</span>;
  v_date varchar2<span style="color: #707183;">(</span>40<span style="color: #707183;">)</span>;
  v_title varchar2<span style="color: #707183;">(</span>40<span style="color: #707183;">)</span>;
  v_content <span style="color: #228b22;">clob</span>;
  v_desc varchar2<span style="color: #707183;">(</span>400<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">begin</span>
  <span style="color: #b22222;">-- &#26597;&#35810;&#65292;&#36171;&#20540;</span>
  <span style="color: #a020f0;">select</span> author, to_char<span style="color: #707183;">(</span>create_date, <span style="color: #8b2252;">'yyyy.mm.dd hh:mi:ss'</span><span style="color: #707183;">)</span>, title, content <span style="color: #a020f0;">into</span> v_author, v_date, v_title, v_content <span style="color: #a020f0;">from</span> article <span style="color: #a020f0;">where</span> rownum &lt; 2;
  <span style="color: #b22222;">-- &#33719;&#21462;&#21069;20&#20010;&#23383;&#31526;&#30340;&#35821;&#27861;&#12290;&#20989;&#25968; read &#30340;&#21442;&#25968;&#20998;&#21035;&#20026; blob&#23383;&#27573;&#12289;&#35201;&#35835;&#21462;&#30340;&#38271;&#24230;&#12289;&#24320;&#22987;&#30340;&#20301;&#32622;&#12289;&#35835;&#21462;&#30340;&#32467;&#26524;&#12290;</span>
  dbms_lob.<span style="color: #a020f0;">read</span><span style="color: #707183;">(</span>v_content, amount, 1, v_desc<span style="color: #707183;">)</span>;
  dbms_output.put_line<span style="color: #707183;">(</span>v_author || <span style="color: #8b2252;">'('</span> || v_date || <span style="color: #8b2252;">')'</span><span style="color: #707183;">)</span>;
  dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#26631;&#39064;&#65306;'</span> || v_title<span style="color: #707183;">)</span>;
  dbms_output.put_line<span style="color: #707183;">(</span>v_desc || <span style="color: #8b2252;">'...'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">end</span>;
/
<span style="color: #b22222;">-- &#32467;&#26524;&#26174;&#31034;&#65306;</span>
<span style="color: #b22222;">-- &#38889;&#23506;(2016.09.29 05:00:56)</span>
<span style="color: #b22222;">-- &#26631;&#39064;&#65306;&#31359;&#30528;&#26825;&#34948;&#27927;&#28577;</span>
<span style="color: #b22222;">-- &#25105;&#20204;&#26377;&#24456;&#22810;&#26825;&#34948;&#65292;&#25105;&#20204;&#26377;&#24456;&#22810;&#26825;&#34948;&#65292;&#25105;&#20204;&#26377;&#24456;...</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-12-3-2" class="outline-4">
<h4 id="sec-12-3-2"><span class="section-number-4">12.3.2</span> TYPE/ROWTYPE</h4>
<div class="outline-text-4" id="text-12-3-2">
<p>
这是用来引用数据库中表的某一行，或某个字段的类型。
</p>

<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- %type &#26159;&#29992;&#26469;&#24555;&#36895;&#33719;&#21462;&#34920;&#20013;&#26576;&#20010;&#23383;&#27573;&#20855;&#20307;&#31867;&#22411;&#30340;&#19968;&#31181;&#26041;&#24335;&#12290;</span>
<span style="color: #b22222;">-- &#36890;&#36807;&#21033;&#29992;&#36825;&#31181;&#26041;&#24335;&#65292;&#21487;&#20197;&#31616;&#21270;&#25105;&#20204;&#30340;&#23450;&#20041;&#12290;</span>
<span style="color: #a020f0;">declare</span>
  a emp.ename%<span style="color: #a020f0;">type</span>;   <span style="color: #b22222;">-- &#30456;&#24403;&#20110; a varchar2(xx)</span>
  b emp.sal%<span style="color: #a020f0;">type</span>;     <span style="color: #b22222;">-- &#30456;&#24403;&#20110; b number(7,2)</span>
<span style="color: #a020f0;">begin</span>
  <span style="color: #a020f0;">select</span> ename, sal <span style="color: #a020f0;">into</span> a, b <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> rownum &lt; 2;
  dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#21592;&#24037;&#30340;&#21517;&#23383;&#26159;:'</span> || a || <span style="color: #8b2252;">', &#20182;&#30340;&#24037;&#36164;&#26159;: '</span> || b || <span style="color: #8b2252;">' &#32654;&#20803;'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">end</span>;

<span style="color: #b22222;">-- %rowtype &#26159;&#19968;&#31181;&#33719;&#21462;&#34892;&#35760;&#24405;&#30340;&#26041;&#24335;&#65292;&#23427;&#21253;&#21547;&#20102;&#19968;&#34892;&#35760;&#24405;&#25152;&#26377;&#30340;&#23383;&#27573;&#12290;</span>
<span style="color: #b22222;">-- &#25152;&#20197;&#65292;&#25105;&#20204;&#21487;&#20197;&#29992;js&#20013;&#25968;&#32452;&#30340;&#35282;&#24230;&#21435;&#27604;&#36739;&#20043;&#12290;</span>
<span style="color: #a020f0;">declare</span>
  v_emp emp%rowtype;
<span style="color: #a020f0;">begin</span>
  <span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">into</span> v_emp <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> rownum &lt; 2;
  dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#32467;&#26524;&#26159;&#65306;'</span> || v_emp.ename || <span style="color: #8b2252;">'&#30340;&#24037;&#36164;&#26159;'</span> || v_emp.sal || <span style="color: #8b2252;">'&#33521;&#38225; , &#37096;&#38376;&#32534;&#21495;&#26159;: '</span> || v_emp.deptno2<span style="color: #707183;">)</span>;

<span style="color: #a020f0;">end</span>;
/
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-12-3-3" class="outline-4">
<h4 id="sec-12-3-3"><span class="section-number-4">12.3.3</span> 自定义记录/数组类型</h4>
<div class="outline-text-4" id="text-12-3-3">
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#21487;&#20197;&#22312;&#22522;&#26412;&#31867;&#22411;&#30340;&#22522;&#30784;&#19978;&#65292;&#26500;&#36896;&#20986;&#35768;&#22810;&#30340;&#22797;&#26434;&#30340;&#31867;&#22411;&#65292;&#27604;&#22914;&#25968;&#32452;&#12290;</span>
<span style="color: #b22222;">-- record &#31867;&#22411;&#65292;&#20351;&#29992; name &#26469;&#33719;&#21462;&#37324;&#38754;&#30340;&#20540;&#12290;</span>
<span style="color: #b22222;">-- Oracle &#20013;&#65292;&#23450;&#20041;&#26032;&#31867;&#22411;&#30340;&#35821;&#21477;&#20026; type&#12290;&#27604;&#22914;&#65292;&#23450;&#20041;&#19968;&#20010; record &#25968;&#32452;&#65292;&#35821;&#21477;&#22914;&#19979;&#65306;</span>
<span style="color: #a020f0;">TYPE</span> type_name <span style="color: #a020f0;">IS</span> RECORD <span style="color: #707183;">(</span>&#31532;&#19968;&#20010;&#20803;&#32032;&#30340;&#21517;&#23383; &#31532;&#19968;&#20010;&#20803;&#32032;&#30340;&#22522;&#26412;&#31867;&#22411;, &#31532;&#20108;&#20010;..., &#31532;&#19977;&#20010;<span style="color: #707183;">)</span>;
<span style="color: #b22222;">-- &#31867;&#22411;&#23450;&#20041;&#23436;&#27605;&#20043;&#21518;&#65292;&#23601;&#21487;&#20197;&#20687;&#26222;&#36890;&#30340;&#31867;&#22411;&#37027;&#26679;&#21435;&#20351;&#29992;&#20102;&#12290;&#22914;&#26524;&#65292;&#25105;&#20204;&#21487;&#20197;&#36825;&#26679;&#21019;&#24314;&#19968;&#20010;&#19978;&#36848;&#31867;&#22411;&#30340;&#21464;&#37327;</span>
v_name type_name;

<span style="color: #b22222;">-- &#19979;&#38754;&#26159;&#19968;&#20010;&#20855;&#20307;&#28857;&#30340;&#20363;&#23376;</span>
<span style="color: #a020f0;">declare</span>
  <span style="color: #a020f0;">type</span> t_emp <span style="color: #a020f0;">is</span> record <span style="color: #707183;">(</span>ename varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>, sal <span style="color: #a020f0;">number</span><span style="color: #707183;">)</span>;
  v_emp t_emp;     <span style="color: #b22222;">-- &#23450;&#20041;&#19968;&#20010; t_emp &#31867;&#22411;&#30340;&#21464;&#37327;&#12290;&#23450;&#20041;&#23436;&#21464;&#37327;&#20043;&#21518;&#65292;&#25105;&#20204;&#25165;&#21487;&#20197;&#20351;&#29992;&#12290;</span>
  v_emp2 t_emp;    <span style="color: #b22222;">-- &#36825;&#26159;&#23450;&#20041;&#30340;&#31532;&#20108;&#20010; t_emp &#31867;&#22411;&#30340;&#21464;&#37327;.</span>
<span style="color: #a020f0;">begin</span>
  <span style="color: #a020f0;">select</span> ename, sal <span style="color: #a020f0;">into</span> v_emp <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> rownum &lt; 2;
  dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#32467;&#26524;&#26159;&#65306;'</span> || v_emp.ename || <span style="color: #8b2252;">'&#30340;&#24037;&#36164;&#26159;'</span> || v_emp.sal || <span style="color: #8b2252;">'&#33521;&#38225; '</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">end</span>;
/

<span style="color: #b22222;">-- &#26597;&#35810; KING &#30340;&#24037;&#36164;&#21644;&#37096;&#38376;&#12290;&#21033;&#29992;&#20102; record &#31867;&#22411;&#12290;</span>
<span style="color: #a020f0;">declare</span>
  <span style="color: #a020f0;">type</span> t_emp <span style="color: #a020f0;">is</span> record <span style="color: #707183;">(</span>ename varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span>, sal <span style="color: #a020f0;">number</span>,dname varchar2<span style="color: #7388d6;">(</span>20<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
  v_emp t_emp;
<span style="color: #a020f0;">begin</span>
  <span style="color: #a020f0;">select</span> ename, sal ,dname <span style="color: #a020f0;">into</span> v_emp <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">join</span> scott.dept <span style="color: #a020f0;">on</span> emp.deptno=scott.dept.deptno <span style="color: #a020f0;">where</span> sal&gt;1000;
  dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#32467;&#26524;&#26159;&#65306;'</span> || v_emp.ename || <span style="color: #8b2252;">'&#30340;&#24037;&#36164;&#26159;'</span> || v_emp.sal || <span style="color: #8b2252;">'&#33521;&#38225; '</span>||<span style="color: #8b2252;">'&#37096;&#38376;&#26159;'</span>||v_emp.dname<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">end</span>;



<span style="color: #b22222;">-- &#25968;&#32452;&#31867;&#22411;&#65292;&#29992;&#24207;&#21495;&#26469;&#33719;&#21462;&#37324;&#38754;&#30340;&#20540;&#12290;</span>
<span style="color: #b22222;">-- varray &#20851;&#38190;&#23383;&#65292;&#38656;&#35201;&#25351;&#26126;&#38271;&#24230;&#65292;&#25351;&#26126;&#31867;&#22411;</span>
<span style="color: #b22222;">-- type &#38500;&#20102; record &#21644; varray &#22806;&#65292;&#36824;&#26377;&#24456;&#22810;&#20854;&#20182;&#31867;&#22411;&#65292;&#27604;&#22914; table,object &#31561;&#12290;&#26377;&#20852;&#36259;&#30340;&#21516;&#23398;&#33258;&#24049;&#25214;&#36164;&#26009;&#12290;</span>
<span style="color: #a020f0;">declare</span>
  <span style="color: #a020f0;">type</span> t_numarr <span style="color: #a020f0;">is</span> varray<span style="color: #707183;">(</span>4<span style="color: #707183;">)</span> <span style="color: #a020f0;">of</span> <span style="color: #a020f0;">number</span>;
  a t_numarr;
<span style="color: #a020f0;">begin</span>
  a := t_numarr<span style="color: #707183;">(</span>1, 22, 333, 4444<span style="color: #707183;">)</span>;
  dbms_output.put_line<span style="color: #707183;">(</span>a<span style="color: #7388d6;">(</span>1<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
  dbms_output.put_line<span style="color: #707183;">(</span>a<span style="color: #7388d6;">(</span>2<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
  dbms_output.put_line<span style="color: #707183;">(</span>a<span style="color: #7388d6;">(</span>3<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
  dbms_output.put_line<span style="color: #707183;">(</span>a<span style="color: #7388d6;">(</span>4<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">end</span>;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-12-4" class="outline-3">
<h3 id="sec-12-4"><span class="section-number-3">12.4</span> 操作符</h3>
<div class="outline-text-3" id="text-12-4">
<p>
详情看 p227
</p>
</div>
</div>
<div id="outline-container-sec-12-5" class="outline-3">
<h3 id="sec-12-5"><span class="section-number-3">12.5</span> 流程控制</h3>
<div class="outline-text-3" id="text-12-5">
</div><div id="outline-container-sec-12-5-1" class="outline-4">
<h4 id="sec-12-5-1"><span class="section-number-4">12.5.1</span> 分支判断</h4>
<div class="outline-text-4" id="text-12-5-1">
<p>
IF 语句
</p>
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#26368;&#31616;&#35821;&#27861;&#20026;</span>
IF &#26465;&#20214; <span style="color: #a020f0;">THEN</span>
  &#35201;&#25191;&#34892;&#30340;&#20195;&#30721;;
<span style="color: #a020f0;">END</span> IF;

<span style="color: #b22222;">-- &#22797;&#26434;&#19968;&#28857;&#65292;&#38656;&#35201;&#29992; elsif &#21644; else &#28155;&#21152;&#26356;&#22810;&#30340;&#20998;&#25903;</span>
IF &#26465;&#20214; <span style="color: #a020f0;">THEN</span>
  &#35201;&#25191;&#34892;&#30340;&#20195;&#30721;;
ELSIF &#21478;&#22806;&#30340;&#26465;&#20214; <span style="color: #a020f0;">THEN</span>
  &#35201;&#25191;&#34892;&#30340;&#20195;&#30721;;
<span style="color: #a020f0;">ELSE</span>
  &#35201;&#25191;&#34892;&#30340;&#20195;&#30721;;
<span style="color: #a020f0;">END</span> IF;



<span style="color: #b22222;">-- &#20363;&#23376;1&#65292;&#36825;&#26159;&#19968;&#20010;&#31245;&#24494;&#35814;&#23613;&#30340;&#20363;&#23376;</span>
<span style="color: #a020f0;">declare</span>
  a <span style="color: #a020f0;">number</span>;
<span style="color: #a020f0;">begin</span>
  a := dbms_random.<span style="color: #a020f0;">value</span><span style="color: #707183;">(</span>0, 4<span style="color: #707183;">)</span>;
  dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#20320;&#36755;&#20837;&#30340;&#26159;:'</span> || a<span style="color: #707183;">)</span>;
  if <span style="color: #707183;">(</span>a &lt; 1<span style="color: #707183;">)</span> <span style="color: #a020f0;">then</span>
    dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#20320;&#36755;&#20837;&#30340;&#25968;&#23383;&#22826;&#23567;&#20102;'</span><span style="color: #707183;">)</span>;
  elsif a &lt; 2 <span style="color: #a020f0;">then</span>
    dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#35830;&#21568;&#65292;&#21018;&#21018;&#22909;&#21834;'</span><span style="color: #707183;">)</span>;
  <span style="color: #a020f0;">else</span>
    dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#24744;&#36755;&#20837;&#30340;&#22826;&#22823;&#20102;'</span><span style="color: #707183;">)</span>;
  <span style="color: #a020f0;">end</span> if;
<span style="color: #a020f0;">end</span>;
/


<span style="color: #b22222;">-- if &#30340;&#20351;&#29992;&#65292;&#20363;&#23376;2</span>
<span style="color: #a020f0;">declare</span>
  a <span style="color: #a020f0;">number</span>;
<span style="color: #a020f0;">begin</span>
  a := round<span style="color: #707183;">(</span>dbms_random.<span style="color: #a020f0;">value</span><span style="color: #7388d6;">(</span>0.5,3.5<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;  <span style="color: #b22222;">-- &#21462;&#19968;&#20010;&#38543;&#26426;&#25968;&#65292;&#21487;&#33021;&#30340;&#20540;&#26159; 1/2/3</span>
  if a = 1 <span style="color: #a020f0;">then</span>
    dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#20320;&#26159;&#30007;&#29983;&#65292;&#24212;&#35813;&#22810;&#24178;&#27963;'</span><span style="color: #707183;">)</span>;
  elsif a = 2 <span style="color: #a020f0;">then</span>
    dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#20320;&#26159;&#22899;&#29983;&#65292;&#24212;&#35813;&#22810;&#20445;&#20859;'</span><span style="color: #707183;">)</span>;
  <span style="color: #a020f0;">else</span>
    dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#20320;&#20808;&#21435;&#39564;&#19968;&#19979;&#24615;&#21035;&#21543;'</span><span style="color: #707183;">)</span>;
  <span style="color: #a020f0;">end</span> if;

<span style="color: #a020f0;">end</span>;
/
</pre>
</div>

<p>
Case 语句
</p>
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #a020f0;">CASE</span> <span style="color: #707183;">[</span>&#23383;&#27573;<span style="color: #707183;">]</span>
  <span style="color: #a020f0;">WHEN</span> &#26465;&#20214; <span style="color: #a020f0;">THEN</span> &#35201;&#25191;&#34892;&#30340;&#20195;&#30721;
  <span style="color: #707183;">[</span><span style="color: #a020f0;">WHEN</span> &#26465;&#20214; <span style="color: #a020f0;">THEN</span> &#35201;&#25191;&#34892;&#30340;&#20195;&#30721;<span style="color: #707183;">]</span>
  <span style="color: #707183;">[</span><span style="color: #a020f0;">ELSE</span> &#35201;&#25191;&#34892;&#30340;&#20195;&#30721;<span style="color: #707183;">]</span>
<span style="color: #a020f0;">END</span> <span style="color: #a020f0;">CASE</span>;


<span style="color: #b22222;">-- &#25226;&#19978;&#38754; if/else &#30340;&#20363;&#23376;1&#32763;&#35793;&#36807;&#26469;&#23601;&#26159;&#65306;</span>
<span style="color: #a020f0;">declare</span>
  a <span style="color: #a020f0;">number</span>;
<span style="color: #a020f0;">begin</span>
  a := dbms_random.<span style="color: #a020f0;">value</span><span style="color: #707183;">(</span>0, 4<span style="color: #707183;">)</span>;
  dbms_output.put_line<span style="color: #707183;">(</span>a<span style="color: #707183;">)</span>;
  <span style="color: #a020f0;">case</span>
    <span style="color: #a020f0;">when</span> a &lt; 1 <span style="color: #a020f0;">then</span>
      dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#20320;&#36755;&#20837;&#30340;&#25968;&#23383;&#22826;&#23567;&#20102;'</span><span style="color: #707183;">)</span>;
    <span style="color: #a020f0;">when</span> a &lt; 2 <span style="color: #a020f0;">then</span>
      dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#35830;&#21568;&#65292;&#21018;&#21018;&#22909;&#21834;'</span><span style="color: #707183;">)</span>;
    <span style="color: #a020f0;">else</span> 
      dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#24744;&#36755;&#20837;&#30340;&#22826;&#22823;&#20102;'</span><span style="color: #707183;">)</span>;
  <span style="color: #a020f0;">end</span> <span style="color: #a020f0;">case</span>;
<span style="color: #a020f0;">end</span>;
/

<span style="color: #b22222;">-- &#25226;&#19978;&#38754; if &#37324;&#38754;&#20363;&#23376;2&#32763;&#35793;&#36807;&#26469;&#26159;&#65306;</span>
<span style="color: #a020f0;">declare</span>
  a <span style="color: #a020f0;">number</span>;
<span style="color: #a020f0;">begin</span>
  a := round<span style="color: #707183;">(</span>dbms_random.<span style="color: #a020f0;">value</span><span style="color: #7388d6;">(</span>0.5,3.5<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
  <span style="color: #a020f0;">case</span> a
    <span style="color: #a020f0;">when</span> 1 <span style="color: #a020f0;">then</span>
      dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#20320;&#26159;&#30007;&#29983;&#65292;&#24212;&#35813;&#22810;&#24178;&#27963;'</span><span style="color: #707183;">)</span>;
    <span style="color: #a020f0;">when</span> 2 <span style="color: #a020f0;">then</span>
      dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#20320;&#26159;&#22899;&#29983;&#65292;&#24212;&#35813;&#22810;&#20445;&#20859;'</span><span style="color: #707183;">)</span>;
    <span style="color: #a020f0;">else</span>
      dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#20320;&#20808;&#21435;&#39564;&#19968;&#19979;&#24615;&#21035;&#21543;'</span><span style="color: #707183;">)</span>;
  <span style="color: #a020f0;">end</span> <span style="color: #a020f0;">case</span>;
<span style="color: #a020f0;">end</span>;
/
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-12-5-2" class="outline-4">
<h4 id="sec-12-5-2"><span class="section-number-4">12.5.2</span> 循环迭代</h4>
<div class="outline-text-4" id="text-12-5-2">
<p>
loop
</p>
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#26368;&#31616;&#21333;&#30340;&#35821;&#27861;</span>
LOOP
  &#24490;&#29615;&#30340;&#20195;&#30721;;
  <span style="color: #b22222;">-- &#27880;&#24847;&#65292;&#22312;&#36825;&#26679;&#30340; loop &#35821;&#21477;&#20013;&#65292;&#35201;&#28155;&#21152;&#21512;&#36866;&#30340;&#20013;&#27490;&#35821;&#21477;&#12290;</span>
<span style="color: #a020f0;">END</span> LOOP;


<span style="color: #b22222;">-- &#36825;&#26159; loop &#30340;&#22522;&#26412;&#29992;&#27861;</span>
<span style="color: #a020f0;">declare</span>
  a <span style="color: #a020f0;">number</span> := 10;
<span style="color: #a020f0;">begin</span>
  loop
    a := a - 1;
    dbms_output.put_line<span style="color: #707183;">(</span>systimestamp<span style="color: #707183;">)</span>;
    if a &lt; 1 <span style="color: #a020f0;">then</span>  <span style="color: #b22222;">-- &#38656;&#35201;&#26681;&#25454;&#26465;&#20214;&#21028;&#26029;&#65292;&#20889;&#30456;&#24212;&#30340;&#36864;&#20986;&#35821;&#21477;</span>
      exit;
    <span style="color: #a020f0;">end</span> if;
  <span style="color: #a020f0;">end</span> loop;
<span style="color: #a020f0;">end</span>;
/

<span style="color: #b22222;">-- &#36864;&#20986;&#35821;&#21477;&#21487;&#20197;&#22914;&#19979;&#31616;&#20889;&#65292;&#21363; exit when &#26465;&#20214;</span>
<span style="color: #a020f0;">declare</span>
  a <span style="color: #a020f0;">number</span> := 10;
<span style="color: #a020f0;">begin</span>
  loop
    a := a - 1;
    dbms_output.put_line<span style="color: #707183;">(</span>systimestamp<span style="color: #707183;">)</span>;
    exit <span style="color: #a020f0;">when</span> a &lt; 1;
  <span style="color: #a020f0;">end</span> loop;
<span style="color: #a020f0;">end</span>;
/
</pre>
</div>


<p>
for
</p>
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#35821;&#27861;</span>
<span style="color: #a020f0;">FOR</span> &#21464;&#37327; <span style="color: #a020f0;">IN</span> &#26368;&#23567;&#20540;..&#26368;&#22823;&#20540; LOOP
  &#25191;&#34892;&#30340;&#35821;&#21477;;
<span style="color: #a020f0;">END</span> LOOP;

<span style="color: #b22222;">-- &#19979;&#38754;&#26159; loop &#30340;&#36827;&#38454;&#29992;&#27861;&#65292;&#35201;&#36319; for &#32467;&#21512;&#20351;&#29992;</span>
<span style="color: #b22222;">-- &#36825;&#31181;&#26041;&#24335;&#24456;&#23454;&#29992;</span>
<span style="color: #a020f0;">begin</span>
  <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> 1..10 loop
    dbms_output.put_line<span style="color: #707183;">(</span>systimestamp<span style="color: #707183;">)</span>;
  <span style="color: #a020f0;">end</span> loop;
<span style="color: #a020f0;">end</span>;
</pre>
</div>



<p>
while
</p>
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#35821;&#27861;</span>
WHILE &#26465;&#20214; LOOP
  &#25191;&#34892;&#30340;&#35821;&#21477;;
<span style="color: #a020f0;">END</span> LOOP;



<span style="color: #b22222;">-- &#20030;&#20363;</span>
<span style="color: #a020f0;">declare</span>
  a <span style="color: #a020f0;">number</span> := 10;
<span style="color: #a020f0;">begin</span>
  while a &gt; 0 loop
    dbms_output.put_line<span style="color: #707183;">(</span>systimestamp<span style="color: #707183;">)</span>;
    a := a - 1;
  <span style="color: #a020f0;">end</span> loop;
<span style="color: #a020f0;">end</span>;
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-12-6" class="outline-3">
<h3 id="sec-12-6"><span class="section-number-3">12.6</span> 异常处理</h3>
<div class="outline-text-3" id="text-12-6">
<p>
作为一个优秀的程序员，肯定要能写出健壮的代码，而健壮代码的首要考虑，就是处理好异常。
</p>

<p>
Oracle 运行过程中出现的错误，称之为 Oracle 异常。主要分为两种，一种是系统预定义异常(即内部异常)，一种是用户自定义异常。
</p>

<p>
异常要有一个名字，一个编号(sqlcode)，一个描述(sqlerrm)。
</p>

<p>
异常的基本捕获语句为：
</p>
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #a020f0;">declare</span>
  &#21464;&#37327;&#23450;&#20041;;
<span style="color: #a020f0;">begin</span>
  &#20195;&#30721;&#36816;&#34892;;
<span style="color: #a020f0;">exception</span>
  <span style="color: #a020f0;">when</span> &#24322;&#24120;&#21517;&#31216;&#25110;&#32773;others <span style="color: #a020f0;">then</span>
    &#20986;&#29616;&#24322;&#24120;&#21518;&#30340;&#22788;&#29702;&#20195;&#30721;;
<span style="color: #a020f0;">end</span>;
</pre>
</div>
</div>

<div id="outline-container-sec-12-6-1" class="outline-4">
<h4 id="sec-12-6-1"><span class="section-number-4">12.6.1</span> 系统自定义的异常(Predefined)</h4>
<div class="outline-text-4" id="text-12-6-1">
<p>
这种异常无需定义，当出现的时候会自动抛出，我们只需要在 exception 中做好相应的捕获处理就可以了。
可以使用 sqlcode 和 sqlerrm 分别返回异常的代码编号，以及异常的描述信息。
</p>

<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#26647;&#23376;&#20013;&#26377;&#20004;&#31181;&#24322;&#24120;&#65292;&#19968;&#31181;&#26159;&#23383;&#27597;&#20026;&#38646;&#30340;&#24322;&#24120;(ZERO_DIVIDE)&#65292;&#21478;&#19968;&#31181;&#65292;&#26159;&#27809;&#26377;&#26597;&#35810;&#21040;&#25968;&#25454;&#30340;&#24322;&#24120;(NO_DATA_FOUND)&#12290;</span>
<span style="color: #b22222;">-- &#36825;&#20004;&#31181;&#37117;&#26159; Oracle &#24050;&#32463;&#33258;&#23450;&#20041;&#22909;&#30340;&#24322;&#24120;&#65292;&#25105;&#20204;&#21487;&#20197;&#30452;&#25509;&#20351;&#29992;&#12290;</span>
<span style="color: #a020f0;">declare</span>
  a varchar2<span style="color: #707183;">(</span>20<span style="color: #707183;">)</span>;
  b <span style="color: #a020f0;">number</span>;
<span style="color: #a020f0;">begin</span>
  b := 10000 / round<span style="color: #707183;">(</span>dbms_random.<span style="color: #a020f0;">value</span><span style="color: #7388d6;">(</span>-0.1, 1.1<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;       <span style="color: #b22222;">-- &#38543;&#26426;&#25968;&#65292;0&#25110;&#32773;1&#65292;&#22914;&#26524;&#38543;&#26426;&#21040;0&#65292;&#21017;&#20250;&#25243;&#20986;&#30456;&#24212;&#24322;&#24120;&#12290;</span>
  <span style="color: #a020f0;">select</span> ename <span style="color: #a020f0;">into</span> a <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> empno = 2222222222;  <span style="color: #b22222;">-- &#22914;&#26524;&#26597;&#35810;&#19981;&#21040;&#35760;&#24405;&#65292;&#21017;&#20250;&#25243;&#20986;&#26080;&#25968;&#25454;&#35760;&#24405;&#24322;&#24120;&#12290;</span>
  dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'ok&#65292;&#24744;&#26597;&#35810;&#25104;&#21151;&#20102;'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">exception</span>
  <span style="color: #a020f0;">when</span> NO_DATA_FOUND <span style="color: #a020f0;">then</span>
    dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'hehe, &#27809;&#25968;&#25454;&#65292;&#20146;'</span><span style="color: #707183;">)</span>;
  <span style="color: #a020f0;">when</span> ZERO_DIVIDE <span style="color: #a020f0;">then</span>
    dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#23383;&#27597;&#19981;&#33021;&#20026;&#38646;&#21734;&#65292;&#20146;'</span><span style="color: #707183;">)</span>;
  <span style="color: #a020f0;">when</span> OTHERS <span style="color: #a020f0;">then</span>
    dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'hehe,you are great'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">end</span>;
/
</pre>
</div>


<p>
有的内部异常，只有编号跟描述，没有具体名字，那么，我们需要用 PRAGMA EXCEPTION_INIT 来给异常起一个名字。
</p>
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #a020f0;">declare</span>
  nested_delete <span style="color: #a020f0;">exception</span>;   <span style="color: #b22222;">-- &#20808;&#33258;&#23450;&#20041;&#24322;&#24120;&#65292;&#21517;&#23383;&#20026; nested_delete</span>
  PRAGMA EXCEPTION_INIT<span style="color: #707183;">(</span>nested_delete, -2292<span style="color: #707183;">)</span>;  <span style="color: #b22222;">-- &#22240;&#20026;&#8220;&#35760;&#24405;&#23384;&#22312;&#22806;&#38190;&#32422;&#26463;&#8221;&#36825;&#20010;&#31995;&#32479;&#24322;&#24120;&#21482;&#26377;&#32534;&#21495;&#65292;&#20026; -2292&#65292;&#27809;&#26377;&#21517;&#23383;&#12290;&#25105;&#20204;&#36890;&#36807;&#36825;&#20010;&#35821;&#21477;&#32473;&#36825;&#20010;&#24322;&#24120;&#36171;&#20104;&#21517;&#23383; nested_delete&#12290;</span>
<span style="color: #a020f0;">begin</span>
  <span style="color: #a020f0;">delete</span> <span style="color: #a020f0;">from</span> dept <span style="color: #a020f0;">where</span> deptno = 10;           <span style="color: #b22222;">-- &#36825;&#26465;&#35760;&#24405;&#23384;&#22312;&#22806;&#38190;&#32422;&#26463;&#65292;&#25152;&#20197;&#21024;&#38500;&#22833;&#36133;&#65292;&#25243;&#20986;&#24322;&#24120; -2292&#12290;&#22240;&#20026;&#19978;&#38754;&#23450;&#20041;&#20102; -2292 &#20026; nested_delete&#65292;&#25152;&#20197;&#36825;&#20010;&#24322;&#24120;&#21487;&#20197;&#29992; nested_delete &#26469;&#25429;&#33719;&#12290;</span>
<span style="color: #a020f0;">exception</span>
  <span style="color: #a020f0;">when</span> nested_delete <span style="color: #a020f0;">then</span>
    dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#38169;&#35823;&#20195;&#30721;: '</span> || sqlcode<span style="color: #707183;">)</span>;
    dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#38169;&#35823;&#20449;&#24687;: '</span> || sqlerrm<span style="color: #707183;">)</span>;
    dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'deptno &#34987;&#22806;&#38190;&#24341;&#29992;&#65292;&#25152;&#20197;&#21024;&#38500;&#22833;&#36133;'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">end</span>;
/
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-12-6-2" class="outline-4">
<h4 id="sec-12-6-2"><span class="section-number-4">12.6.2</span> 用户自定义的异常(UserDefined)</h4>
<div class="outline-text-4" id="text-12-6-2">
<p>
手动抛出一个异常的语句如下，跟 java 中的 throw 语句类似。
</p>
<pre class="example">
raise exception
</pre>
<p>
如果想抛出一个带详细信息的异常，可以用到 Oracle 提供给我们的存储过程 raise_application_error 来简化操作。
</p>

<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#33258;&#23450;&#20041;&#19968;&#20010;&#24322;&#24120;&#65292;&#38656;&#35201;&#22312; declare &#37324;&#38754;&#22768;&#26126;&#19968;&#20010; exception &#31867;&#22411;&#30340;&#21464;&#37327;</span>
<span style="color: #b22222;">-- &#22914;&#26524;&#24819;&#25163;&#21160;&#25243;&#20986;&#24322;&#24120;&#30340;&#35805;&#65292;&#38656;&#35201;&#29992;&#21040; &#12304;raise &#24322;&#24120;&#21517;&#23383;&#12305; &#36825;&#26679;&#30340;&#35821;&#27861;</span>
<span style="color: #a020f0;">declare</span>
   a <span style="color: #a020f0;">number</span>;
   womendajiadeyichang <span style="color: #a020f0;">exception</span>;  
<span style="color: #a020f0;">begin</span>
   a := dbms_random.<span style="color: #a020f0;">value</span><span style="color: #707183;">(</span>0, 4<span style="color: #707183;">)</span>;
   if a &gt; 2 <span style="color: #a020f0;">then</span>
     dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'hehe, it is very great.'</span><span style="color: #707183;">)</span>;
   <span style="color: #a020f0;">else</span>
     raise womendajiadeyichang;
   <span style="color: #a020f0;">end</span> if;
<span style="color: #a020f0;">exception</span>
   <span style="color: #a020f0;">when</span> womendajiadeyichang <span style="color: #a020f0;">then</span>
     dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#25105;&#20204;&#22823;&#23478;&#30340;&#24322;&#24120;&#65292;&#25105;&#20204;&#22823;&#23478;&#30340;&#26041;&#26696;'</span><span style="color: #707183;">)</span>;
   <span style="color: #a020f0;">when</span> others <span style="color: #a020f0;">then</span>
     dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#25105;&#20063;&#19981;&#30693;&#36947;&#35813;&#24590;&#20040;&#21150;'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">end</span>;
/


<span style="color: #b22222;">-- &#21487;&#20197;&#36890;&#36807;&#19978;&#38754;&#30340; PRAGMA &#35821;&#21477;&#36171;&#20104;&#32534;&#21495;&#31561;</span>
<span style="color: #b22222;">-- &#36825;&#20010;&#20195;&#30721;&#32534;&#21495;&#24212;&#35813;&#22312; -20000 &#21040; -20999 &#20043;&#20869;&#65292;&#36825;&#26159; Oracle &#39044;&#30041;&#32473;&#25105;&#20204;&#29992;&#25143;&#20351;&#29992;&#30340;&#32534;&#21495;</span>
<span style="color: #a020f0;">declare</span>
   a <span style="color: #a020f0;">number</span>;
   womendajiadeyichang <span style="color: #a020f0;">exception</span>;
   pragma exception_init<span style="color: #707183;">(</span>womendajiadeyichang, -20001<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">begin</span>
   a := dbms_random.<span style="color: #a020f0;">value</span><span style="color: #707183;">(</span>0, 4<span style="color: #707183;">)</span>;
   if a &gt; 2 <span style="color: #a020f0;">then</span>
     dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'hehe, it is very great.'</span><span style="color: #707183;">)</span>;
   <span style="color: #a020f0;">else</span>
     raise womendajiadeyichang;
   <span style="color: #a020f0;">end</span> if;
<span style="color: #a020f0;">exception</span>
   <span style="color: #a020f0;">when</span> womendajiadeyichang <span style="color: #a020f0;">then</span>
     dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#25105;&#20204;&#22823;&#23478;&#30340;&#24322;&#24120;&#65292;&#25105;&#20204;&#22823;&#23478;&#30340;&#26041;&#26696;'</span><span style="color: #707183;">)</span>;
   <span style="color: #a020f0;">when</span> others <span style="color: #a020f0;">then</span>
     dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'&#25105;&#20063;&#19981;&#30693;&#36947;&#35813;&#24590;&#20040;&#21150;'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">end</span>;
/


<span style="color: #b22222;">-- &#24403;&#28982;&#65292;&#20063;&#21487;&#20197;&#20351;&#29992; raise_application_error(code, msg) &#36825;&#20010;&#36807;&#31243;&#30452;&#25509;&#25243;&#20986;&#24322;&#24120;&#12290;&#38750;&#24120;&#31616;&#21333;</span>
<span style="color: #a020f0;">declare</span>
  res <span style="color: #a020f0;">number</span> := 0;
<span style="color: #a020f0;">begin</span>
  <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> 1..100 loop
    res := res + i;
    if res &gt; 1000 <span style="color: #a020f0;">then</span>
      raise_application_error<span style="color: #707183;">(</span>-20002, <span style="color: #8b2252;">'&#24403;&#21069;&#30340;&#32467;&#26524;&#22826;&#22823;&#20102;&#65281;&#65281;&#65281;&#37117;&#36229;&#36807;1000&#20102;&#65281;&#65281;&#65281;'</span><span style="color: #707183;">)</span>;
    <span style="color: #a020f0;">end</span> if;
  <span style="color: #a020f0;">end</span> loop;
<span style="color: #a020f0;">end</span>;
/

<span style="color: #b22222;">-- &#22914;&#26524;&#24819;&#20026;&#19978;&#38754;&#30340;&#24322;&#24120;&#36215;&#19968;&#20010;&#21517;&#23383;&#65292;&#36824;&#26159; pragma.</span>
<span style="color: #a020f0;">declare</span>
  res <span style="color: #a020f0;">number</span> := 0;
  out_of_range <span style="color: #a020f0;">exception</span>;
  pragma exception_init<span style="color: #707183;">(</span>out_of_range, -20002<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">begin</span>
  <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> 1..100 loop
    res := res + i;
    if res &gt; 1000 <span style="color: #a020f0;">then</span>
      raise_application_error<span style="color: #707183;">(</span>-20002, <span style="color: #8b2252;">'&#24403;&#21069;&#30340;&#32467;&#26524;&#22826;&#22823;&#20102;&#65281;&#65281;&#65281;&#37117;&#36229;&#36807;1000&#20102;&#65281;&#65281;&#65281;'</span><span style="color: #707183;">)</span>;
    <span style="color: #a020f0;">end</span> if;
  <span style="color: #a020f0;">end</span> loop;
<span style="color: #a020f0;">exception</span>
  <span style="color: #a020f0;">when</span> out_of_range <span style="color: #a020f0;">then</span>
    dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'outOfRangeError'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">end</span>;
/
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-12-7" class="outline-3">
<h3 id="sec-12-7"><span class="section-number-3">12.7</span> 动态 SQL</h3>
<div class="outline-text-3" id="text-12-7">
<p>
Oracle 的 PL/SQL 运行分为编译，运行两个过程。
我们写在 PL/SQL 块中的 DDL/DML 语句在前期联编的过程中就被确定了，所以成为静态 SQL。
但是有些要执行的语句，在前期的联编过程中无法确定，只有到运行时才会确定。那么我们就需要用到动态 SQL。
</p>

<p>
有两种方式处理动态 SQL：
</p>
<ol class="org-ol">
<li>EXECUTE IMMEDIATE
</li>
<li>运用 Oracle 提供的 DBMS_SQL 包
</li>
</ol>

<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- EXECUTE IMMEDIATE &#22522;&#26412;&#35821;&#27861;</span>
<span style="color: #a020f0;">EXECUTE</span> <span style="color: #a020f0;">IMMEDIATE</span> &#25105;&#20204;&#35201;&#25191;&#34892;&#30340;&#21160;&#24577;&#35821;&#21477;
<span style="color: #707183;">[</span><span style="color: #a020f0;">INTO</span> &#35201;&#36171;&#20540;&#30340;&#21464;&#37327;<span style="color: #707183;">]</span>
<span style="color: #707183;">[</span><span style="color: #a020f0;">USING</span> &#38656;&#35201;&#32465;&#23450;&#30340;&#20540;<span style="color: #707183;">]</span>;


<span style="color: #b22222;">-- &#19968;&#20010;&#26647;&#23376;</span>
<span style="color: #a020f0;">declare</span>
  sqlstr1 varchar2<span style="color: #707183;">(</span>88<span style="color: #707183;">)</span> := <span style="color: #8b2252;">'create table ssabc (a varchar2(20))'</span>;
  sqlstr2 varchar2<span style="color: #707183;">(</span>88<span style="color: #707183;">)</span>;
  varstr varchar2<span style="color: #707183;">(</span>20<span style="color: #707183;">)</span> := <span style="color: #8b2252;">'hello'</span>;
  varres varchar2<span style="color: #707183;">(</span>20<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">begin</span>
  <span style="color: #b22222;">-- &#21019;&#24314;&#34920;&#30340;&#26041;&#24335;</span>
  <span style="color: #a020f0;">execute</span> <span style="color: #a020f0;">immediate</span> sqlstr1;

  <span style="color: #b22222;">-- &#25554;&#20837;&#31532;&#19968;&#26465;&#25968;&#25454;&#12290;oracle &#36890;&#36807;&#20004;&#20010;''&#20195;&#34920;&#23383;&#31526;&#20018;&#37324;&#30340;&#19968;&#20010;'&#31526;&#21495;</span>
  sqlstr2 := <span style="color: #8b2252;">'insert into ssabc values (''world'')'</span>;
  <span style="color: #a020f0;">execute</span> <span style="color: #a020f0;">immediate</span> sqlstr2;
  <span style="color: #a020f0;">commit</span>;

  <span style="color: #b22222;">-- &#25554;&#20837;&#31532;&#20108;&#26465;&#25968;&#25454;</span>
  <span style="color: #a020f0;">execute</span> <span style="color: #a020f0;">immediate</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'insert into ssabc values ('''</span> || varstr || <span style="color: #8b2252;">''')'</span><span style="color: #707183;">)</span>;
  <span style="color: #a020f0;">commit</span>;

  <span style="color: #b22222;">-- &#25554;&#20837;&#31532;&#19977;&#26465;&#25968;&#25454;&#65292;&#20854;&#20013; :1 &#26159;&#36827;&#34892;&#21464;&#37327;&#32465;&#23450;&#30340;&#19968;&#31181;&#24418;&#24335;</span>
  <span style="color: #a020f0;">execute</span> <span style="color: #a020f0;">immediate</span> <span style="color: #8b2252;">'insert into ssabc values (:1)'</span> <span style="color: #a020f0;">using</span> varstr;
  <span style="color: #a020f0;">commit</span>;

  <span style="color: #b22222;">-- &#26597;&#35810;&#19968;&#26465;&#25968;&#25454;&#65292;&#21033;&#29992; select into&#65292;&#23545;&#26597;&#35810;&#32467;&#26524;&#36827;&#34892;&#36171;&#20540;</span>
  <span style="color: #a020f0;">execute</span> <span style="color: #a020f0;">immediate</span> <span style="color: #8b2252;">'select a from ssabc where rownum &lt; 2'</span> <span style="color: #a020f0;">into</span> varres;
  dbms_output.put_line<span style="color: #707183;">(</span>varres<span style="color: #707183;">)</span>;

<span style="color: #a020f0;">end</span>;
/
</pre>
</div>

<p>
DBMS_SQL 的方式，请看课本 p260.
</p>
</div>
</div>


<div id="outline-container-sec-12-8" class="outline-3">
<h3 id="sec-12-8"><span class="section-number-3">12.8</span> 游标 (Cursor)</h3>
<div class="outline-text-3" id="text-12-8">
<p>
游标是一种数据集合，可以类同于 java 里的 ResultSet，用于保存 SQL 查询的结果集。
</p>

<p>
当查询一条语句时， Oracle 会打开一片工作区，把结果保存在里面，在这片工作区，存在一个指针，默认指向第一条记录。我们可以通过移动指针达到获取不同记录的目的。
</p>

<p>
这个指针，就是游标。
</p>

<p>
游标分为隐式游标和显式游标。
</p>

<p>
隐式游标是 Oracle 自动管理的，比如我们进行一次 update，Oracle 会打开一个游标定位到数据，我们更新结束后，Oracle 就会把游标给关闭。
</p>

<p>
显式游标，就是我们要自定义的游标，主要用来处理有多条数据返回的查询。下面是简单介绍。
</p>

<p>
游标的使用分为下面几步：
</p>
<ol class="org-ol">
<li>定义游标
</li>
<li>打开游标
</li>
<li>从当前位置获取数据
</li>
<li>循环直到读取结束
</li>
<li>关闭游标
</li>
</ol>

<div class="org-src-container">

<pre class="src src-sql"><span style="color: #a020f0;">declare</span>
  <span style="color: #a020f0;">cursor</span> c_emp <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> deptno = 10;  <span style="color: #b22222;">-- &#23450;&#20041;&#28216;&#26631;</span>
  v_emp emp%rowtype;
<span style="color: #a020f0;">begin</span>
  <span style="color: #a020f0;">open</span> c_emp;              <span style="color: #b22222;">-- &#25171;&#24320;&#28216;&#26631;</span>
  <span style="color: #a020f0;">fetch</span> c_emp <span style="color: #a020f0;">into</span> v_emp;  <span style="color: #b22222;">-- &#25552;&#21462;&#25968;&#25454;</span>
  loop
    dbms_output.put_line<span style="color: #707183;">(</span>v_emp.ename || <span style="color: #8b2252;">' &#24037;&#36164; '</span> || v_emp.sal<span style="color: #707183;">)</span>;
    <span style="color: #a020f0;">fetch</span> c_emp <span style="color: #a020f0;">into</span> v_emp;
    exit <span style="color: #a020f0;">when</span> c_emp%notfound;
  <span style="color: #a020f0;">end</span> loop;
  <span style="color: #a020f0;">close</span> c_emp;             <span style="color: #b22222;">-- &#20851;&#38381;&#28216;&#26631;</span>
<span style="color: #a020f0;">end</span>;
/

<span style="color: #b22222;">-- for &#20250;&#33258;&#21160;&#25171;&#24320;&#20851;&#38381;&#28216;&#26631;</span>
<span style="color: #a020f0;">declare</span>
  <span style="color: #a020f0;">cursor</span> c_emp <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> deptno = 10;
<span style="color: #a020f0;">begin</span>
  <span style="color: #a020f0;">for</span> v_emp <span style="color: #a020f0;">in</span> c_emp loop
    dbms_output.put_line<span style="color: #707183;">(</span>v_emp.<span style="color: #a020f0;">name</span> || <span style="color: #8b2252;">' &#24037;&#36164; '</span> || v_emp.sal<span style="color: #707183;">)</span>;
  <span style="color: #a020f0;">end</span> loop;
<span style="color: #a020f0;">end</span>;
/

<span style="color: #b22222;">-- &#20877;&#31616;&#21333;&#19968;&#28857;&#28857;</span>
<span style="color: #a020f0;">BEGIN</span>
  <span style="color: #a020f0;">for</span> item <span style="color: #a020f0;">in</span> 
  <span style="color: #707183;">(</span> <span style="color: #a020f0;">select</span> last_name, job_id
     <span style="color: #a020f0;">from</span> employees
     <span style="color: #a020f0;">where</span> job_id <span style="color: #a020f0;">like</span> <span style="color: #8b2252;">'%CLERK%'</span>
     <span style="color: #a020f0;">and</span> manager_id &gt; 120 <span style="color: #707183;">)</span> loop
    dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #8b2252;">'name = '</span> || item.last_name || <span style="color: #8b2252;">', Job = '</span> || item.job_id<span style="color: #707183;">)</span>;
  <span style="color: #a020f0;">end</span> loop;
<span style="color: #a020f0;">END</span>;
/
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-12-9" class="outline-3">
<h3 id="sec-12-9"><span class="section-number-3">12.9</span> 存储过程</h3>
<div class="outline-text-3" id="text-12-9">
<p>
存储过程就是赋予名字的 PL/SQL 块。它可以实现复用的目的。
</p>

<p>
跟函数类似，但存储过程没有 return 语句，它更专注于执行过程，而非返回结果。
</p>

<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#31616;&#21333;&#26647;&#23376;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">or</span> replace <span style="color: #a020f0;">procedure</span> <span style="color: #0000ff;">demo_procedure</span> <span style="color: #707183;">(</span>arg <span style="color: #a020f0;">number</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">is</span>
  <span style="color: #a020f0;">name</span> varchar2<span style="color: #707183;">(</span>20<span style="color: #707183;">)</span> := <span style="color: #8b2252;">'Tom'</span>;
<span style="color: #a020f0;">begin</span>
  dbms_output.put_line<span style="color: #707183;">(</span><span style="color: #a020f0;">name</span> || <span style="color: #8b2252;">' is '</span> || arg || <span style="color: #8b2252;">' years old now.'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">end</span>;
/

<span style="color: #b22222;">-- &#25191;&#34892;&#23384;&#20648;&#36807;&#31243;</span>
<span style="color: #a020f0;">exec</span> demo_procedure<span style="color: #707183;">(</span>9<span style="color: #707183;">)</span>;
<span style="color: #b22222;">-- or</span>
<span style="color: #a020f0;">begin</span>
  demo_procedure<span style="color: #707183;">(</span>9<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">end</span>;
/
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-sec-13" class="outline-2">
<h2 id="sec-13"><span class="section-number-2">13</span> 导入导出</h2>
<div class="outline-text-2" id="text-13">
<p>
这里只是简单栗子，更多选项请查阅资料
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">exp &#21629;&#20196;&#29992;&#26469;&#23548;&#20986;&#25968;&#25454;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26174;&#31034;&#24110;&#21161;&#20449;&#24687;</span>
exp <span style="color: #a0522d;">help</span>=y

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20030;&#20363;&#65306;&#25226; scott &#21644; vip &#29992;&#25143;&#19979;&#30340;&#25152;&#26377;&#34920;&#37117;&#23548;&#20986;&#26469;&#65292;&#20445;&#23384;&#21040; aaa &#25991;&#20214;</span>
exp system/orcl <span style="color: #a0522d;">file</span>=D:\aaa.dmp <span style="color: #a0522d;">owner</span>=<span style="color: #707183;">(</span>scott,vip<span style="color: #707183;">)</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">imp &#21629;&#20196;&#29992;&#26469;&#23548;&#20837;&#25968;&#25454;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20030;&#20363;&#65292;&#25226; aaa &#25991;&#20214;&#20013;&#30340; scott &#29992;&#25143;&#30340;&#34920;&#23548;&#20837;&#21040; vip &#29992;&#25143;&#20013;</span>
imp system/orcl <span style="color: #a0522d;">file</span>=D:\aaa.dmp <span style="color: #a0522d;">fromuser</span>=<span style="color: #707183;">(</span>scott<span style="color: #707183;">)</span> <span style="color: #a0522d;">touser</span>=<span style="color: #707183;">(</span>vip<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</section>
<section id="outline-container-sec-14" class="outline-2">
<h2 id="sec-14"><span class="section-number-2">14</span> 生成批量数据</h2>
<div class="outline-text-2" id="text-14">
<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b22222;">-- &#31532;&#19968;&#31181;&#65292;&#29983;&#25104;&#38543;&#26426;&#25968;&#65292;&#38543;&#26426;&#23383;&#31526;&#20018;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">sequence</span> <span style="color: #0000ff;">shello</span>;

<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">demo</span> <span style="color: #a020f0;">as</span>
 <span style="color: #a020f0;">select</span> 
     shello.nextval id,
     <span style="color: #8b2252;">'SIT_'</span> || dbms_random.string<span style="color: #707183;">(</span><span style="color: #8b2252;">'l'</span>, 5<span style="color: #707183;">)</span> abc,
     round<span style="color: #707183;">(</span>dbms_random.<span style="color: #a020f0;">value</span><span style="color: #7388d6;">(</span>0, 100<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span> score
   <span style="color: #a020f0;">from</span> dual <span style="color: #a020f0;">connect</span> <span style="color: #a020f0;">by</span> <span style="color: #a020f0;">level</span> &lt;= 100000;

<span style="color: #b22222;">-- &#31532;&#20108;&#31181;&#65292;&#29992;&#24050;&#26377;&#30340;&#25968;&#25454;&#65292;&#20363;&#65306;</span>
<span style="color: #a020f0;">begin</span>
  <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> 1..100 loop
     <span style="color: #b22222;">-- &#22797;&#21046;&#22810;&#20221;&#25968;&#25454;</span>
     <span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> demo <span style="color: #a020f0;">select</span> xxx,yyy <span style="color: #a020f0;">from</span> dba_objects;
  <span style="color: #a020f0;">end</span> loop;
<span style="color: #a020f0;">end</span>;
<span style="color: #a020f0;">select</span> row_number over <span style="color: #707183;">(</span><span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> <span style="color: #707183;">)</span>
</pre>
</div>
</div>
</section>

<section id="outline-container-sec-15" class="outline-2">
<h2 id="sec-15"><span class="section-number-2">15</span> pages</h2>
<div class="outline-text-2" id="text-15">
<p>
<a href="http://wenku.baidu.com/view/e3fcb582ec3a87c24028c4fc.html">http://wenku.baidu.com/view/e3fcb582ec3a87c24028c4fc.html</a>
</p>
</div>
</section>
</div>
<div id="postamble" class="status">
<p class="author">Author: imfine</p>
<p class="date">Created: 2017-03-15 周三 16:38</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.1.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation">Go ahead, never stop.</p>
</div>
</body>
</html>
