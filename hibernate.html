<!DOCTYPE html>
<html>
<head>
<title>Hibernate ORM</title>
<!-- 2016-11-02 周三 08:39 -->
<meta  charset="utf-8">
<meta  name="generator" content="Org-mode">
<meta  name="author" content="imfine">
<link rel="stylesheet" href="ss.css">
</head>
<body>
<div id="content">
<h1 class="title">Hibernate ORM</h1>
<nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">基本知识</a></li>
<li><a href="#sec-2">起步</a></li>
</ul>
</div>
</nav>



<section id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">基本知识</h2>
<div class="outline-text-2" id="text-1">
<p>
ORM:
</p>
<pre class="example">
Object-Relationship Mapping
</pre>
<p>
对象，跟数据库，有着某种对应关系
</p>
<table>


<colgroup>
<col  class="left">

<col  class="left">
</colgroup>
<tbody>
<tr>
<td class="left">类</td>
<td class="left">表的结构(MetaData)</td>
</tr>

<tr>
<td class="left">实例化的对象</td>
<td class="left">每一条数据</td>
</tr>

<tr>
<td class="left">对象的每个属性</td>
<td class="left">数据的每个字段</td>
</tr>
</tbody>
</table>

<p>
面向对象的封装，让我们在编程的过程中用更自然的思维处理问题，
所以在操作数据库的时候，需要把数据库里的数据跟我们创建的对象关联起来。
我们可以手动写代码实现这个过程。
也可以通过一些 ORM 框架去实现。Hibernate 就是其中一种非常优秀的框架。
</p>
</div>
</section>

<section id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">起步</h2>
<div class="outline-text-2" id="text-2">
<p>
使用 Hibernate 的步骤:
</p>

<ol class="org-ol">
<li>建立 Web 工程
</li>
<li>将需要用到的 jar 包，拷贝到 lib 包的下面。一定不要放错位置。也不要缺少关键包。也尽量不要有包的冲突。
</li>
<li>创建 hibernate 的配置文件 hibernate.cfg.xml，指定数据库信息、打印sql语句策略等
<div class="org-src-container">

<pre class="src src-xml">&lt;?<span style="color: #0000FF;">xml</span> <span style="color: #BA36A5;">version</span>=<span style="color: #008000;">"</span><span style="color: #008000;">1.0</span><span style="color: #008000;">"</span> <span style="color: #BA36A5;">encoding</span>=<span style="color: #008000;">"</span><span style="color: #008000;">UTF-8</span><span style="color: #008000;">"</span>?&gt;
&lt;!<span style="color: #0000FF;">DOCTYPE</span> hibernate-configuration <span style="color: #0000FF;">PUBLIC</span>
 <span style="color: #036A07;">"</span><span style="color: #036A07;">-//Hibernate/Hibernate Configuration DTD 3.0//EN</span><span style="color: #036A07;">"</span>
 <span style="color: #036A07;">"</span><span style="color: #036A07;">http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd</span><span style="color: #036A07;">"</span>&gt;

&lt;<span style="color: #000088; background-color: #DEDEDE;">hibernate-configuration</span>&gt;
  &lt;<span style="color: #000088; background-color: #DEDEDE;">session-factory</span>&gt;
     <span style="color: #8D8D84;">&lt;!--</span><span style="color: #8D8D84; font-style: italic;"> &#37197;&#32622;&#25968;&#25454;&#24211;&#30340;&#22522;&#26412;&#20449;&#24687; </span><span style="color: #8D8D84;">--&gt;</span>
     &lt;<span style="color: #000088; background-color: #DEDEDE;">property</span> <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"</span><span style="color: #008000;">hibernate.connection.driver_class</span><span style="color: #008000;">"</span>&gt;oracle.jdbc.driver.OracleDriver&lt;/<span style="color: #000088; background-color: #DEDEDE;">property</span>&gt;
     &lt;<span style="color: #000088; background-color: #DEDEDE;">property</span> <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"</span><span style="color: #008000;">hibernate.connection.url</span><span style="color: #008000;">"</span>&gt;jdbc:oracle:thin:@localhost:1521:orcl&lt;/<span style="color: #000088; background-color: #DEDEDE;">property</span>&gt;
     &lt;<span style="color: #000088; background-color: #DEDEDE;">property</span> <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"</span><span style="color: #008000;">hibernate.connection.username</span><span style="color: #008000;">"</span>&gt;vip&lt;/<span style="color: #000088; background-color: #DEDEDE;">property</span>&gt;
     &lt;<span style="color: #000088; background-color: #DEDEDE;">property</span> <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"</span><span style="color: #008000;">hibernate.connection.password</span><span style="color: #008000;">"</span>&gt;vip&lt;/<span style="color: #000088; background-color: #DEDEDE;">property</span>&gt;
     &lt;<span style="color: #000088; background-color: #DEDEDE;">property</span> <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"</span><span style="color: #008000;">hibernate.dialect</span><span style="color: #008000;">"</span>&gt;org.hibernate.dialect.Oracle10gDialect&lt;/<span style="color: #000088; background-color: #DEDEDE;">property</span>&gt;

     <span style="color: #8D8D84;">&lt;!--</span><span style="color: #8D8D84; font-style: italic;"> &#37197;&#32622; SQL &#35821;&#21477;&#26174;&#31034;&#25110;&#32773; DDL &#29983;&#25104;&#30340;&#31574;&#30053; </span><span style="color: #8D8D84;">--&gt;</span>
     &lt;<span style="color: #000088; background-color: #DEDEDE;">property</span> <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"</span><span style="color: #008000;">hibernate.show_sql</span><span style="color: #008000;">"</span>&gt;true&lt;/<span style="color: #000088; background-color: #DEDEDE;">property</span>&gt;
     &lt;<span style="color: #000088; background-color: #DEDEDE;">property</span> <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"</span><span style="color: #008000;">hibernate.format_sql</span><span style="color: #008000;">"</span>&gt;true&lt;/<span style="color: #000088; background-color: #DEDEDE;">property</span>&gt;
     &lt;<span style="color: #000088; background-color: #DEDEDE;">property</span> <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"</span><span style="color: #008000;">hibernate.hbm2ddl.auto</span><span style="color: #008000;">"</span>&gt;create&lt;/<span style="color: #000088; background-color: #DEDEDE;">property</span>&gt;

     <span style="color: #8D8D84;">&lt;!--</span><span style="color: #8D8D84; font-style: italic;"> &#37197;&#32622;&#19968;&#31995;&#21015;&#30340; Mapping &#25991;&#20214;&#12290;&#20998;&#20026; xml/annotation &#31561;&#26041;&#24335; </span><span style="color: #8D8D84;">--&gt;</span>        
     &lt;<span style="color: #000088; background-color: #DEDEDE;">mapping</span> <span style="color: #BA36A5;">resource</span>=<span style="color: #008000;">"</span><span style="color: #008000;">hibernate/helloworld/Book.hbm.xml</span><span style="color: #008000;">"</span> /&gt;
     &lt;<span style="color: #000088; background-color: #DEDEDE;">mapping</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"</span><span style="color: #008000;">hibernate.helloworld.Book</span><span style="color: #008000;">"</span> /&gt;

  &lt;/<span style="color: #000088; background-color: #DEDEDE;">session-factory</span>&gt;
&lt;/<span style="color: #000088; background-color: #DEDEDE;">hibernate-configuration</span>&gt;
</pre>
</div>
</li>
<li>创建实体类 Book.java
<blockquote>
<p>
注意，要写成 JavaBean 的规范格式。字段用 private 限制，并为每个字段写 getter/setter 方法(property accessor)。
</p>

<p>
还要注意，一个实体类，要跟数据库做映射的话，有一个字段是必须的，就是主键，在 hibernate 中，用 @Id 来表示。
</p>

<p>
还要注意，一个实体类，必须要有一个无参构造器。如果我们在里面写了带参数的构造器，那一定不要忘记，增加一个默认的无参构造器。
</p>
</blockquote>
</li>

<li>创建数据库跟实体类的映射。有两种方式：XML方式、Annotation方式
<ol class="org-ol">
<li>创建相关的xml映射文件 Book.hbm.xml
<div class="org-src-container">

<pre class="src src-xml">&lt;?<span style="color: #0000FF;">xml</span> <span style="color: #BA36A5;">version</span>=<span style="color: #008000;">"</span><span style="color: #008000;">1.0</span><span style="color: #008000;">"</span> <span style="color: #BA36A5;">encoding</span>=<span style="color: #008000;">"</span><span style="color: #008000;">UTF-8</span><span style="color: #008000;">"</span>?&gt;
&lt;!<span style="color: #0000FF;">DOCTYPE</span> hibernate-mapping <span style="color: #0000FF;">PUBLIC</span> 
    <span style="color: #036A07;">"</span><span style="color: #036A07;">-//Hibernate/Hibernate Mapping DTD 3.0//EN</span><span style="color: #036A07;">"</span>
    <span style="color: #036A07;">"</span><span style="color: #036A07;">http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd</span><span style="color: #036A07;">"</span>&gt;

&lt;<span style="color: #000088; background-color: #DEDEDE;">hibernate-mapping</span>&gt;
  <span style="color: #8D8D84;">&lt;!--</span><span style="color: #8D8D84; font-style: italic;"> &#37197;&#32622;&#23454;&#20307;&#31867;&#30340;&#26144;&#23556; </span><span style="color: #8D8D84;">--&gt;</span>
  &lt;<span style="color: #000088; background-color: #DEDEDE;">class</span> <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"</span><span style="color: #008000;">hibernate.helloworld.Book</span><span style="color: #008000;">"</span> <span style="color: #BA36A5;">table</span>=<span style="color: #008000;">"</span><span style="color: #008000;">t_book</span><span style="color: #008000;">"</span>&gt;
    &lt;<span style="color: #000088; background-color: #DEDEDE;">id</span> <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"</span><span style="color: #008000;">bookno</span><span style="color: #008000;">"</span>&gt;
      &lt;<span style="color: #000088; background-color: #DEDEDE;">generator</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"</span><span style="color: #008000;">native</span><span style="color: #008000;">"</span>&gt;&lt;/<span style="color: #000088; background-color: #DEDEDE;">generator</span>&gt;
    &lt;/<span style="color: #000088; background-color: #DEDEDE;">id</span>&gt;

    &lt;<span style="color: #000088; background-color: #DEDEDE;">property</span> <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"</span><span style="color: #008000;">name</span><span style="color: #008000;">"</span>&gt;&lt;/<span style="color: #000088; background-color: #DEDEDE;">property</span>&gt;
    &lt;<span style="color: #000088; background-color: #DEDEDE;">property</span> <span style="color: #BA36A5;">name</span>=<span style="color: #008000;">"</span><span style="color: #008000;">price</span><span style="color: #008000;">"</span>&gt;&lt;/<span style="color: #000088; background-color: #DEDEDE;">property</span>&gt;
  &lt;/<span style="color: #000088; background-color: #DEDEDE;">class</span>&gt;

  <span style="color: #8D8D84;">&lt;!--</span><span style="color: #8D8D84; font-style: italic;"> &#22312;&#36825;&#37324;&#65292;&#21487;&#20197;&#28155;&#21152;&#20854;&#20182;&#30340;&#23454;&#20307;&#31867;&#26144;&#23556; </span><span style="color: #8D8D84;">--&gt;</span>

&lt;/<span style="color: #000088; background-color: #DEDEDE;">hibernate-mapping</span>&gt;
</pre>
</div>
</li>

<li>在实体类上加相关的注解
<table>


<colgroup>
<col  class="left">

<col  class="left">
</colgroup>
<tbody>
<tr>
<td class="left">@Entity 注解</td>
<td class="left">用来标识类是一个与数据库关联的实体类。这个注解作用在类上面。</td>
</tr>

<tr>
<td class="left">@Id 注解</td>
<td class="left">让hibernate把当前属性解析为一个主键</td>
</tr>

<tr>
<td class="left">@Basic 注解</td>
<td class="left">用来表示，让 hibernate 把当前属性解析为一个表的普通字段。要注意，如果有些java基本类型，没有任何注解的话，默认是带有 @Basic 注解的。</td>
</tr>

<tr>
<td class="left">@Table 注解</td>
<td class="left">用来自定义生成表的详细信息的。作用在类上面。</td>
</tr>

<tr>
<td class="left">@Column 注解</td>
<td class="left">用来自定义生成字段的相信信息的。</td>
</tr>

<tr>
<td class="left">@GeneratedValue 注解</td>
<td class="left">用来自定义主键的自动生成策略</td>
</tr>

<tr>
<td class="left">@Transient 注解</td>
<td class="left">用来将指定属性排除掉，不进行持久化</td>
</tr>
</tbody>
</table>
</li>
</ol>
</li>

<li>在 hibernate.cfg.xml 中添加映射，开始连接
<ol class="org-ol">
<li>创建 sessionFactory
</li>
<li>创建 session
</li>
<li>创建 Transaction
</li>
<li>通过 Query 等进行查询；通过 save/delete 等进行增删。
</li>
<li>提交事务，关闭 session，关闭 SessionFactory。
</li>
</ol>
</li>
</ol>
</div>
</section>
</div>
<div id="postamble" class="status">
<p class="author">Author: imfine</p>
<p class="date">Created: 2016-11-02 周三 08:39</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.5.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation">Go ahead, never stop.</p>
</div>
</body>
</html>
